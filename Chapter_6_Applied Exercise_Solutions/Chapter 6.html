<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shad Ali Shah and Atta ur rehman and Naveed">
<meta name="dcterms.date" content="2025-11-14">

<title>Statistical Learning Analysis Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="Chapter 6_files/libs/clipboard/clipboard.min.js"></script>
<script src="Chapter 6_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Chapter 6_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Chapter 6_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="Chapter 6_files/libs/quarto-html/popper.min.js"></script>
<script src="Chapter 6_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Chapter 6_files/libs/quarto-html/anchor.min.js"></script>
<link href="Chapter 6_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Chapter 6_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Chapter 6_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Chapter 6_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Chapter 6_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#exercise-8" id="toc-exercise-8" class="nav-link active" data-scroll-target="#exercise-8"><span class="header-section-number">1</span> Exercise 8</a></li>
  <li><a href="#exercise-9" id="toc-exercise-9" class="nav-link" data-scroll-target="#exercise-9"><span class="header-section-number">2</span> Exercise 9</a></li>
  <li><a href="#exercise-10" id="toc-exercise-10" class="nav-link" data-scroll-target="#exercise-10"><span class="header-section-number">3</span> Exercise 10</a></li>
  <li><a href="#exercise-11" id="toc-exercise-11" class="nav-link" data-scroll-target="#exercise-11"><span class="header-section-number">4</span> Exercise 11</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Statistical Learning Analysis Report</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Chapter 6: ISLR2 Exercise Solutions</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shad Ali Shah and Atta ur rehman and Naveed </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 14, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="exercise-8" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="exercise-8"><span class="header-section-number">1</span> Exercise 8</h2>
<section id="a" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="a"><span class="header-section-number">1.1</span> (a)</h3>
<div id="2902c3be" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.api <span class="im">import</span> OLS</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.model_selection <span class="im">as</span> skm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.linear_model <span class="im">as</span> skl</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> ModelSpec <span class="im">as</span> MS</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cross_decomposition <span class="im">import</span> PLSRegression</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> <span class="op">\</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>     (Stepwise,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      sklearn_selected,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      sklearn_selection_path)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> l0bnb <span class="im">import</span> fit_path</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ModuleNotFoundError</span>:</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Warning: l0bnb module not found. Install it with: pip install l0bnb"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    fit_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="c60e034f" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">100</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span><span class="dv">100</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="dv">0</span>,scale<span class="op">=</span><span class="dv">1</span>,size<span class="op">=</span>n)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>epsilon<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="dv">0</span>,scale<span class="op">=</span><span class="dv">1</span>,size<span class="op">=</span>n)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="b" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="b"><span class="header-section-number">1.2</span> (b)</h3>
<div id="8cba4de0" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span>np.array([<span class="fl">0.2</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">4</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>beta[<span class="dv">0</span>]<span class="op">+</span>beta[<span class="dv">1</span>]<span class="op">*</span>X<span class="op">+</span>beta[<span class="dv">2</span>]<span class="op">*</span>X<span class="op">**</span><span class="dv">2</span><span class="op">+</span>beta[<span class="dv">3</span>]<span class="op">*</span>X<span class="op">**</span><span class="dv">3</span><span class="op">+</span>epsilon</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="c" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="c"><span class="header-section-number">1.3</span> (c)</h3>
<div id="e8b194dc" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Xs<span class="op">=</span>pd.DataFrame({<span class="st">'X'</span>:X,<span class="st">'X2'</span>:X<span class="op">**</span><span class="dv">2</span>,<span class="st">'X3'</span>:X<span class="op">**</span><span class="dv">3</span>,<span class="st">'X4'</span>:X<span class="op">**</span><span class="dv">4</span>,<span class="st">'X5'</span>:X<span class="op">**</span><span class="dv">5</span>,<span class="st">'X6'</span>:X<span class="op">**</span><span class="dv">6</span>,<span class="st">'X7'</span>:X<span class="op">**</span><span class="dv">7</span>,<span class="st">'X8'</span>:X<span class="op">**</span><span class="dv">8</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'X9'</span>:X<span class="op">**</span><span class="dv">9</span>,<span class="st">'X10'</span>:X<span class="op">**</span><span class="dv">10</span>})</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Ys<span class="op">=</span>pd.DataFrame({<span class="st">'Y'</span>:Y})</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> nCp(sigma2, estimator, Xsigma, Ysigma):</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Negative Cp statistic"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    n, p <span class="op">=</span> Xsigma.shape</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    Yhat <span class="op">=</span> estimator.predict(Xsigma)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    RSS <span class="op">=</span> np.<span class="bu">sum</span>((Ysigma <span class="op">-</span> Yhat)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>(RSS <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> p <span class="op">*</span> sigma2) <span class="op">/</span> n <span class="co">#We look for the negative Cp since the sklearn methods try to </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#maximize the ouputs</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's now compute the residual variance sigma2. i.e, the variance of the residuals of </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#the complete model</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(Xs).fit(Xs)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>Ysigma <span class="op">=</span> np.array(Ys[<span class="st">'Y'</span>])</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>Xsigma <span class="op">=</span> design.transform(Xs)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>OLS(Ysigma,Xsigma).fit()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> model.scale<span class="co">#The result should be close enough to 1 because the beta </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#coefficients are close too and the Xs columns are generated from a standard normal distribution</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Now we should specify the strategy for the selection of the best model. For this we gonna use </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Stepwise.first_peak() method available in ISLP library</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>strategy<span class="op">=</span>Stepwise.first_peak(design,direction<span class="op">=</span><span class="st">'forward'</span>,max_terms<span class="op">=</span><span class="bu">len</span>(design.terms))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Now it's time to fit a linear regression model using the strategy and the sklearn_selected() from</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#the ISLP.models package. But before we should freeze the first argument </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>neg_Cp <span class="op">=</span> partial(nCp,sigma2) </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>Y_Cp<span class="op">=</span> sklearn_selected(OLS,strategy,scoring<span class="op">=</span>neg_Cp)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>Y_Cp.fit(Xsigma, Ysigma)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>Y_Cp.selected_state_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>('X', 'X2', 'X3')</code></pre>
</div>
</div>
</section>
<section id="d" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="d"><span class="header-section-number">1.4</span> (d)</h3>
<div id="e2e05ea5" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>strategy_backward<span class="op">=</span>Stepwise.first_peak(design,direction<span class="op">=</span><span class="st">'backwards'</span>,max_terms<span class="op">=</span><span class="bu">len</span>(design.terms))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>neg_Cp1 <span class="op">=</span> partial(nCp,sigma2) </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Y_CpB<span class="op">=</span> sklearn_selected(OLS,strategy_backward,scoring<span class="op">=</span>neg_Cp1)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>Y_CpB.fit(Xsigma, Ysigma)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Y_CpB.selected_state_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>('X', 'X2', 'X3')</code></pre>
</div>
</div>
<p>Logically we get the same results as for forward stepwise selection. As a reminder the choice of X, X2 and X3 does not mean that the related regression coefficients are significant as regularization methods merely suggest candidates for the optimal model.</p>
</section>
<section id="e" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="e"><span class="header-section-number">1.5</span> (e)</h3>
<div id="cd3c588a" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#No need to standardise Xs columns because they already stem from standard normal distribution</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> design.fit_transform(Xs)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> np.asarray(D)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Since we want to use a Lasso model there is no need to specify a grid of lambdas. These will be</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># be generated automatically</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>lassoCV <span class="op">=</span> skl.ElasticNetCV(n_alphas<span class="op">=</span><span class="dv">100</span>,l1_ratio<span class="op">=</span><span class="dv">1</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>pipeCV <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler),(<span class="st">'lasso'</span>, lassoCV)])</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>pipeCV.fit(X1, Ysigma)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>tuned_lasso <span class="op">=</span> pipeCV.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal value of lambda is:'</span>,tuned_lasso.alpha_)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The optimal value of lambda is: 0.011422938509194142</code></pre>
</div>
</div>
<div id="01307bff" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit a path of Lasso regressions and extract lambdas as well cause these are generated automtically</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for the Lasso model case</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>lambdas, soln_array <span class="op">=</span> skl.Lasso.path(Xsigma,Ysigma,l1_ratio<span class="op">=</span><span class="dv">1</span>,n_alphas<span class="op">=</span><span class="dv">100</span>)[:<span class="dv">2</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>soln_path <span class="op">=</span> pd.DataFrame(soln_array.T,columns<span class="op">=</span>D.columns,index<span class="op">=-</span>np.log(lambdas))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="ebd05c6f" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lassoCV_fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ax.errorbar(<span class="op">-</span>np.log(tuned_lasso.alphas_),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            tuned_lasso.mse_path_.mean(<span class="dv">1</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            yerr<span class="op">=</span>tuned_lasso.mse_path_.std(<span class="dv">1</span>) <span class="op">/</span> np.sqrt(K))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="op">-</span>np.log(tuned_lasso.alpha_), c<span class="op">=</span><span class="st">'k'</span>, ls<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'$-</span><span class="er">\</span><span class="st">log(</span><span class="er">\</span><span class="st">lambda)$'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Cross-validated MSE'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter%206_files/figure-html/cell-9-output-1.png" width="681" height="666" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="4ac14a9d" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's report the corresponding coefficients of the optimal lambda chosen by cross validation</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>tuned_lasso.coef_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>array([ 0.00000000e+00,  7.23101437e-01,  1.56911795e+00,  1.06337083e+01,
        2.77621504e-01,  0.00000000e+00,  0.00000000e+00, -0.00000000e+00,
        0.00000000e+00, -4.86290744e-03,  0.00000000e+00])</code></pre>
</div>
</div>
<p>The best model according to Lasso regression contains the coefficients of <span class="math inline">\(X\)</span>, <span class="math inline">\(X^2\)</span>, <span class="math inline">\(X^3\)</span>, <span class="math inline">\(X^4\)</span> and <span class="math inline">\(X^9\)</span>. Notice that results obtained by Lasso are different than those obtained by stepwise or backward selection.<br> This was expected as the latter two methods are greedy algorithms and merely find a local subset, which is different for Lasso.</p>
</section>
<section id="f" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="f"><span class="header-section-number">1.6</span> (f)</h3>
<div id="05ec2ea1" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>X.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>(100,)</code></pre>
</div>
</div>
<div id="7046854a" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span>[<span class="dv">6</span>,<span class="dv">10</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Ynew<span class="op">=</span>beta[<span class="dv">0</span>]<span class="op">+</span>beta[<span class="dv">1</span>]<span class="op">*</span>X<span class="op">**</span><span class="dv">7</span><span class="op">+</span>epsilon</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="23c0abd5" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the forward stepwise selection approach with the same predictors as the previous models</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Ysnew<span class="op">=</span>pd.DataFrame({<span class="st">'Y'</span>:Ynew})</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(Xs).fit(Xs)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>Ysigman <span class="op">=</span> np.array(Ysnew[<span class="st">'Y'</span>])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>OLS(Ysigman,Xsigma).fit()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>sigma2n <span class="op">=</span> model.scale</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>strategy<span class="op">=</span>Stepwise.first_peak(design,direction<span class="op">=</span><span class="st">'forward'</span>,max_terms<span class="op">=</span><span class="bu">len</span>(design.terms))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>neg_Cpn <span class="op">=</span> partial(nCp,sigma2n) </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>Y_Cpn<span class="op">=</span> sklearn_selected(OLS,strategy,scoring<span class="op">=</span>neg_Cpn)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>Y_Cpn.fit(Xsigma, Ysigman)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>Y_Cpn.selected_state_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>('X7',)</code></pre>
</div>
</div>
<p>The forward stepwise selection approach recommands the model containing predictor <span class="math inline">\(X^7\)</span> and the intercept as the best one.<br> The stepwise selection seucceeded in this case to emulate the true model.</p>
<div id="b53a2e21" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's run the Lasso regrssion</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>lassoCVn <span class="op">=</span> skl.ElasticNetCV(n_alphas<span class="op">=</span><span class="dv">100</span>,l1_ratio<span class="op">=</span><span class="dv">1</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>pipeCVn <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler),(<span class="st">'lasso'</span>, lassoCV)])</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>pipeCVn.fit(X1, Ysigman)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>tuned_lasson <span class="op">=</span> pipeCVn.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal value of lambda is:'</span>,tuned_lasso.alpha_)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The optimal value of lambda is: 0.6268263569044815</code></pre>
</div>
</div>
<div id="edc7a5d3" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>tuned_lasson.coef_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>array([  0.        ,  -2.74928715,   0.53179374,   0.        ,
         0.        ,  76.93506706,   0.        , 435.77147222,
         0.        , 118.82385473,  -0.        ])</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-9" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="exercise-9"><span class="header-section-number">2</span> Exercise 9</h2>
<div id="f1155f20" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>college<span class="op">=</span>load_data(<span class="st">'College'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="b87924d7" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>college.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 777 entries, 0 to 776
Data columns (total 18 columns):
 #   Column       Non-Null Count  Dtype   
---  ------       --------------  -----   
 0   Private      777 non-null    category
 1   Apps         777 non-null    int64   
 2   Accept       777 non-null    int64   
 3   Enroll       777 non-null    int64   
 4   Top10perc    777 non-null    int64   
 5   Top25perc    777 non-null    int64   
 6   F.Undergrad  777 non-null    int64   
 7   P.Undergrad  777 non-null    int64   
 8   Outstate     777 non-null    int64   
 9   Room.Board   777 non-null    int64   
 10  Books        777 non-null    int64   
 11  Personal     777 non-null    int64   
 12  PhD          777 non-null    int64   
 13  Terminal     777 non-null    int64   
 14  S.F.Ratio    777 non-null    float64 
 15  perc.alumni  777 non-null    int64   
 16  Expend       777 non-null    int64   
 17  Grad.Rate    777 non-null    int64   
dtypes: category(1), float64(1), int64(16)
memory usage: 104.2 KB</code></pre>
</div>
</div>
<div id="1b74e7fc" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>college</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="99">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">Room.Board</th>
<th data-quarto-table-cell-role="th">Books</th>
<th data-quarto-table-cell-role="th">Personal</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>3300</td>
<td>450</td>
<td>2200</td>
<td>70</td>
<td>78</td>
<td>18.1</td>
<td>12</td>
<td>7041</td>
<td>60</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>6450</td>
<td>750</td>
<td>1500</td>
<td>29</td>
<td>30</td>
<td>12.2</td>
<td>16</td>
<td>10527</td>
<td>56</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>3750</td>
<td>400</td>
<td>1165</td>
<td>53</td>
<td>66</td>
<td>12.9</td>
<td>30</td>
<td>8735</td>
<td>54</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>5450</td>
<td>450</td>
<td>875</td>
<td>92</td>
<td>97</td>
<td>7.7</td>
<td>37</td>
<td>19016</td>
<td>59</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>4120</td>
<td>800</td>
<td>1500</td>
<td>76</td>
<td>72</td>
<td>11.9</td>
<td>2</td>
<td>10922</td>
<td>15</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">772</th>
<td>No</td>
<td>2197</td>
<td>1515</td>
<td>543</td>
<td>4</td>
<td>26</td>
<td>3089</td>
<td>2029</td>
<td>6797</td>
<td>3900</td>
<td>500</td>
<td>1200</td>
<td>60</td>
<td>60</td>
<td>21.0</td>
<td>14</td>
<td>4469</td>
<td>40</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">773</th>
<td>Yes</td>
<td>1959</td>
<td>1805</td>
<td>695</td>
<td>24</td>
<td>47</td>
<td>2849</td>
<td>1107</td>
<td>11520</td>
<td>4960</td>
<td>600</td>
<td>1250</td>
<td>73</td>
<td>75</td>
<td>13.3</td>
<td>31</td>
<td>9189</td>
<td>83</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">774</th>
<td>Yes</td>
<td>2097</td>
<td>1915</td>
<td>695</td>
<td>34</td>
<td>61</td>
<td>2793</td>
<td>166</td>
<td>6900</td>
<td>4200</td>
<td>617</td>
<td>781</td>
<td>67</td>
<td>75</td>
<td>14.4</td>
<td>20</td>
<td>8323</td>
<td>49</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">775</th>
<td>Yes</td>
<td>10705</td>
<td>2453</td>
<td>1317</td>
<td>95</td>
<td>99</td>
<td>5217</td>
<td>83</td>
<td>19840</td>
<td>6510</td>
<td>630</td>
<td>2115</td>
<td>96</td>
<td>96</td>
<td>5.8</td>
<td>49</td>
<td>40386</td>
<td>99</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">776</th>
<td>Yes</td>
<td>2989</td>
<td>1855</td>
<td>691</td>
<td>28</td>
<td>63</td>
<td>2988</td>
<td>1726</td>
<td>4990</td>
<td>3560</td>
<td>500</td>
<td>1250</td>
<td>75</td>
<td>75</td>
<td>18.1</td>
<td>28</td>
<td>4509</td>
<td>99</td>
</tr>
</tbody>
</table>

<p>777 rows Ã— 18 columns</p>
</div>
</div>
</div>
<p>The predictors dataframe should contain all the columns except the Apps column dedicated for the output. However, Ridge and Lasso regressions, which will be used later in this exercise entail the normalization of varaibles. Such normalization is handled as far as categorical variables are concerned as it is shown in the lab.</p>
<div id="575bdc73" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>college.Private.astype(<span class="st">'category'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>0      Yes
1      Yes
2      Yes
3      Yes
4      Yes
      ... 
772     No
773    Yes
774    Yes
775    Yes
776    Yes
Name: Private, Length: 777, dtype: category
Categories (2, object): ['No', 'Yes']</code></pre>
</div>
</div>
<section id="a-1" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="a-1"><span class="header-section-number">2.1</span> (a)</h3>
<div id="ed5cf242" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>college_train,college_test <span class="op">=</span> train_test_split(college,test_size<span class="op">=</span><span class="fl">0.5</span>,random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>college_train[<span class="st">'Private01'</span>]<span class="op">=</span>np.where(college_train[<span class="st">'Private'</span>]<span class="op">==</span><span class="st">'Yes'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>college_test[<span class="st">'Private01'</span>]<span class="op">=</span>np.where(college_test[<span class="st">'Private'</span>]<span class="op">==</span><span class="st">'Yes'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="b-1" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="b-1"><span class="header-section-number">2.2</span> (b)</h3>
<div id="4bd28bb7" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(college.columns.drop([<span class="st">'Apps'</span>,<span class="st">'Private'</span>])).fit(college)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> design.transform(college_train)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>y_train<span class="op">=</span>college_train[<span class="st">'Apps'</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>OLS(y_train,X_train).fit()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>result.summary()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="102">
<table class="simpletable caption-top table table-sm table-striped small">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Dep. Variable:</th>
<td>Apps</td>
<th data-quarto-table-cell-role="th">R-squared:</th>
<td>0.927</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model:</th>
<td>OLS</td>
<th data-quarto-table-cell-role="th">Adj. R-squared:</th>
<td>0.923</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Method:</th>
<td>Least Squares</td>
<th data-quarto-table-cell-role="th">F-statistic:</th>
<td>292.4</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date:</th>
<td>Fri, 14 Nov 2025</td>
<th data-quarto-table-cell-role="th">Prob (F-statistic):</th>
<td>4.67e-199</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Time:</th>
<td>12:48:36</td>
<th data-quarto-table-cell-role="th">Log-Likelihood:</th>
<td>-3251.6</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">No. Observations:</th>
<td>388</td>
<th data-quarto-table-cell-role="th">AIC:</th>
<td>6537.</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Df Residuals:</th>
<td>371</td>
<th data-quarto-table-cell-role="th">BIC:</th>
<td>6604.</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Df Model:</th>
<td>16</td>
<th data-quarto-table-cell-role="th"></th>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Covariance Type:</th>
<td>nonrobust</td>
<th data-quarto-table-cell-role="th"></th>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td></td>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
<th data-quarto-table-cell-role="th">[0.025</th>
<th data-quarto-table-cell-role="th">0.975]</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-1112.5384</td>
<td>552.802</td>
<td>-2.013</td>
<td>0.045</td>
<td>-2199.557</td>
<td>-25.520</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Accept</th>
<td>1.2854</td>
<td>0.068</td>
<td>18.832</td>
<td>0.000</td>
<td>1.151</td>
<td>1.420</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Enroll</th>
<td>-0.2739</td>
<td>0.253</td>
<td>-1.081</td>
<td>0.280</td>
<td>-0.772</td>
<td>0.224</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Top10perc</th>
<td>57.7756</td>
<td>8.176</td>
<td>7.067</td>
<td>0.000</td>
<td>41.699</td>
<td>73.852</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Top25perc</th>
<td>-21.9565</td>
<td>6.595</td>
<td>-3.329</td>
<td>0.001</td>
<td>-34.925</td>
<td>-8.988</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<td>0.0934</td>
<td>0.043</td>
<td>2.195</td>
<td>0.029</td>
<td>0.010</td>
<td>0.177</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<td>0.0408</td>
<td>0.040</td>
<td>1.017</td>
<td>0.310</td>
<td>-0.038</td>
<td>0.120</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Outstate</th>
<td>-0.0657</td>
<td>0.027</td>
<td>-2.474</td>
<td>0.014</td>
<td>-0.118</td>
<td>-0.013</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Room.Board</th>
<td>0.1635</td>
<td>0.072</td>
<td>2.274</td>
<td>0.024</td>
<td>0.022</td>
<td>0.305</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Books</th>
<td>-0.0654</td>
<td>0.320</td>
<td>-0.204</td>
<td>0.838</td>
<td>-0.695</td>
<td>0.564</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Personal</th>
<td>-0.0505</td>
<td>0.088</td>
<td>-0.572</td>
<td>0.568</td>
<td>-0.224</td>
<td>0.123</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">PhD</th>
<td>-8.3451</td>
<td>7.720</td>
<td>-1.081</td>
<td>0.280</td>
<td>-23.526</td>
<td>6.835</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Terminal</th>
<td>0.6134</td>
<td>8.510</td>
<td>0.072</td>
<td>0.943</td>
<td>-16.120</td>
<td>17.347</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<td>25.8068</td>
<td>17.667</td>
<td>1.461</td>
<td>0.145</td>
<td>-8.933</td>
<td>60.547</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">perc.alumni</th>
<td>-9.7264</td>
<td>6.317</td>
<td>-1.540</td>
<td>0.124</td>
<td>-22.148</td>
<td>2.695</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Expend</th>
<td>0.0809</td>
<td>0.020</td>
<td>4.079</td>
<td>0.000</td>
<td>0.042</td>
<td>0.120</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<td>10.9956</td>
<td>4.346</td>
<td>2.530</td>
<td>0.012</td>
<td>2.449</td>
<td>19.542</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Omnibus:</th>
<td>217.309</td>
<th data-quarto-table-cell-role="th">Durbin-Watson:</th>
<td>2.057</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Prob(Omnibus):</th>
<td>0.000</td>
<th data-quarto-table-cell-role="th">Jarque-Bera (JB):</th>
<td>2145.651</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Skew:</th>
<td>2.186</td>
<th data-quarto-table-cell-role="th">Prob(JB):</th>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Kurtosis:</th>
<td>13.659</td>
<th data-quarto-table-cell-role="th">Cond. No.</th>
<td>1.69e+05</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 1.69e+05. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<div id="6f7222bd" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>design_test<span class="op">=</span>MS(college.columns.drop([<span class="st">'Private'</span>,<span class="st">'Apps'</span>])).fit(college)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>X_test<span class="op">=</span>design_test.transform(college_test)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>Y_hat<span class="op">=</span>result.predict(X_test)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>MSE_ols<span class="op">=</span>np.mean((Y_hat<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the least squares linear model is '</span>,MSE_ols)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The obtained test error for the least squares linear model is  1244800.2699891704</code></pre>
</div>
</div>
</section>
<section id="c-1" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="c-1"><span class="header-section-number">2.3</span> (c)</h3>
<div id="682f90a7" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the optimal lambda for ridge regression on the training set</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>lambdas <span class="op">=</span> <span class="dv">10</span><span class="op">**</span>np.linspace(<span class="dv">8</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">100</span>) <span class="op">/</span> college[<span class="st">'Apps'</span>].std()</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'ridge__alpha'</span>: lambdas}</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>lambdas[<span class="dv">9</span>], l1_ratio<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridge)])</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pipe,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>grid.best_params_[<span class="st">'ridge__alpha'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>0.007024410108016933</code></pre>
</div>
</div>
<div id="147c8978" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>opt_lambda<span class="op">=</span>grid.best_params_[<span class="st">'ridge__alpha'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="fd906247" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the ridge regression</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ridge_opt <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>opt_lambda, l1_ratio<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>pipe_ridge <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridge_opt)])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>result_ridge<span class="op">=</span>pipe_ridge.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="6299a0ba" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Y_hat_ridge<span class="op">=</span>result_ridge.predict(X_test)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>MSE_ridge<span class="op">=</span>np.mean((Y_hat_ridge<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the ridge regression model is '</span>,MSE_ridge)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The obtained test error for the ridge regression model is  1335136.2335206056</code></pre>
</div>
</div>
</section>
<section id="d-1" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="d-1"><span class="header-section-number">2.4</span> (d)</h3>
<div id="18de2ef4" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the optimal lambda for lasso regression on the training set</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>param_grid_2 <span class="op">=</span> {<span class="st">'lasso__alpha'</span>: lambdas}</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>lasso<span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>lambdas[<span class="dv">9</span>], l1_ratio<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>pipe_2 <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'lasso'</span>, lasso)])</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>grid_2 <span class="op">=</span> skm.GridSearchCV(pipe_2,param_grid_2,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>grid_2.fit(X_train, y_train)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>opt_lambda_lasso<span class="op">=</span>grid_2.best_params_[<span class="st">'lasso__alpha'</span>]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal lmabda chosen for lasso regression is'</span>,opt_lambda_lasso )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The optimal lmabda chosen for lasso regression is 9.504362464388217</code></pre>
</div>
</div>
<div id="3132c2c3" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the lasso regression</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lasso_opt <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>opt_lambda_lasso, l1_ratio<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pipe_lasso <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'lasso'</span>, lasso_opt)])</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>result_lasso<span class="op">=</span>pipe_lasso.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="014a9a6c" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Y_hat_lasso<span class="op">=</span>result_lasso.predict(X_test)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>MSE_lasso<span class="op">=</span>np.mean((Y_hat_lasso<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the ridge regression model is '</span>,MSE_lasso)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The obtained test error for the ridge regression model is  1274819.3068367443</code></pre>
</div>
</div>
<div id="de349663" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>tuned_lasso <span class="op">=</span> pipe_lasso.named_steps[<span class="st">'lasso'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="bb2690d8" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tuned_lasso.coef_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>array([   0.        , 3116.63401003,   -0.        ,  936.41417856,
       -334.5727745 ,  335.31207055,   58.97120064, -213.10391846,
        161.37116451,   -0.        ,  -23.51599141, -105.54207564,
         -0.        ,   87.14757609, -122.71487843,  378.45990596,
        158.32546935])</code></pre>
</div>
</div>
<p>The number of non zero coefficients is 15.</p>
</section>
<section id="e-1" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="e-1"><span class="header-section-number">2.5</span> (e)</h3>
<div id="d1d48de4" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the number of components M by cross validation</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'pca__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">19</span>)}</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>pipe_pca<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pipe_pca,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>pipe_pca.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="113">
<style>#sk-container-id-7 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-7 {
  color: var(--sklearn-color-text);
}

#sk-container-id-7 pre {
  padding: 0;
}

#sk-container-id-7 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-7 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-7 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-7 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-7 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-7 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-7 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-7 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-7 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-7 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-7 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-7 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-7 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-7 div.sk-label label.sk-toggleable__label,
#sk-container-id-7 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-7 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-7 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-7 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-7 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-7 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-7 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-7 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-7 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-7 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('pca', PCA(n_components=2)),
                ('linreg', LinearRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox"><label for="sk-estimator-id-21" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('pca', PCA(n_components=2)),
                ('linreg', LinearRegression())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox"><label for="sk-estimator-id-22" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox"><label for="sk-estimator-id-23" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;PCA<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.decomposition.PCA.html">?<span>Documentation for PCA</span></a></label><div class="sk-toggleable__content fitted"><pre>PCA(n_components=2)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox"><label for="sk-estimator-id-24" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LinearRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div></div></div></div>
</div>
</div>
<div id="dfba9fe1" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="114">
<style>#sk-container-id-8 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-8 {
  color: var(--sklearn-color-text);
}

#sk-container-id-8 pre {
  padding: 0;
}

#sk-container-id-8 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-8 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-8 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-8 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-8 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-8 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-8 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-8 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-8 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-8 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-8 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-8 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-8 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-8 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-8 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-8 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-8 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-8 div.sk-label label.sk-toggleable__label,
#sk-container-id-8 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-8 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-8 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-8 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-8 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-8 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-8 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-8 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-8 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-8 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-8 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-8" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=KFold(n_splits=10, random_state=0, shuffle=True),
             estimator=Pipeline(steps=[('scaler', StandardScaler()),
                                       ('pca', PCA(n_components=2)),
                                       ('linreg', LinearRegression())]),
             param_grid={'pca__n_components': range(1, 19)},
             scoring='neg_mean_squared_error')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox"><label for="sk-estimator-id-25" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=KFold(n_splits=10, random_state=0, shuffle=True),
             estimator=Pipeline(steps=[('scaler', StandardScaler()),
                                       ('pca', PCA(n_components=2)),
                                       ('linreg', LinearRegression())]),
             param_grid={'pca__n_components': range(1, 19)},
             scoring='neg_mean_squared_error')</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox"><label for="sk-estimator-id-26" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">best_estimator_: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('pca', PCA(n_components=17)),
                ('linreg', LinearRegression())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox"><label for="sk-estimator-id-27" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox"><label for="sk-estimator-id-28" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;PCA<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.decomposition.PCA.html">?<span>Documentation for PCA</span></a></label><div class="sk-toggleable__content fitted"><pre>PCA(n_components=17)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox"><label for="sk-estimator-id-29" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LinearRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div id="1ed43db7" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>n_comp <span class="op">=</span> param_grid[<span class="st">'pca__n_components'</span>]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'num_components'</span>:n_comp,<span class="st">'CV_MSE'</span>:<span class="op">-</span>grid.cv_results_[<span class="st">'mean_test_score'</span>]})</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>M<span class="op">=</span>df[<span class="st">'CV_MSE'</span>].argmin(skipna<span class="op">=</span><span class="va">True</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>17</code></pre>
</div>
</div>
<div id="0a73f97b" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>pca_M <span class="op">=</span> PCA(n_components<span class="op">=</span>M)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>param_grid_M <span class="op">=</span> {<span class="st">'pca_M__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">19</span>)}</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>pipe_pca_M<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca_M),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>result_pca<span class="op">=</span>pipe_pca_M.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The optimal choice for the number of components is 17. The test error for the corresponding is</p>
<div id="29ae4c9e" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>Yhat_pca<span class="op">=</span>result_pca.predict(X_test)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>MSE_pca<span class="op">=</span>np.mean((Yhat_pca<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the pca model is'</span>,MSE_pca)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The obtained test error for the pca model is 1244800.2699891424</code></pre>
</div>
</div>
</section>
<section id="f-1" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="f-1"><span class="header-section-number">2.6</span> (f)</h3>
<div id="7158917a" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Initialize the fit of PLS model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pls <span class="op">=</span> PLSRegression(n_components<span class="op">=</span><span class="dv">2</span>,scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>pls.fit(X_train,y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="118">
<style>#sk-container-id-9 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-9 {
  color: var(--sklearn-color-text);
}

#sk-container-id-9 pre {
  padding: 0;
}

#sk-container-id-9 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-9 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-9 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-9 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-9 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-9 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-9 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-9 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-9 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-9 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-9 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-9 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-9 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-9 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-9 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-9 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-9 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-9 div.sk-label label.sk-toggleable__label,
#sk-container-id-9 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-9 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-9 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-9 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-9 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-9 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-9 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-9 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-9 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-9 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-9 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-9" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>PLSRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" checked=""><label for="sk-estimator-id-30" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;PLSRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.cross_decomposition.PLSRegression.html">?<span>Documentation for PLSRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>PLSRegression()</pre></div> </div></div></div></div>
</div>
</div>
<div id="e8c35d0f" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'n_components'</span>:<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">19</span>)}</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pls,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="119">
<style>#sk-container-id-10 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-10 {
  color: var(--sklearn-color-text);
}

#sk-container-id-10 pre {
  padding: 0;
}

#sk-container-id-10 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-10 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-10 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-10 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-10 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-10 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-10 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-10 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-10 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-10 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-10 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-10 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-10 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-10 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-10 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-10 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-10 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-10 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-10 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-10 div.sk-label label.sk-toggleable__label,
#sk-container-id-10 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-10 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-10 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-10 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-10 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-10 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-10 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-10 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-10 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-10 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-10 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-10 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-10 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-10" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=KFold(n_splits=10, random_state=0, shuffle=True),
             estimator=PLSRegression(),
             param_grid={'n_components': range(1, 19)},
             scoring='neg_mean_squared_error')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox"><label for="sk-estimator-id-31" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=KFold(n_splits=10, random_state=0, shuffle=True),
             estimator=PLSRegression(),
             param_grid={'n_components': range(1, 19)},
             scoring='neg_mean_squared_error')</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox"><label for="sk-estimator-id-32" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">best_estimator_: PLSRegression</label><div class="sk-toggleable__content fitted"><pre>PLSRegression(n_components=11)</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox"><label for="sk-estimator-id-33" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;PLSRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.cross_decomposition.PLSRegression.html">?<span>Documentation for PLSRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>PLSRegression(n_components=11)</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
</div>
<div id="6208e9a4" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>n_comp <span class="op">=</span> param_grid[<span class="st">'n_components'</span>]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'num_components'</span>:n_comp,<span class="st">'CV_MSE'</span>:<span class="op">-</span>grid.cv_results_[<span class="st">'mean_test_score'</span>]})</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>M<span class="op">=</span>df[<span class="st">'CV_MSE'</span>].argmin(skipna<span class="op">=</span><span class="va">True</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="120">
<pre><code>11</code></pre>
</div>
</div>
<p>The optimal choice for the number of components as fas PLS is concerned is 12.</p>
<div id="903e8495" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Refit the pls model using the optimal number of components</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>pls <span class="op">=</span> PLSRegression(n_components<span class="op">=</span>M,scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>result_pls<span class="op">=</span>pls.fit(X_train,y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="9009faf0" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>Yhat_pls<span class="op">=</span>result_pls.predict(X_test)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Y_test<span class="op">=</span>np.asarray(college_test[<span class="st">'Apps'</span>]).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>MSE_pls<span class="op">=</span>np.mean((Yhat_pls<span class="op">-</span>Y_test)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the pca model is'</span>,MSE_pls)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The obtained test error for the pca model is 26585187.858625192</code></pre>
</div>
</div>
</section>
<section id="g" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="g"><span class="header-section-number">2.7</span> (g)</h3>
<div id="7317ebd0" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's first sum up the obtained results in the previous questions</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>results_df<span class="op">=</span>pd.DataFrame({<span class="st">'Models'</span>:[<span class="st">'OLS'</span>,<span class="st">'Ridge'</span>,<span class="st">'Lasso'</span>,<span class="st">'PCR'</span>,<span class="st">'PLS'</span>],<span class="st">'Test_MSE'</span>:</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                       [MSE_ols,MSE_ridge,MSE_lasso,MSE_pca,MSE_pls]})</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>results_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Models</th>
<th data-quarto-table-cell-role="th">Test_MSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>OLS</td>
<td>1.244800e+06</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Ridge</td>
<td>1.335136e+06</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Lasso</td>
<td>1.274819e+06</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>PCR</td>
<td>1.244800e+06</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>PLS</td>
<td>2.658519e+07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>No model has a better test MSE than multiple linear regression using OLS. Hence, it is the best model.</p>
<div id="5292fdca" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Apps'</span>].mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>3001.6383526383524</code></pre>
</div>
</div>
<div id="c37b2d4c" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>RMSE<span class="op">=</span>np.sqrt(results_df[<span class="st">'Test_MSE'</span>]<span class="op">/</span>college_test.shape[<span class="dv">0</span>])</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>RMSE</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>0     56.568549
1     58.585210
2     57.246576
3     56.568549
4    261.423766
Name: Test_MSE, dtype: float64</code></pre>
</div>
</div>
<p>The RMSE of different models, showing the distance around the mean, is low in comparison with this latter. The best model (i.e the OLS model) yield a means error of +/- 57 applications at most which shows an impressively good fit.</p>
<p>All in all, the models have approximately the same values of RMSE. The maximal variation among those models is <span class="math inline">\((59.037581-56.568549)/56.568549=4.36\)</span>%</p>
</section>
</section>
<section id="exercise-10" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="exercise-10"><span class="header-section-number">3</span> Exercise 10</h2>
<section id="a-2" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="a-2"><span class="header-section-number">3.1</span> (a)</h3>
<div id="96582496" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.DataFrame(np.random.normal(size<span class="op">=</span>(<span class="dv">1000</span>, <span class="dv">20</span>)))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>column_names<span class="op">=</span>[<span class="st">'X'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)]<span class="co">#Rename the columns because ModelSpec gets confused </span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># when column names are integers</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>X.columns<span class="op">=</span>column_names</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="bf4351b1" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>epsilon<span class="op">=</span>np.random.normal(<span class="dv">1000</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="004f81ab" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span>np.zeros(<span class="dv">20</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>Non_null<span class="op">=</span>[<span class="dv">20</span>,<span class="dv">15</span>,<span class="dv">186</span>,<span class="dv">24</span>,<span class="dv">659</span>,<span class="dv">55</span>,<span class="dv">42</span>,<span class="dv">789</span>,<span class="dv">578</span>,<span class="dv">4</span>]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>j<span class="op">=</span><span class="dv">0</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's make half of beta non null</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.random.choice(<span class="bu">range</span>(<span class="dv">20</span>), size<span class="op">=</span><span class="dv">10</span>, replace<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    beta[i]<span class="op">=</span>Non_null[j]</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    j<span class="op">+=</span><span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="c14df05e" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>np.matmul(X,beta)<span class="op">+</span>epsilon</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>y_df<span class="op">=</span>pd.DataFrame({<span class="st">'Y'</span>:Y})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="b-2" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="b-2"><span class="header-section-number">3.2</span> (b)</h3>
<div id="442da3d2" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.concat([X,y_df ], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>df_train,df_test <span class="op">=</span> train_test_split(df,test_size<span class="op">=</span><span class="dv">900</span>,random_state<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="c-2" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="c-2"><span class="header-section-number">3.3</span> (c)</h3>
<div id="b597d5c4" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(df.columns.drop(<span class="st">'Y'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="f212de20" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> design.fit(df)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span>D.transform(df_train)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> D.drop(<span class="st">'intercept'</span>, axis<span class="op">=</span><span class="dv">1</span>)<span class="co">#Drop the intercept as the function fit_path used later fits the </span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># intercept separately</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> np.asarray(D)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>Y_train<span class="op">=</span>np.asarray(df_train[<span class="st">'Y'</span>])<span class="co">#Beware to check wether the number of dimensions of Y_train is 1</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cause in the opposite case, the fit_path function used next won't work</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="d57c84bc" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> fit_path <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: l0bnb module not installed. Cannot run best subset selection."</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Install with: pip install l0bnb"</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> fit_path(X_train,Y_train,max_nonzeros<span class="op">=</span>X_train.shape[<span class="dv">1</span>],intercept<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Preprocessing Data.
BnB Started.
Iteration: 1. Number of non-zeros:  1
Iteration: 2. Number of non-zeros:  1
Iteration: 3. Number of non-zeros:  2
Iteration: 4. Number of non-zeros:  2
Iteration: 5. Number of non-zeros:  3
Iteration: 6. Number of non-zeros:  3
Iteration: 7. Number of non-zeros:  3
Iteration: 8. Number of non-zeros:  3
Iteration: 9. Number of non-zeros:  5
Iteration: 10. Number of non-zeros:  5
Iteration: 11. Number of non-zeros:  5
Iteration: 12. Number of non-zeros:  6
Iteration: 13. Number of non-zeros:  6
Iteration: 14. Number of non-zeros:  6
Iteration: 15. Number of non-zeros:  6
Iteration: 16. Number of non-zeros:  6
Iteration: 17. Number of non-zeros:  6
Iteration: 18. Number of non-zeros:  6
Iteration: 19. Number of non-zeros:  6
Iteration: 20. Number of non-zeros:  7
Iteration: 21. Number of non-zeros:  7
Iteration: 22. Number of non-zeros:  7
Iteration: 23. Number of non-zeros:  7
Iteration: 24. Number of non-zeros:  12
Iteration: 25. Number of non-zeros:  12
Iteration: 26. Number of non-zeros:  12
Iteration: 27. Number of non-zeros:  12
Iteration: 28. Number of non-zeros:  12
Iteration: 29. Number of non-zeros:  12
Iteration: 30. Number of non-zeros:  12
Iteration: 31. Number of non-zeros:  12
Iteration: 32. Number of non-zeros:  12
Iteration: 33. Number of non-zeros:  12
Iteration: 34. Number of non-zeros:  12
Iteration: 35. Number of non-zeros:  12
Iteration: 36. Number of non-zeros:  12
Iteration: 37. Number of non-zeros:  12
Iteration: 38. Number of non-zeros:  12
Iteration: 39. Number of non-zeros:  18
Iteration: 40. Number of non-zeros:  19
Iteration: 41. Number of non-zeros:  20</code></pre>
</div>
</div>
<p>Based on the results of the fit_path we should compare training set MSE for the models with 1, 3, 4, 5, 6, 8, 11, 16 and 20 predictors.<br> We can choose among any interation number for every type of model, since the fit_path function does not change the regression coefficients, including the intercept coefficient, when the number of predictors remains the same.</p>
<div id="86629e1d" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize variables</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="va">None</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>pred_num <span class="op">=</span> <span class="va">None</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>coef_list <span class="op">=</span> <span class="va">None</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>MSE <span class="op">=</span> <span class="va">None</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    iteration<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">19</span>,<span class="dv">23</span>,<span class="dv">38</span>,<span class="dv">39</span>,<span class="dv">40</span>]</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    pred_num<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">20</span>]</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    coef_list<span class="op">=</span>[]</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> iteration:</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>        coef_list.append(path[i][<span class="st">'B'</span>])</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    Yhat<span class="op">=</span>[]</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        Yhat.append(np.matmul(X_train,coef_list[i]))</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    MSE<span class="op">=</span>[]</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(Yhat)):</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        MSE.append(np.mean((Yhat[i]<span class="op">-</span>Y_train)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: fit_path failed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="3eef83a8" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> MSE <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    mse_fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    ax.bar(pred_num,MSE)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Training MSE'</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="st">'Minimum MSE'</span>,(pred_num[np.argmin(MSE)],<span class="bu">min</span>(MSE)))</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot plot: MSE is not available"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter%206_files/figure-html/cell-54-output-1.png" width="998" height="961" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The minimal training MSE is indicated for 20 predictors.</p>
</section>
<section id="d-2" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="d-2"><span class="header-section-number">3.4</span> (d)</h3>
<div id="e1650fb4" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ones_test=np.ones(900).reshape(-1,1)</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    X_test<span class="op">=</span>df_test.iloc[:,:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    Y_test<span class="op">=</span>df_test[<span class="st">'Y'</span>]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    Yhat_test<span class="op">=</span>[]</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>        Yhat_test.append(np.matmul(X_test,coef_list[i]))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    MSE_test<span class="op">=</span>[]</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(Yhat_test)):</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>        MSE_test.append(np.mean((Yhat_test[i]<span class="op">-</span>Y_test)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: required variables not available"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">  Cell </span><span class="ansi-green-fg ansi-bold">In[136], line 2</span>
<span class="ansi-yellow-fg ansi-bold">    X_test=df_test.iloc[:,:-1]</span>
<span class="ansi-white-fg ansi-bold">    ^</span>
<span class="ansi-red-fg ansi-bold">IndentationError</span><span class="ansi-red-fg ansi-bold">:</span> unexpected indent
</pre>
</div>
</div>
</div>
<div id="39644f8b" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> MSE_test <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    mse_fig1, ax1 <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    ax1.bar(pred_num,MSE_test)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Test MSE'</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    ax1.annotate(<span class="st">'Minimum MSE'</span>,(pred_num[np.argmin(MSE_test)],<span class="bu">min</span>(MSE_test)))</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot plot: MSE_test is not available"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg ansi-bold">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg ansi-bold">In[137], line 1</span>
<span class="ansi-green-fg ansi-bold">----&gt; 1</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> MSE_test <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">      2</span>     mse_fig1, ax1 <span style="color:rgb(98,98,98)">=</span> subplots(figsize<span style="color:rgb(98,98,98)">=</span>(<span style="color:rgb(98,98,98)">12</span>,<span style="color:rgb(98,98,98)">12</span>))
<span class="ansi-green-fg">      3</span>     ax1<span style="color:rgb(98,98,98)">.</span>bar(pred_num,MSE_test)

<span class="ansi-red-fg ansi-bold">NameError</span>: name 'MSE_test' is not defined</pre>
</div>
</div>
</div>
</section>
<section id="e-2" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="e-2"><span class="header-section-number">3.5</span> (e)</h3>
<div id="a3635d0b" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>path[<span class="dv">4</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="138">
<pre><code>{'B': array([  0.        ,   0.        ,   0.        ,   0.        ,
          0.        ,   0.        , 549.9725458 ,   0.        ,
          0.        ,   0.        ,   0.        ,   0.        ,
          0.        ,   0.        , 932.67279087,   0.        ,
          0.        ,   0.        ,   0.        , 681.63595721]),
 'B0': 0.0,
 'lambda_0': 0.0575990319634168,
 'M': 0.6788217609522449,
 'Time_exceeded': False}</code></pre>
</div>
</div>
</section>
<section id="f-2" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="f-2"><span class="header-section-number">3.6</span> (f)</h3>
<div id="f764976f" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    coefficients<span class="op">=</span>[<span class="st">'Beta'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)]</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    comparison<span class="op">=</span>pd.DataFrame({<span class="st">'Coef'</span>:coefficients,<span class="st">'True model'</span>:beta,<span class="st">'Simulated model'</span>:path[<span class="dv">4</span>][<span class="st">'B'</span>]})</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    comparison.set_index(<span class="st">'Coef'</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: path not available"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="2379e9b0" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        y.append(np.sqrt(np.<span class="bu">sum</span>((beta<span class="op">-</span>path[i][<span class="st">'B'</span>])<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: path not available"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="219fd780" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>ax.bar(pred_num,y)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Coefficients erros'</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">'Minimum error'</span>,(pred_num[np.argmin(y)],<span class="bu">min</span>(y)))<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter%206_files/figure-html/cell-60-output-1.png" width="965" height="947" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The minimum error occurs for the model with 6 predictors, while the best model is obtained with 3 predictors.<br> Hence, a better fit of coefficients does not guarantee the lowest test MSE.</p>
</section>
</section>
<section id="exercise-11" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="exercise-11"><span class="header-section-number">4</span> Exercise 11</h2>
<div id="1d4024c3" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>Boston<span class="op">=</span>load_data(<span class="st">'Boston'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="53869b12" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>Boston.columns</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="143">
<pre><code>Index(['crim', 'zn', 'indus', 'chas', 'nox', 'rm', 'age', 'dis', 'rad', 'tax',
       'ptratio', 'lstat', 'medv'],
      dtype='object')</code></pre>
</div>
</div>
<div id="186edbb7" class="cell" data-execution_count="62">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>Boston[<span class="st">'crim'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="8a1ec90f" class="cell" data-execution_count="63">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>df_train,df_test <span class="op">=</span> train_test_split(Boston,test_size<span class="op">=</span><span class="fl">0.5</span>,random_state<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="567e1824" class="cell" data-execution_count="64">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#X_train=df_train.iloc[:,1:]</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>y_train<span class="op">=</span>df_train[<span class="st">'crim'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="4fe79fe5" class="cell" data-execution_count="65">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>X_test<span class="op">=</span>df_test.iloc[:,<span class="dv">1</span>:]</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>y_test<span class="op">=</span>df_test[<span class="st">'crim'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="32510c54" class="cell" data-execution_count="66">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>Boston.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 506 entries, 0 to 505
Data columns (total 13 columns):
 #   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   crim     506 non-null    float64
 1   zn       506 non-null    float64
 2   indus    506 non-null    float64
 3   chas     506 non-null    int64  
 4   nox      506 non-null    float64
 5   rm       506 non-null    float64
 6   age      506 non-null    float64
 7   dis      506 non-null    float64
 8   rad      506 non-null    int64  
 9   tax      506 non-null    int64  
 10  ptratio  506 non-null    float64
 11  lstat    506 non-null    float64
 12  medv     506 non-null    float64
dtypes: float64(10), int64(3)
memory usage: 51.5 KB</code></pre>
</div>
</div>
<section id="a-3" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="a-3"><span class="header-section-number">4.1</span> (a)</h3>
<div id="55291e9d" class="cell" data-execution_count="67">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Best subset selection</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>design<span class="op">=</span>MS(Boston.columns.drop(<span class="st">'crim'</span>)).fit(Boston)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span>design.transform(df_train)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> D.drop(<span class="st">'intercept'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>X_train<span class="op">=</span>np.asarray(D)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>Y_train<span class="op">=</span>np.asarray(y_train)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> fit_path(X_train,Y_train,max_nonzeros<span class="op">=</span>X_train.shape[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Preprocessing Data.
BnB Started.
Iteration: 1. Number of non-zeros:  1
Iteration: 2. Number of non-zeros:  2
Iteration: 3. Number of non-zeros:  8
Iteration: 4. Number of non-zeros:  8
Iteration: 5. Number of non-zeros:  11
Iteration: 6. Number of non-zeros:  12</code></pre>
</div>
</div>
<div id="ce85adb3" class="cell" data-execution_count="68">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>ones<span class="op">=</span>np.ones(X_test.shape[<span class="dv">0</span>]).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>np.append(X_test,ones,axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="b5d3df98" class="cell" data-execution_count="69">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>iteration<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>pred_num<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>]</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>coef_list<span class="op">=</span>[]</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> iteration:</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#construct a list of arrays. Each array contains the subsets coefficients </span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    coef_list.append(np.append(path[i][<span class="st">'B'</span>],path[i][<span class="st">'B0'</span>]))</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>Yhat<span class="op">=</span>[]</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    Yhat.append(np.matmul(a,coef_list[i]))</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>MSE<span class="op">=</span>[]</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(Yhat)):</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>    MSE.append(np.sqrt(np.mean((Yhat[i]<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="0030966d" class="cell" data-execution_count="70">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>mse_fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>ax.bar(pred_num,MSE)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Test MSE'</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">'Minimum MSE'</span>,(pred_num[np.argmin(MSE)],<span class="bu">min</span>(MSE)))<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter%206_files/figure-html/cell-71-output-1.png" width="948" height="947" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The best subset selection method yields a model with two features.</p>
<div id="145ef49b" class="cell" data-execution_count="71">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso regression</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking for the optimal value of lambda first by cross validation</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>design<span class="op">=</span>MS(Boston.columns.drop(<span class="st">'crim'</span>)).fit(Boston)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span>design.transform(df_train)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>X_train<span class="op">=</span>np.asarray(D)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>lassoCV <span class="op">=</span> skl.ElasticNetCV(n_alphas<span class="op">=</span><span class="dv">100</span>,l1_ratio<span class="op">=</span><span class="dv">1</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>pipeCV <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler),(<span class="st">'lasso'</span>, lassoCV)])</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>pipeCV.fit(X_train, y_train)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>tuned_lasso <span class="op">=</span> pipeCV.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal value of lambda is:'</span>,tuned_lasso.alpha_)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The optimal value of lambda is: 0.09984441797666821</code></pre>
</div>
</div>
<div id="6ef974cb" class="cell" data-execution_count="72">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>tuned_lasso.coef_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="154">
<pre><code>array([ 0.        ,  0.77398639, -0.53322203, -0.01464093, -0.        ,
        1.17122143, -0.56193997, -1.32765542,  4.25091987, -0.        ,
       -0.23738142,  1.61413872, -2.00601934])</code></pre>
</div>
</div>
<div id="01e56cce" class="cell" data-execution_count="73">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>X_test<span class="op">=</span>design.transform(df_test)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>Yhat_lasso<span class="op">=</span>tuned_lasso.predict(X_test)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>MSE_lasso<span class="op">=</span>np.sqrt(np.mean((Yhat_lasso<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="1d49b126" class="cell" data-execution_count="74">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the optimal lambda for ridge regression on the training set</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>lambdas <span class="op">=</span> <span class="dv">10</span><span class="op">**</span>np.linspace(<span class="dv">8</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">100</span>) <span class="op">/</span> Y.std()</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'ridge__alpha'</span>: lambdas}</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>ridgeCV <span class="op">=</span> skl.ElasticNetCV(alphas<span class="op">=</span>lambdas, l1_ratio<span class="op">=</span><span class="dv">0</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridgeCV)])</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">#grid = skm.GridSearchCV(pipe,param_grid,cv=kfold,scoring='neg_mean_squared_error')</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>pipe.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="156">
<style>#sk-container-id-11 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-11 {
  color: var(--sklearn-color-text);
}

#sk-container-id-11 pre {
  padding: 0;
}

#sk-container-id-11 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-11 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-11 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-11 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-11 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-11 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-11 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-11 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-11 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-11 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-11 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-11 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-11 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-11 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-11 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-11 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-11 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-11 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-11 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-11 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-11 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-11 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-11 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-11 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-11 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-11 div.sk-label label.sk-toggleable__label,
#sk-container-id-11 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-11 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-11 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-11 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-11 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-11 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-11 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-11 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-11 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-11 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-11 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-11 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-11 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-11" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('scaler', StandardScaler()),
                ('ridge',
                 ElasticNetCV(alphas=array([1.16258182e+07, 9.21326214e+06, 7.30135268e+06, 5.78619713e+06,
       4.58546228e+06, 3.63390043e+06, 2.87980395e+06, 2.28219538e+06,
       1.80860081e+06, 1.43328521e+06, 1.13585402e+06, 9.00144885e+05,
       7.13349427e+05, 5.65317222e+05, 4.48004230e+05, 3.55035691e+05,
       2.81359713e+05, 2.22972761e+05,...
       9.65195855e-02, 7.64901209e-02, 6.06171127e-02, 4.80380251e-02,
       3.80693134e-02, 3.01692798e-02, 2.39086383e-02, 1.89471870e-02,
       1.50153217e-02, 1.18993856e-02, 9.43005961e-03, 7.47316097e-03,
       5.92235227e-03, 4.69336289e-03, 3.71940983e-03, 2.94756868e-03,
       2.33589777e-03, 1.85115903e-03, 1.46701188e-03, 1.16258182e-03]),
                              cv=KFold(n_splits=5, random_state=0, shuffle=True),
                              l1_ratio=0))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox"><label for="sk-estimator-id-34" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('scaler', StandardScaler()),
                ('ridge',
                 ElasticNetCV(alphas=array([1.16258182e+07, 9.21326214e+06, 7.30135268e+06, 5.78619713e+06,
       4.58546228e+06, 3.63390043e+06, 2.87980395e+06, 2.28219538e+06,
       1.80860081e+06, 1.43328521e+06, 1.13585402e+06, 9.00144885e+05,
       7.13349427e+05, 5.65317222e+05, 4.48004230e+05, 3.55035691e+05,
       2.81359713e+05, 2.22972761e+05,...
       9.65195855e-02, 7.64901209e-02, 6.06171127e-02, 4.80380251e-02,
       3.80693134e-02, 3.01692798e-02, 2.39086383e-02, 1.89471870e-02,
       1.50153217e-02, 1.18993856e-02, 9.43005961e-03, 7.47316097e-03,
       5.92235227e-03, 4.69336289e-03, 3.71940983e-03, 2.94756868e-03,
       2.33589777e-03, 1.85115903e-03, 1.46701188e-03, 1.16258182e-03]),
                              cv=KFold(n_splits=5, random_state=0, shuffle=True),
                              l1_ratio=0))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox"><label for="sk-estimator-id-35" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox"><label for="sk-estimator-id-36" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;ElasticNetCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.ElasticNetCV.html">?<span>Documentation for ElasticNetCV</span></a></label><div class="sk-toggleable__content fitted"><pre>ElasticNetCV(alphas=array([1.16258182e+07, 9.21326214e+06, 7.30135268e+06, 5.78619713e+06,
       4.58546228e+06, 3.63390043e+06, 2.87980395e+06, 2.28219538e+06,
       1.80860081e+06, 1.43328521e+06, 1.13585402e+06, 9.00144885e+05,
       7.13349427e+05, 5.65317222e+05, 4.48004230e+05, 3.55035691e+05,
       2.81359713e+05, 2.22972761e+05, 1.76702100e+05, 1.40033392e+05,
       1.10974069e+05, 8.794505...
       9.65195855e-02, 7.64901209e-02, 6.06171127e-02, 4.80380251e-02,
       3.80693134e-02, 3.01692798e-02, 2.39086383e-02, 1.89471870e-02,
       1.50153217e-02, 1.18993856e-02, 9.43005961e-03, 7.47316097e-03,
       5.92235227e-03, 4.69336289e-03, 3.71940983e-03, 2.94756868e-03,
       2.33589777e-03, 1.85115903e-03, 1.46701188e-03, 1.16258182e-03]),
             cv=KFold(n_splits=5, random_state=0, shuffle=True), l1_ratio=0)</pre></div> </div></div></div></div></div></div>
</div>
</div>
<div id="8bd2be2d" class="cell" data-execution_count="75">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>tuned_ridge <span class="op">=</span> pipe.named_steps[<span class="st">'ridge'</span>]</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>tuned_ridge.alpha_</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="157">
<pre><code>0.09651958548904012</code></pre>
</div>
</div>
<div id="7d0f29b3" class="cell" data-execution_count="76">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the ridge regression</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>opt_lambda<span class="op">=</span>tuned_ridge.alpha_</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>ridge_opt <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>opt_lambda, l1_ratio<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>pipe_ridge <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridge_opt)])</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>result_ridge<span class="op">=</span>pipe_ridge.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="07b46bd2" class="cell" data-execution_count="77">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>Y_hat_ridge<span class="op">=</span>result_ridge.predict(X_test)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>MSE_ridge<span class="op">=</span>np.sqrt(np.mean((Y_hat_ridge<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="ed7eaff4" class="cell" data-execution_count="78">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PCR regression</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'pca__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>)}</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>pipe_pca<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pipe_pca,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>pipe_pca.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="160">
<style>#sk-container-id-12 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-12 {
  color: var(--sklearn-color-text);
}

#sk-container-id-12 pre {
  padding: 0;
}

#sk-container-id-12 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-12 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-12 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-12 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-12 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-12 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-12 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-12 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-12 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-12 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-12 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-12 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-12 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-12 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-12 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-12 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-12 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-12 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-12 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-12 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-12 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-12 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-12 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-12 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-12 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-12 div.sk-label label.sk-toggleable__label,
#sk-container-id-12 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-12 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-12 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-12 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-12 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-12 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-12 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-12 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-12 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-12 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-12 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-12 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-12 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-12" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('pca', PCA(n_components=2)),
                ('linreg', LinearRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox"><label for="sk-estimator-id-37" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('scaler', StandardScaler()), ('pca', PCA(n_components=2)),
                ('linreg', LinearRegression())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox"><label for="sk-estimator-id-38" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox"><label for="sk-estimator-id-39" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;PCA<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.decomposition.PCA.html">?<span>Documentation for PCA</span></a></label><div class="sk-toggleable__content fitted"><pre>PCA(n_components=2)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox"><label for="sk-estimator-id-40" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LinearRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div></div></div></div>
</div>
</div>
<div id="e7220c9f" class="cell" data-execution_count="79">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>n_comp <span class="op">=</span> param_grid[<span class="st">'pca__n_components'</span>]</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'num_components'</span>:n_comp,<span class="st">'CV_MSE'</span>:<span class="op">-</span>grid.cv_results_[<span class="st">'mean_test_score'</span>]})</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>M<span class="op">=</span>df[<span class="st">'CV_MSE'</span>].argmin(skipna<span class="op">=</span><span class="va">True</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="161">
<pre><code>9</code></pre>
</div>
</div>
<div id="74433eaa" class="cell" data-execution_count="80">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>pca_M <span class="op">=</span> PCA(n_components<span class="op">=</span>M)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>param_grid_M <span class="op">=</span> {<span class="st">'pca_M__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>)}</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>pipe_pca_M<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca_M),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>result_pca<span class="op">=</span>pipe_pca_M.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="45237c4a" class="cell" data-execution_count="81">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>Yhat_pca<span class="op">=</span>result_pca.predict(X_test)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>MSE_pca<span class="op">=</span>np.sqrt(np.mean((Yhat_pca<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="a9e11e2c" class="cell" data-execution_count="82">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's sum up the obtained results</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>df_results<span class="op">=</span>pd.DataFrame({<span class="st">'Method'</span>:[<span class="st">'Best subset'</span>,<span class="st">'Lasso'</span>,<span class="st">'Ridge'</span>,<span class="st">'PCR'</span>],<span class="st">'Test MSE'</span>:</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                         [<span class="bu">min</span>(MSE),MSE_lasso,MSE_ridge,MSE_pca]})</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>df_results.set_index(<span class="st">'Method'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="164">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Test MSE</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Method</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Best subset</th>
<td>5.868555</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Lasso</th>
<td>46.149771</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ridge</th>
<td>5.865669</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">PCR</th>
<td>5.985309</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="b-3" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="b-3"><span class="header-section-number">4.2</span> (b)</h3>
<p>Based on the previous comparison of test MSEs, both the ridge regression on full model and the best subset selction are preferred.</p>
</section>
<section id="c-3" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="c-3"><span class="header-section-number">4.3</span> (c)</h3>
<p>It is more preferable to choose the model obtained with the best subset selection because it is more interpretable than the Ridge regression.<br> The chosen model involves then 2 features.</p>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb114" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Statistical Learning Analysis Report"</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Chapter 6: ISLR2 Exercise Solutions"</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Shad Ali Shah and Atta ur rehman and Naveed"</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 3</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a><span class="co">    colorlinks: true</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a><span class="co">    link-citations: true</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-cap-location: bottom</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a><span class="co">    tbl-cap-location: top</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a><span class="co">    crossref:</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a><span class="co">      fig-title: "Figure"</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a><span class="co">      tbl-title: "Table"</span></span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a><span class="co">      fig-prefix: "Fig."</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a><span class="co">      tbl-prefix: "Table"</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a><span class="co">  error: true</span></span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a><span class="co">  keep-going: true</span></span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-width: 6.5</span></span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-height: 4</span></span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-39"><a href="#cb114-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-40"><a href="#cb114-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-41"><a href="#cb114-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-42"><a href="#cb114-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8</span></span>
<span id="cb114-43"><a href="#cb114-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-44"><a href="#cb114-44" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb114-45"><a href="#cb114-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-48"><a href="#cb114-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-49"><a href="#cb114-49" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb114-50"><a href="#cb114-50" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb114-51"><a href="#cb114-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots</span>
<span id="cb114-52"><a href="#cb114-52" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.api <span class="im">import</span> OLS</span>
<span id="cb114-53"><a href="#cb114-53" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.model_selection <span class="im">as</span> skm</span>
<span id="cb114-54"><a href="#cb114-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.linear_model <span class="im">as</span> skl</span>
<span id="cb114-55"><a href="#cb114-55" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb114-56"><a href="#cb114-56" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb114-57"><a href="#cb114-57" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> ModelSpec <span class="im">as</span> MS</span>
<span id="cb114-58"><a href="#cb114-58" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb114-59"><a href="#cb114-59" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb114-60"><a href="#cb114-60" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb114-61"><a href="#cb114-61" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cross_decomposition <span class="im">import</span> PLSRegression</span>
<span id="cb114-62"><a href="#cb114-62" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> <span class="op">\</span></span>
<span id="cb114-63"><a href="#cb114-63" aria-hidden="true" tabindex="-1"></a>     (Stepwise,</span>
<span id="cb114-64"><a href="#cb114-64" aria-hidden="true" tabindex="-1"></a>      sklearn_selected,</span>
<span id="cb114-65"><a href="#cb114-65" aria-hidden="true" tabindex="-1"></a>      sklearn_selection_path)</span>
<span id="cb114-66"><a href="#cb114-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-67"><a href="#cb114-67" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb114-68"><a href="#cb114-68" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> l0bnb <span class="im">import</span> fit_path</span>
<span id="cb114-69"><a href="#cb114-69" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ModuleNotFoundError</span>:</span>
<span id="cb114-70"><a href="#cb114-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Warning: l0bnb module not found. Install it with: pip install l0bnb"</span>)</span>
<span id="cb114-71"><a href="#cb114-71" aria-hidden="true" tabindex="-1"></a>    fit_path <span class="op">=</span> <span class="va">None</span></span>
<span id="cb114-72"><a href="#cb114-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-73"><a href="#cb114-73" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb114-74"><a href="#cb114-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-75"><a href="#cb114-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-78"><a href="#cb114-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-79"><a href="#cb114-79" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">100</span>)</span>
<span id="cb114-80"><a href="#cb114-80" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span><span class="dv">100</span></span>
<span id="cb114-81"><a href="#cb114-81" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="dv">0</span>,scale<span class="op">=</span><span class="dv">1</span>,size<span class="op">=</span>n)</span>
<span id="cb114-82"><a href="#cb114-82" aria-hidden="true" tabindex="-1"></a>epsilon<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="dv">0</span>,scale<span class="op">=</span><span class="dv">1</span>,size<span class="op">=</span>n)</span>
<span id="cb114-83"><a href="#cb114-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-84"><a href="#cb114-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-85"><a href="#cb114-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb114-86"><a href="#cb114-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-89"><a href="#cb114-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-90"><a href="#cb114-90" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span>np.array([<span class="fl">0.2</span>,<span class="dv">1</span>,<span class="fl">1.5</span>,<span class="dv">4</span>])</span>
<span id="cb114-91"><a href="#cb114-91" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>beta[<span class="dv">0</span>]<span class="op">+</span>beta[<span class="dv">1</span>]<span class="op">*</span>X<span class="op">+</span>beta[<span class="dv">2</span>]<span class="op">*</span>X<span class="op">**</span><span class="dv">2</span><span class="op">+</span>beta[<span class="dv">3</span>]<span class="op">*</span>X<span class="op">**</span><span class="dv">3</span><span class="op">+</span>epsilon</span>
<span id="cb114-92"><a href="#cb114-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-93"><a href="#cb114-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-94"><a href="#cb114-94" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb114-95"><a href="#cb114-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-98"><a href="#cb114-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-99"><a href="#cb114-99" aria-hidden="true" tabindex="-1"></a>Xs<span class="op">=</span>pd.DataFrame({<span class="st">'X'</span>:X,<span class="st">'X2'</span>:X<span class="op">**</span><span class="dv">2</span>,<span class="st">'X3'</span>:X<span class="op">**</span><span class="dv">3</span>,<span class="st">'X4'</span>:X<span class="op">**</span><span class="dv">4</span>,<span class="st">'X5'</span>:X<span class="op">**</span><span class="dv">5</span>,<span class="st">'X6'</span>:X<span class="op">**</span><span class="dv">6</span>,<span class="st">'X7'</span>:X<span class="op">**</span><span class="dv">7</span>,<span class="st">'X8'</span>:X<span class="op">**</span><span class="dv">8</span></span>
<span id="cb114-100"><a href="#cb114-100" aria-hidden="true" tabindex="-1"></a>                ,<span class="st">'X9'</span>:X<span class="op">**</span><span class="dv">9</span>,<span class="st">'X10'</span>:X<span class="op">**</span><span class="dv">10</span>})</span>
<span id="cb114-101"><a href="#cb114-101" aria-hidden="true" tabindex="-1"></a>Ys<span class="op">=</span>pd.DataFrame({<span class="st">'Y'</span>:Y})</span>
<span id="cb114-102"><a href="#cb114-102" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> nCp(sigma2, estimator, Xsigma, Ysigma):</span>
<span id="cb114-103"><a href="#cb114-103" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Negative Cp statistic"</span></span>
<span id="cb114-104"><a href="#cb114-104" aria-hidden="true" tabindex="-1"></a>    n, p <span class="op">=</span> Xsigma.shape</span>
<span id="cb114-105"><a href="#cb114-105" aria-hidden="true" tabindex="-1"></a>    Yhat <span class="op">=</span> estimator.predict(Xsigma)</span>
<span id="cb114-106"><a href="#cb114-106" aria-hidden="true" tabindex="-1"></a>    RSS <span class="op">=</span> np.<span class="bu">sum</span>((Ysigma <span class="op">-</span> Yhat)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb114-107"><a href="#cb114-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>(RSS <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> p <span class="op">*</span> sigma2) <span class="op">/</span> n <span class="co">#We look for the negative Cp since the sklearn methods try to </span></span>
<span id="cb114-108"><a href="#cb114-108" aria-hidden="true" tabindex="-1"></a><span class="co">#maximize the ouputs</span></span>
<span id="cb114-109"><a href="#cb114-109" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's now compute the residual variance sigma2. i.e, the variance of the residuals of </span></span>
<span id="cb114-110"><a href="#cb114-110" aria-hidden="true" tabindex="-1"></a><span class="co">#the complete model</span></span>
<span id="cb114-111"><a href="#cb114-111" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(Xs).fit(Xs)</span>
<span id="cb114-112"><a href="#cb114-112" aria-hidden="true" tabindex="-1"></a>Ysigma <span class="op">=</span> np.array(Ys[<span class="st">'Y'</span>])</span>
<span id="cb114-113"><a href="#cb114-113" aria-hidden="true" tabindex="-1"></a>Xsigma <span class="op">=</span> design.transform(Xs)</span>
<span id="cb114-114"><a href="#cb114-114" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>OLS(Ysigma,Xsigma).fit()</span>
<span id="cb114-115"><a href="#cb114-115" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> model.scale<span class="co">#The result should be close enough to 1 because the beta </span></span>
<span id="cb114-116"><a href="#cb114-116" aria-hidden="true" tabindex="-1"></a><span class="co">#coefficients are close too and the Xs columns are generated from a standard normal distribution</span></span>
<span id="cb114-117"><a href="#cb114-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-118"><a href="#cb114-118" aria-hidden="true" tabindex="-1"></a><span class="co">#Now we should specify the strategy for the selection of the best model. For this we gonna use </span></span>
<span id="cb114-119"><a href="#cb114-119" aria-hidden="true" tabindex="-1"></a><span class="co">#Stepwise.first_peak() method available in ISLP library</span></span>
<span id="cb114-120"><a href="#cb114-120" aria-hidden="true" tabindex="-1"></a>strategy<span class="op">=</span>Stepwise.first_peak(design,direction<span class="op">=</span><span class="st">'forward'</span>,max_terms<span class="op">=</span><span class="bu">len</span>(design.terms))</span>
<span id="cb114-121"><a href="#cb114-121" aria-hidden="true" tabindex="-1"></a><span class="co">#Now it's time to fit a linear regression model using the strategy and the sklearn_selected() from</span></span>
<span id="cb114-122"><a href="#cb114-122" aria-hidden="true" tabindex="-1"></a><span class="co">#the ISLP.models package. But before we should freeze the first argument </span></span>
<span id="cb114-123"><a href="#cb114-123" aria-hidden="true" tabindex="-1"></a>neg_Cp <span class="op">=</span> partial(nCp,sigma2) </span>
<span id="cb114-124"><a href="#cb114-124" aria-hidden="true" tabindex="-1"></a>Y_Cp<span class="op">=</span> sklearn_selected(OLS,strategy,scoring<span class="op">=</span>neg_Cp)</span>
<span id="cb114-125"><a href="#cb114-125" aria-hidden="true" tabindex="-1"></a>Y_Cp.fit(Xsigma, Ysigma)</span>
<span id="cb114-126"><a href="#cb114-126" aria-hidden="true" tabindex="-1"></a>Y_Cp.selected_state_</span>
<span id="cb114-127"><a href="#cb114-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-128"><a href="#cb114-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-129"><a href="#cb114-129" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb114-130"><a href="#cb114-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-133"><a href="#cb114-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-134"><a href="#cb114-134" aria-hidden="true" tabindex="-1"></a>strategy_backward<span class="op">=</span>Stepwise.first_peak(design,direction<span class="op">=</span><span class="st">'backwards'</span>,max_terms<span class="op">=</span><span class="bu">len</span>(design.terms))</span>
<span id="cb114-135"><a href="#cb114-135" aria-hidden="true" tabindex="-1"></a>neg_Cp1 <span class="op">=</span> partial(nCp,sigma2) </span>
<span id="cb114-136"><a href="#cb114-136" aria-hidden="true" tabindex="-1"></a>Y_CpB<span class="op">=</span> sklearn_selected(OLS,strategy_backward,scoring<span class="op">=</span>neg_Cp1)</span>
<span id="cb114-137"><a href="#cb114-137" aria-hidden="true" tabindex="-1"></a>Y_CpB.fit(Xsigma, Ysigma)</span>
<span id="cb114-138"><a href="#cb114-138" aria-hidden="true" tabindex="-1"></a>Y_CpB.selected_state_</span>
<span id="cb114-139"><a href="#cb114-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-140"><a href="#cb114-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-141"><a href="#cb114-141" aria-hidden="true" tabindex="-1"></a>Logically we get the same results as for forward stepwise selection. As a reminder the choice of X, X2 and X3 does not mean that the related regression coefficients are significant as regularization methods merely suggest candidates for the optimal model.</span>
<span id="cb114-142"><a href="#cb114-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-143"><a href="#cb114-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb114-144"><a href="#cb114-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-147"><a href="#cb114-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-148"><a href="#cb114-148" aria-hidden="true" tabindex="-1"></a><span class="co">#No need to standardise Xs columns because they already stem from standard normal distribution</span></span>
<span id="cb114-149"><a href="#cb114-149" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> design.fit_transform(Xs)</span>
<span id="cb114-150"><a href="#cb114-150" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> np.asarray(D)</span>
<span id="cb114-151"><a href="#cb114-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Since we want to use a Lasso model there is no need to specify a grid of lambdas. These will be</span></span>
<span id="cb114-152"><a href="#cb114-152" aria-hidden="true" tabindex="-1"></a><span class="co"># be generated automatically</span></span>
<span id="cb114-153"><a href="#cb114-153" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-154"><a href="#cb114-154" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb114-155"><a href="#cb114-155" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-156"><a href="#cb114-156" aria-hidden="true" tabindex="-1"></a>lassoCV <span class="op">=</span> skl.ElasticNetCV(n_alphas<span class="op">=</span><span class="dv">100</span>,l1_ratio<span class="op">=</span><span class="dv">1</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb114-157"><a href="#cb114-157" aria-hidden="true" tabindex="-1"></a>pipeCV <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler),(<span class="st">'lasso'</span>, lassoCV)])</span>
<span id="cb114-158"><a href="#cb114-158" aria-hidden="true" tabindex="-1"></a>pipeCV.fit(X1, Ysigma)</span>
<span id="cb114-159"><a href="#cb114-159" aria-hidden="true" tabindex="-1"></a>tuned_lasso <span class="op">=</span> pipeCV.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb114-160"><a href="#cb114-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-161"><a href="#cb114-161" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal value of lambda is:'</span>,tuned_lasso.alpha_)</span>
<span id="cb114-162"><a href="#cb114-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-163"><a href="#cb114-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-166"><a href="#cb114-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-167"><a href="#cb114-167" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit a path of Lasso regressions and extract lambdas as well cause these are generated automtically</span></span>
<span id="cb114-168"><a href="#cb114-168" aria-hidden="true" tabindex="-1"></a><span class="co"># for the Lasso model case</span></span>
<span id="cb114-169"><a href="#cb114-169" aria-hidden="true" tabindex="-1"></a>lambdas, soln_array <span class="op">=</span> skl.Lasso.path(Xsigma,Ysigma,l1_ratio<span class="op">=</span><span class="dv">1</span>,n_alphas<span class="op">=</span><span class="dv">100</span>)[:<span class="dv">2</span>]</span>
<span id="cb114-170"><a href="#cb114-170" aria-hidden="true" tabindex="-1"></a>soln_path <span class="op">=</span> pd.DataFrame(soln_array.T,columns<span class="op">=</span>D.columns,index<span class="op">=-</span>np.log(lambdas))</span>
<span id="cb114-171"><a href="#cb114-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-172"><a href="#cb114-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-175"><a href="#cb114-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-176"><a href="#cb114-176" aria-hidden="true" tabindex="-1"></a>lassoCV_fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb114-177"><a href="#cb114-177" aria-hidden="true" tabindex="-1"></a>ax.errorbar(<span class="op">-</span>np.log(tuned_lasso.alphas_),</span>
<span id="cb114-178"><a href="#cb114-178" aria-hidden="true" tabindex="-1"></a>            tuned_lasso.mse_path_.mean(<span class="dv">1</span>),</span>
<span id="cb114-179"><a href="#cb114-179" aria-hidden="true" tabindex="-1"></a>            yerr<span class="op">=</span>tuned_lasso.mse_path_.std(<span class="dv">1</span>) <span class="op">/</span> np.sqrt(K))</span>
<span id="cb114-180"><a href="#cb114-180" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="op">-</span>np.log(tuned_lasso.alpha_), c<span class="op">=</span><span class="st">'k'</span>, ls<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb114-181"><a href="#cb114-181" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'$-</span><span class="er">\</span><span class="st">log(</span><span class="er">\</span><span class="st">lambda)$'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb114-182"><a href="#cb114-182" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Cross-validated MSE'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb114-183"><a href="#cb114-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-184"><a href="#cb114-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-187"><a href="#cb114-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-188"><a href="#cb114-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's report the corresponding coefficients of the optimal lambda chosen by cross validation</span></span>
<span id="cb114-189"><a href="#cb114-189" aria-hidden="true" tabindex="-1"></a>tuned_lasso.coef_</span>
<span id="cb114-190"><a href="#cb114-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-191"><a href="#cb114-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-192"><a href="#cb114-192" aria-hidden="true" tabindex="-1"></a>The best model according to Lasso regression contains the coefficients of $X$, $X^2$, $X^3$, $X^4$ and $X^9$. Notice that results obtained by Lasso are different than those obtained by stepwise or backward selection.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb114-193"><a href="#cb114-193" aria-hidden="true" tabindex="-1"></a>This was expected as the latter two methods are greedy algorithms and merely find a local subset, which is different for Lasso.</span>
<span id="cb114-194"><a href="#cb114-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-195"><a href="#cb114-195" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb114-196"><a href="#cb114-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-199"><a href="#cb114-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-200"><a href="#cb114-200" aria-hidden="true" tabindex="-1"></a>X.shape</span>
<span id="cb114-201"><a href="#cb114-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-202"><a href="#cb114-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-205"><a href="#cb114-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-206"><a href="#cb114-206" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span>[<span class="dv">6</span>,<span class="dv">10</span>]</span>
<span id="cb114-207"><a href="#cb114-207" aria-hidden="true" tabindex="-1"></a>Ynew<span class="op">=</span>beta[<span class="dv">0</span>]<span class="op">+</span>beta[<span class="dv">1</span>]<span class="op">*</span>X<span class="op">**</span><span class="dv">7</span><span class="op">+</span>epsilon</span>
<span id="cb114-208"><a href="#cb114-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-209"><a href="#cb114-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-212"><a href="#cb114-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-213"><a href="#cb114-213" aria-hidden="true" tabindex="-1"></a><span class="co">#Run the forward stepwise selection approach with the same predictors as the previous models</span></span>
<span id="cb114-214"><a href="#cb114-214" aria-hidden="true" tabindex="-1"></a>Ysnew<span class="op">=</span>pd.DataFrame({<span class="st">'Y'</span>:Ynew})</span>
<span id="cb114-215"><a href="#cb114-215" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(Xs).fit(Xs)</span>
<span id="cb114-216"><a href="#cb114-216" aria-hidden="true" tabindex="-1"></a>Ysigman <span class="op">=</span> np.array(Ysnew[<span class="st">'Y'</span>])</span>
<span id="cb114-217"><a href="#cb114-217" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>OLS(Ysigman,Xsigma).fit()</span>
<span id="cb114-218"><a href="#cb114-218" aria-hidden="true" tabindex="-1"></a>sigma2n <span class="op">=</span> model.scale</span>
<span id="cb114-219"><a href="#cb114-219" aria-hidden="true" tabindex="-1"></a>strategy<span class="op">=</span>Stepwise.first_peak(design,direction<span class="op">=</span><span class="st">'forward'</span>,max_terms<span class="op">=</span><span class="bu">len</span>(design.terms))</span>
<span id="cb114-220"><a href="#cb114-220" aria-hidden="true" tabindex="-1"></a>neg_Cpn <span class="op">=</span> partial(nCp,sigma2n) </span>
<span id="cb114-221"><a href="#cb114-221" aria-hidden="true" tabindex="-1"></a>Y_Cpn<span class="op">=</span> sklearn_selected(OLS,strategy,scoring<span class="op">=</span>neg_Cpn)</span>
<span id="cb114-222"><a href="#cb114-222" aria-hidden="true" tabindex="-1"></a>Y_Cpn.fit(Xsigma, Ysigman)</span>
<span id="cb114-223"><a href="#cb114-223" aria-hidden="true" tabindex="-1"></a>Y_Cpn.selected_state_</span>
<span id="cb114-224"><a href="#cb114-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-225"><a href="#cb114-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-226"><a href="#cb114-226" aria-hidden="true" tabindex="-1"></a>The forward stepwise selection approach recommands the model containing predictor $X^7$ and the intercept as the best one.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb114-227"><a href="#cb114-227" aria-hidden="true" tabindex="-1"></a>The stepwise selection seucceeded in this case to emulate the true model.</span>
<span id="cb114-228"><a href="#cb114-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-231"><a href="#cb114-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-232"><a href="#cb114-232" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's run the Lasso regrssion</span></span>
<span id="cb114-233"><a href="#cb114-233" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-234"><a href="#cb114-234" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb114-235"><a href="#cb114-235" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-236"><a href="#cb114-236" aria-hidden="true" tabindex="-1"></a>lassoCVn <span class="op">=</span> skl.ElasticNetCV(n_alphas<span class="op">=</span><span class="dv">100</span>,l1_ratio<span class="op">=</span><span class="dv">1</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb114-237"><a href="#cb114-237" aria-hidden="true" tabindex="-1"></a>pipeCVn <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler),(<span class="st">'lasso'</span>, lassoCV)])</span>
<span id="cb114-238"><a href="#cb114-238" aria-hidden="true" tabindex="-1"></a>pipeCVn.fit(X1, Ysigman)</span>
<span id="cb114-239"><a href="#cb114-239" aria-hidden="true" tabindex="-1"></a>tuned_lasson <span class="op">=</span> pipeCVn.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb114-240"><a href="#cb114-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-241"><a href="#cb114-241" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal value of lambda is:'</span>,tuned_lasso.alpha_)</span>
<span id="cb114-242"><a href="#cb114-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-243"><a href="#cb114-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-246"><a href="#cb114-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-247"><a href="#cb114-247" aria-hidden="true" tabindex="-1"></a>tuned_lasson.coef_</span>
<span id="cb114-248"><a href="#cb114-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-249"><a href="#cb114-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-250"><a href="#cb114-250" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 9</span></span>
<span id="cb114-251"><a href="#cb114-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-254"><a href="#cb114-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-255"><a href="#cb114-255" aria-hidden="true" tabindex="-1"></a>college<span class="op">=</span>load_data(<span class="st">'College'</span>)</span>
<span id="cb114-256"><a href="#cb114-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-257"><a href="#cb114-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-260"><a href="#cb114-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-261"><a href="#cb114-261" aria-hidden="true" tabindex="-1"></a>college.info()</span>
<span id="cb114-262"><a href="#cb114-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-263"><a href="#cb114-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-266"><a href="#cb114-266" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-267"><a href="#cb114-267" aria-hidden="true" tabindex="-1"></a>college</span>
<span id="cb114-268"><a href="#cb114-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-269"><a href="#cb114-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-270"><a href="#cb114-270" aria-hidden="true" tabindex="-1"></a>The predictors dataframe should contain all the columns except the Apps column dedicated for the output. However, Ridge and Lasso regressions, which will be used later in this exercise entail the normalization of varaibles. Such normalization is handled as far as categorical variables are concerned as it is shown in the lab.</span>
<span id="cb114-271"><a href="#cb114-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-274"><a href="#cb114-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-275"><a href="#cb114-275" aria-hidden="true" tabindex="-1"></a>college.Private.astype(<span class="st">'category'</span>)</span>
<span id="cb114-276"><a href="#cb114-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-277"><a href="#cb114-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-278"><a href="#cb114-278" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb114-279"><a href="#cb114-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-282"><a href="#cb114-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-283"><a href="#cb114-283" aria-hidden="true" tabindex="-1"></a>college_train,college_test <span class="op">=</span> train_test_split(college,test_size<span class="op">=</span><span class="fl">0.5</span>,random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb114-284"><a href="#cb114-284" aria-hidden="true" tabindex="-1"></a>college_train[<span class="st">'Private01'</span>]<span class="op">=</span>np.where(college_train[<span class="st">'Private'</span>]<span class="op">==</span><span class="st">'Yes'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb114-285"><a href="#cb114-285" aria-hidden="true" tabindex="-1"></a>college_test[<span class="st">'Private01'</span>]<span class="op">=</span>np.where(college_test[<span class="st">'Private'</span>]<span class="op">==</span><span class="st">'Yes'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb114-286"><a href="#cb114-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-287"><a href="#cb114-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-288"><a href="#cb114-288" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb114-289"><a href="#cb114-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-292"><a href="#cb114-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-293"><a href="#cb114-293" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(college.columns.drop([<span class="st">'Apps'</span>,<span class="st">'Private'</span>])).fit(college)</span>
<span id="cb114-294"><a href="#cb114-294" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> design.transform(college_train)</span>
<span id="cb114-295"><a href="#cb114-295" aria-hidden="true" tabindex="-1"></a>y_train<span class="op">=</span>college_train[<span class="st">'Apps'</span>]</span>
<span id="cb114-296"><a href="#cb114-296" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>OLS(y_train,X_train).fit()</span>
<span id="cb114-297"><a href="#cb114-297" aria-hidden="true" tabindex="-1"></a>result.summary()</span>
<span id="cb114-298"><a href="#cb114-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-299"><a href="#cb114-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-302"><a href="#cb114-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-303"><a href="#cb114-303" aria-hidden="true" tabindex="-1"></a>design_test<span class="op">=</span>MS(college.columns.drop([<span class="st">'Private'</span>,<span class="st">'Apps'</span>])).fit(college)</span>
<span id="cb114-304"><a href="#cb114-304" aria-hidden="true" tabindex="-1"></a>X_test<span class="op">=</span>design_test.transform(college_test)</span>
<span id="cb114-305"><a href="#cb114-305" aria-hidden="true" tabindex="-1"></a>Y_hat<span class="op">=</span>result.predict(X_test)</span>
<span id="cb114-306"><a href="#cb114-306" aria-hidden="true" tabindex="-1"></a>MSE_ols<span class="op">=</span>np.mean((Y_hat<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb114-307"><a href="#cb114-307" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the least squares linear model is '</span>,MSE_ols)</span>
<span id="cb114-308"><a href="#cb114-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-309"><a href="#cb114-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-310"><a href="#cb114-310" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb114-311"><a href="#cb114-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-314"><a href="#cb114-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-315"><a href="#cb114-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the optimal lambda for ridge regression on the training set</span></span>
<span id="cb114-316"><a href="#cb114-316" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb114-317"><a href="#cb114-317" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-318"><a href="#cb114-318" aria-hidden="true" tabindex="-1"></a>lambdas <span class="op">=</span> <span class="dv">10</span><span class="op">**</span>np.linspace(<span class="dv">8</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">100</span>) <span class="op">/</span> college[<span class="st">'Apps'</span>].std()</span>
<span id="cb114-319"><a href="#cb114-319" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'ridge__alpha'</span>: lambdas}</span>
<span id="cb114-320"><a href="#cb114-320" aria-hidden="true" tabindex="-1"></a>ridge <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>lambdas[<span class="dv">9</span>], l1_ratio<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb114-321"><a href="#cb114-321" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-322"><a href="#cb114-322" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridge)])</span>
<span id="cb114-323"><a href="#cb114-323" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pipe,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb114-324"><a href="#cb114-324" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span>
<span id="cb114-325"><a href="#cb114-325" aria-hidden="true" tabindex="-1"></a>grid.best_params_[<span class="st">'ridge__alpha'</span>]</span>
<span id="cb114-326"><a href="#cb114-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-327"><a href="#cb114-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-330"><a href="#cb114-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-331"><a href="#cb114-331" aria-hidden="true" tabindex="-1"></a>opt_lambda<span class="op">=</span>grid.best_params_[<span class="st">'ridge__alpha'</span>]</span>
<span id="cb114-332"><a href="#cb114-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-333"><a href="#cb114-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-336"><a href="#cb114-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-337"><a href="#cb114-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the ridge regression</span></span>
<span id="cb114-338"><a href="#cb114-338" aria-hidden="true" tabindex="-1"></a>ridge_opt <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>opt_lambda, l1_ratio<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb114-339"><a href="#cb114-339" aria-hidden="true" tabindex="-1"></a>pipe_ridge <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridge_opt)])</span>
<span id="cb114-340"><a href="#cb114-340" aria-hidden="true" tabindex="-1"></a>result_ridge<span class="op">=</span>pipe_ridge.fit(X_train, y_train)</span>
<span id="cb114-341"><a href="#cb114-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-342"><a href="#cb114-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-345"><a href="#cb114-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-346"><a href="#cb114-346" aria-hidden="true" tabindex="-1"></a>Y_hat_ridge<span class="op">=</span>result_ridge.predict(X_test)</span>
<span id="cb114-347"><a href="#cb114-347" aria-hidden="true" tabindex="-1"></a>MSE_ridge<span class="op">=</span>np.mean((Y_hat_ridge<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb114-348"><a href="#cb114-348" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the ridge regression model is '</span>,MSE_ridge)</span>
<span id="cb114-349"><a href="#cb114-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-350"><a href="#cb114-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-351"><a href="#cb114-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb114-352"><a href="#cb114-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-355"><a href="#cb114-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-356"><a href="#cb114-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the optimal lambda for lasso regression on the training set</span></span>
<span id="cb114-357"><a href="#cb114-357" aria-hidden="true" tabindex="-1"></a>param_grid_2 <span class="op">=</span> {<span class="st">'lasso__alpha'</span>: lambdas}</span>
<span id="cb114-358"><a href="#cb114-358" aria-hidden="true" tabindex="-1"></a>lasso<span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>lambdas[<span class="dv">9</span>], l1_ratio<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-359"><a href="#cb114-359" aria-hidden="true" tabindex="-1"></a>pipe_2 <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'lasso'</span>, lasso)])</span>
<span id="cb114-360"><a href="#cb114-360" aria-hidden="true" tabindex="-1"></a>grid_2 <span class="op">=</span> skm.GridSearchCV(pipe_2,param_grid_2,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb114-361"><a href="#cb114-361" aria-hidden="true" tabindex="-1"></a>grid_2.fit(X_train, y_train)</span>
<span id="cb114-362"><a href="#cb114-362" aria-hidden="true" tabindex="-1"></a>opt_lambda_lasso<span class="op">=</span>grid_2.best_params_[<span class="st">'lasso__alpha'</span>]</span>
<span id="cb114-363"><a href="#cb114-363" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal lmabda chosen for lasso regression is'</span>,opt_lambda_lasso )</span>
<span id="cb114-364"><a href="#cb114-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-365"><a href="#cb114-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-368"><a href="#cb114-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-369"><a href="#cb114-369" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the lasso regression</span></span>
<span id="cb114-370"><a href="#cb114-370" aria-hidden="true" tabindex="-1"></a>lasso_opt <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>opt_lambda_lasso, l1_ratio<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-371"><a href="#cb114-371" aria-hidden="true" tabindex="-1"></a>pipe_lasso <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'lasso'</span>, lasso_opt)])</span>
<span id="cb114-372"><a href="#cb114-372" aria-hidden="true" tabindex="-1"></a>result_lasso<span class="op">=</span>pipe_lasso.fit(X_train, y_train)</span>
<span id="cb114-373"><a href="#cb114-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-374"><a href="#cb114-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-377"><a href="#cb114-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-378"><a href="#cb114-378" aria-hidden="true" tabindex="-1"></a>Y_hat_lasso<span class="op">=</span>result_lasso.predict(X_test)</span>
<span id="cb114-379"><a href="#cb114-379" aria-hidden="true" tabindex="-1"></a>MSE_lasso<span class="op">=</span>np.mean((Y_hat_lasso<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb114-380"><a href="#cb114-380" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the ridge regression model is '</span>,MSE_lasso)</span>
<span id="cb114-381"><a href="#cb114-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-382"><a href="#cb114-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-385"><a href="#cb114-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-386"><a href="#cb114-386" aria-hidden="true" tabindex="-1"></a>tuned_lasso <span class="op">=</span> pipe_lasso.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb114-387"><a href="#cb114-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-388"><a href="#cb114-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-391"><a href="#cb114-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-392"><a href="#cb114-392" aria-hidden="true" tabindex="-1"></a>tuned_lasso.coef_</span>
<span id="cb114-393"><a href="#cb114-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-394"><a href="#cb114-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-395"><a href="#cb114-395" aria-hidden="true" tabindex="-1"></a>The number of non zero coefficients is 15.</span>
<span id="cb114-396"><a href="#cb114-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-397"><a href="#cb114-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb114-398"><a href="#cb114-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-401"><a href="#cb114-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-402"><a href="#cb114-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the number of components M by cross validation</span></span>
<span id="cb114-403"><a href="#cb114-403" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb114-404"><a href="#cb114-404" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb114-405"><a href="#cb114-405" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'pca__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">19</span>)}</span>
<span id="cb114-406"><a href="#cb114-406" aria-hidden="true" tabindex="-1"></a>pipe_pca<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb114-407"><a href="#cb114-407" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pipe_pca,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb114-408"><a href="#cb114-408" aria-hidden="true" tabindex="-1"></a>pipe_pca.fit(X_train, y_train)</span>
<span id="cb114-409"><a href="#cb114-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-410"><a href="#cb114-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-413"><a href="#cb114-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-414"><a href="#cb114-414" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span>
<span id="cb114-415"><a href="#cb114-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-416"><a href="#cb114-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-419"><a href="#cb114-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-420"><a href="#cb114-420" aria-hidden="true" tabindex="-1"></a>n_comp <span class="op">=</span> param_grid[<span class="st">'pca__n_components'</span>]</span>
<span id="cb114-421"><a href="#cb114-421" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'num_components'</span>:n_comp,<span class="st">'CV_MSE'</span>:<span class="op">-</span>grid.cv_results_[<span class="st">'mean_test_score'</span>]})</span>
<span id="cb114-422"><a href="#cb114-422" aria-hidden="true" tabindex="-1"></a>M<span class="op">=</span>df[<span class="st">'CV_MSE'</span>].argmin(skipna<span class="op">=</span><span class="va">True</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb114-423"><a href="#cb114-423" aria-hidden="true" tabindex="-1"></a>M</span>
<span id="cb114-424"><a href="#cb114-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-425"><a href="#cb114-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-428"><a href="#cb114-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-429"><a href="#cb114-429" aria-hidden="true" tabindex="-1"></a>pca_M <span class="op">=</span> PCA(n_components<span class="op">=</span>M)</span>
<span id="cb114-430"><a href="#cb114-430" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb114-431"><a href="#cb114-431" aria-hidden="true" tabindex="-1"></a>param_grid_M <span class="op">=</span> {<span class="st">'pca_M__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">19</span>)}</span>
<span id="cb114-432"><a href="#cb114-432" aria-hidden="true" tabindex="-1"></a>pipe_pca_M<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca_M),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb114-433"><a href="#cb114-433" aria-hidden="true" tabindex="-1"></a>result_pca<span class="op">=</span>pipe_pca_M.fit(X_train, y_train)</span>
<span id="cb114-434"><a href="#cb114-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-435"><a href="#cb114-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-436"><a href="#cb114-436" aria-hidden="true" tabindex="-1"></a>The optimal choice for the number of components is 17. The test error for the corresponding is </span>
<span id="cb114-437"><a href="#cb114-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-440"><a href="#cb114-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-441"><a href="#cb114-441" aria-hidden="true" tabindex="-1"></a>Yhat_pca<span class="op">=</span>result_pca.predict(X_test)</span>
<span id="cb114-442"><a href="#cb114-442" aria-hidden="true" tabindex="-1"></a>MSE_pca<span class="op">=</span>np.mean((Yhat_pca<span class="op">-</span>college_test[<span class="st">'Apps'</span>])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb114-443"><a href="#cb114-443" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the pca model is'</span>,MSE_pca)</span>
<span id="cb114-444"><a href="#cb114-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-445"><a href="#cb114-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-446"><a href="#cb114-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb114-447"><a href="#cb114-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-450"><a href="#cb114-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-451"><a href="#cb114-451" aria-hidden="true" tabindex="-1"></a><span class="co">#Initialize the fit of PLS model</span></span>
<span id="cb114-452"><a href="#cb114-452" aria-hidden="true" tabindex="-1"></a>pls <span class="op">=</span> PLSRegression(n_components<span class="op">=</span><span class="dv">2</span>,scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-453"><a href="#cb114-453" aria-hidden="true" tabindex="-1"></a>pls.fit(X_train,y_train)</span>
<span id="cb114-454"><a href="#cb114-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-455"><a href="#cb114-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-458"><a href="#cb114-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-459"><a href="#cb114-459" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'n_components'</span>:<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">19</span>)}</span>
<span id="cb114-460"><a href="#cb114-460" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pls,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb114-461"><a href="#cb114-461" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span>
<span id="cb114-462"><a href="#cb114-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-463"><a href="#cb114-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-466"><a href="#cb114-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-467"><a href="#cb114-467" aria-hidden="true" tabindex="-1"></a>n_comp <span class="op">=</span> param_grid[<span class="st">'n_components'</span>]</span>
<span id="cb114-468"><a href="#cb114-468" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'num_components'</span>:n_comp,<span class="st">'CV_MSE'</span>:<span class="op">-</span>grid.cv_results_[<span class="st">'mean_test_score'</span>]})</span>
<span id="cb114-469"><a href="#cb114-469" aria-hidden="true" tabindex="-1"></a>M<span class="op">=</span>df[<span class="st">'CV_MSE'</span>].argmin(skipna<span class="op">=</span><span class="va">True</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb114-470"><a href="#cb114-470" aria-hidden="true" tabindex="-1"></a>M</span>
<span id="cb114-471"><a href="#cb114-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-472"><a href="#cb114-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-473"><a href="#cb114-473" aria-hidden="true" tabindex="-1"></a>The optimal choice for the number of components as fas PLS is concerned is 12.</span>
<span id="cb114-474"><a href="#cb114-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-477"><a href="#cb114-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-478"><a href="#cb114-478" aria-hidden="true" tabindex="-1"></a><span class="co">#Refit the pls model using the optimal number of components</span></span>
<span id="cb114-479"><a href="#cb114-479" aria-hidden="true" tabindex="-1"></a>pls <span class="op">=</span> PLSRegression(n_components<span class="op">=</span>M,scale<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-480"><a href="#cb114-480" aria-hidden="true" tabindex="-1"></a>result_pls<span class="op">=</span>pls.fit(X_train,y_train)</span>
<span id="cb114-481"><a href="#cb114-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-482"><a href="#cb114-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-485"><a href="#cb114-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-486"><a href="#cb114-486" aria-hidden="true" tabindex="-1"></a>Yhat_pls<span class="op">=</span>result_pls.predict(X_test)</span>
<span id="cb114-487"><a href="#cb114-487" aria-hidden="true" tabindex="-1"></a>Y_test<span class="op">=</span>np.asarray(college_test[<span class="st">'Apps'</span>]).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb114-488"><a href="#cb114-488" aria-hidden="true" tabindex="-1"></a>MSE_pls<span class="op">=</span>np.mean((Yhat_pls<span class="op">-</span>Y_test)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb114-489"><a href="#cb114-489" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The obtained test error for the pca model is'</span>,MSE_pls)</span>
<span id="cb114-490"><a href="#cb114-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-491"><a href="#cb114-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-492"><a href="#cb114-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### (g)</span></span>
<span id="cb114-493"><a href="#cb114-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-496"><a href="#cb114-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-497"><a href="#cb114-497" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's first sum up the obtained results in the previous questions</span></span>
<span id="cb114-498"><a href="#cb114-498" aria-hidden="true" tabindex="-1"></a>results_df<span class="op">=</span>pd.DataFrame({<span class="st">'Models'</span>:[<span class="st">'OLS'</span>,<span class="st">'Ridge'</span>,<span class="st">'Lasso'</span>,<span class="st">'PCR'</span>,<span class="st">'PLS'</span>],<span class="st">'Test_MSE'</span>:</span>
<span id="cb114-499"><a href="#cb114-499" aria-hidden="true" tabindex="-1"></a>                       [MSE_ols,MSE_ridge,MSE_lasso,MSE_pca,MSE_pls]})</span>
<span id="cb114-500"><a href="#cb114-500" aria-hidden="true" tabindex="-1"></a>results_df</span>
<span id="cb114-501"><a href="#cb114-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-502"><a href="#cb114-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-503"><a href="#cb114-503" aria-hidden="true" tabindex="-1"></a>No model has a better test MSE than multiple linear regression using OLS. Hence, it is the best model.</span>
<span id="cb114-504"><a href="#cb114-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-507"><a href="#cb114-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-508"><a href="#cb114-508" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Apps'</span>].mean()</span>
<span id="cb114-509"><a href="#cb114-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-510"><a href="#cb114-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-513"><a href="#cb114-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-514"><a href="#cb114-514" aria-hidden="true" tabindex="-1"></a>RMSE<span class="op">=</span>np.sqrt(results_df[<span class="st">'Test_MSE'</span>]<span class="op">/</span>college_test.shape[<span class="dv">0</span>])</span>
<span id="cb114-515"><a href="#cb114-515" aria-hidden="true" tabindex="-1"></a>RMSE</span>
<span id="cb114-516"><a href="#cb114-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-517"><a href="#cb114-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-518"><a href="#cb114-518" aria-hidden="true" tabindex="-1"></a>The RMSE of different models, showing the distance around the mean, is low in comparison with this latter. The best model (i.e the OLS model) yield a means error of +/- 57 applications at most which shows an impressively good fit.</span>
<span id="cb114-519"><a href="#cb114-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-520"><a href="#cb114-520" aria-hidden="true" tabindex="-1"></a>All in all, the models have approximately the same values of RMSE. The maximal variation among those models is $(59.037581-56.568549)/56.568549=4.36$%</span>
<span id="cb114-521"><a href="#cb114-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-522"><a href="#cb114-522" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 10</span></span>
<span id="cb114-523"><a href="#cb114-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-524"><a href="#cb114-524" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb114-525"><a href="#cb114-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-528"><a href="#cb114-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-529"><a href="#cb114-529" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb114-530"><a href="#cb114-530" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.DataFrame(np.random.normal(size<span class="op">=</span>(<span class="dv">1000</span>, <span class="dv">20</span>)))</span>
<span id="cb114-531"><a href="#cb114-531" aria-hidden="true" tabindex="-1"></a>column_names<span class="op">=</span>[<span class="st">'X'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)]<span class="co">#Rename the columns because ModelSpec gets confused </span></span>
<span id="cb114-532"><a href="#cb114-532" aria-hidden="true" tabindex="-1"></a><span class="co"># when column names are integers</span></span>
<span id="cb114-533"><a href="#cb114-533" aria-hidden="true" tabindex="-1"></a>X.columns<span class="op">=</span>column_names</span>
<span id="cb114-534"><a href="#cb114-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-535"><a href="#cb114-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-538"><a href="#cb114-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-539"><a href="#cb114-539" aria-hidden="true" tabindex="-1"></a>epsilon<span class="op">=</span>np.random.normal(<span class="dv">1000</span>)</span>
<span id="cb114-540"><a href="#cb114-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-541"><a href="#cb114-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-544"><a href="#cb114-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-545"><a href="#cb114-545" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span>np.zeros(<span class="dv">20</span>)</span>
<span id="cb114-546"><a href="#cb114-546" aria-hidden="true" tabindex="-1"></a>Non_null<span class="op">=</span>[<span class="dv">20</span>,<span class="dv">15</span>,<span class="dv">186</span>,<span class="dv">24</span>,<span class="dv">659</span>,<span class="dv">55</span>,<span class="dv">42</span>,<span class="dv">789</span>,<span class="dv">578</span>,<span class="dv">4</span>]</span>
<span id="cb114-547"><a href="#cb114-547" aria-hidden="true" tabindex="-1"></a>j<span class="op">=</span><span class="dv">0</span></span>
<span id="cb114-548"><a href="#cb114-548" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's make half of beta non null</span></span>
<span id="cb114-549"><a href="#cb114-549" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.random.choice(<span class="bu">range</span>(<span class="dv">20</span>), size<span class="op">=</span><span class="dv">10</span>, replace<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb114-550"><a href="#cb114-550" aria-hidden="true" tabindex="-1"></a>    beta[i]<span class="op">=</span>Non_null[j]</span>
<span id="cb114-551"><a href="#cb114-551" aria-hidden="true" tabindex="-1"></a>    j<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb114-552"><a href="#cb114-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-553"><a href="#cb114-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-556"><a href="#cb114-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-557"><a href="#cb114-557" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>np.matmul(X,beta)<span class="op">+</span>epsilon</span>
<span id="cb114-558"><a href="#cb114-558" aria-hidden="true" tabindex="-1"></a>y_df<span class="op">=</span>pd.DataFrame({<span class="st">'Y'</span>:Y})</span>
<span id="cb114-559"><a href="#cb114-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-560"><a href="#cb114-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-561"><a href="#cb114-561" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb114-562"><a href="#cb114-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-565"><a href="#cb114-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-566"><a href="#cb114-566" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.concat([X,y_df ], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-567"><a href="#cb114-567" aria-hidden="true" tabindex="-1"></a>df_train,df_test <span class="op">=</span> train_test_split(df,test_size<span class="op">=</span><span class="dv">900</span>,random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb114-568"><a href="#cb114-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-569"><a href="#cb114-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-570"><a href="#cb114-570" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb114-571"><a href="#cb114-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-574"><a href="#cb114-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-575"><a href="#cb114-575" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> MS(df.columns.drop(<span class="st">'Y'</span>))</span>
<span id="cb114-576"><a href="#cb114-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-577"><a href="#cb114-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-580"><a href="#cb114-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-581"><a href="#cb114-581" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> design.fit(df)</span>
<span id="cb114-582"><a href="#cb114-582" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span>D.transform(df_train)</span>
<span id="cb114-583"><a href="#cb114-583" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> D.drop(<span class="st">'intercept'</span>, axis<span class="op">=</span><span class="dv">1</span>)<span class="co">#Drop the intercept as the function fit_path used later fits the </span></span>
<span id="cb114-584"><a href="#cb114-584" aria-hidden="true" tabindex="-1"></a><span class="co"># intercept separately</span></span>
<span id="cb114-585"><a href="#cb114-585" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> np.asarray(D)</span>
<span id="cb114-586"><a href="#cb114-586" aria-hidden="true" tabindex="-1"></a>Y_train<span class="op">=</span>np.asarray(df_train[<span class="st">'Y'</span>])<span class="co">#Beware to check wether the number of dimensions of Y_train is 1</span></span>
<span id="cb114-587"><a href="#cb114-587" aria-hidden="true" tabindex="-1"></a><span class="co"># cause in the opposite case, the fit_path function used next won't work</span></span>
<span id="cb114-588"><a href="#cb114-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-589"><a href="#cb114-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-592"><a href="#cb114-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-593"><a href="#cb114-593" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> fit_path <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb114-594"><a href="#cb114-594" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: l0bnb module not installed. Cannot run best subset selection."</span>)</span>
<span id="cb114-595"><a href="#cb114-595" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Install with: pip install l0bnb"</span>)</span>
<span id="cb114-596"><a href="#cb114-596" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-597"><a href="#cb114-597" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> fit_path(X_train,Y_train,max_nonzeros<span class="op">=</span>X_train.shape[<span class="dv">1</span>],intercept<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb114-598"><a href="#cb114-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-599"><a href="#cb114-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-600"><a href="#cb114-600" aria-hidden="true" tabindex="-1"></a>Based on the results of the fit_path we should compare training set MSE for the models with 1, 3, 4, 5, 6, 8, 11, 16 and 20 predictors.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb114-601"><a href="#cb114-601" aria-hidden="true" tabindex="-1"></a>We can choose among any interation number for every type of model, since the fit_path function does not change the regression coefficients, including the intercept coefficient, when the number of predictors remains the same.</span>
<span id="cb114-602"><a href="#cb114-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-605"><a href="#cb114-605" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-606"><a href="#cb114-606" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize variables</span></span>
<span id="cb114-607"><a href="#cb114-607" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="va">None</span></span>
<span id="cb114-608"><a href="#cb114-608" aria-hidden="true" tabindex="-1"></a>pred_num <span class="op">=</span> <span class="va">None</span></span>
<span id="cb114-609"><a href="#cb114-609" aria-hidden="true" tabindex="-1"></a>coef_list <span class="op">=</span> <span class="va">None</span></span>
<span id="cb114-610"><a href="#cb114-610" aria-hidden="true" tabindex="-1"></a>MSE <span class="op">=</span> <span class="va">None</span></span>
<span id="cb114-611"><a href="#cb114-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-612"><a href="#cb114-612" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb114-613"><a href="#cb114-613" aria-hidden="true" tabindex="-1"></a>    iteration<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">19</span>,<span class="dv">23</span>,<span class="dv">38</span>,<span class="dv">39</span>,<span class="dv">40</span>]</span>
<span id="cb114-614"><a href="#cb114-614" aria-hidden="true" tabindex="-1"></a>    pred_num<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">20</span>]</span>
<span id="cb114-615"><a href="#cb114-615" aria-hidden="true" tabindex="-1"></a>    coef_list<span class="op">=</span>[]</span>
<span id="cb114-616"><a href="#cb114-616" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> iteration:</span>
<span id="cb114-617"><a href="#cb114-617" aria-hidden="true" tabindex="-1"></a>        coef_list.append(path[i][<span class="st">'B'</span>])</span>
<span id="cb114-618"><a href="#cb114-618" aria-hidden="true" tabindex="-1"></a>    Yhat<span class="op">=</span>[]</span>
<span id="cb114-619"><a href="#cb114-619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb114-620"><a href="#cb114-620" aria-hidden="true" tabindex="-1"></a>        Yhat.append(np.matmul(X_train,coef_list[i]))</span>
<span id="cb114-621"><a href="#cb114-621" aria-hidden="true" tabindex="-1"></a>    MSE<span class="op">=</span>[]</span>
<span id="cb114-622"><a href="#cb114-622" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(Yhat)):</span>
<span id="cb114-623"><a href="#cb114-623" aria-hidden="true" tabindex="-1"></a>        MSE.append(np.mean((Yhat[i]<span class="op">-</span>Y_train)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb114-624"><a href="#cb114-624" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-625"><a href="#cb114-625" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: fit_path failed"</span>)</span>
<span id="cb114-626"><a href="#cb114-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-627"><a href="#cb114-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-630"><a href="#cb114-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-631"><a href="#cb114-631" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> MSE <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb114-632"><a href="#cb114-632" aria-hidden="true" tabindex="-1"></a>    mse_fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb114-633"><a href="#cb114-633" aria-hidden="true" tabindex="-1"></a>    ax.bar(pred_num,MSE)</span>
<span id="cb114-634"><a href="#cb114-634" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Training MSE'</span>)</span>
<span id="cb114-635"><a href="#cb114-635" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb114-636"><a href="#cb114-636" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb114-637"><a href="#cb114-637" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="st">'Minimum MSE'</span>,(pred_num[np.argmin(MSE)],<span class="bu">min</span>(MSE)))</span>
<span id="cb114-638"><a href="#cb114-638" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-639"><a href="#cb114-639" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot plot: MSE is not available"</span>)</span>
<span id="cb114-640"><a href="#cb114-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-641"><a href="#cb114-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-642"><a href="#cb114-642" aria-hidden="true" tabindex="-1"></a>The minimal training MSE is indicated for 20 predictors.</span>
<span id="cb114-643"><a href="#cb114-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-644"><a href="#cb114-644" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb114-645"><a href="#cb114-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-648"><a href="#cb114-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-649"><a href="#cb114-649" aria-hidden="true" tabindex="-1"></a><span class="co">#ones_test=np.ones(900).reshape(-1,1)</span></span>
<span id="cb114-650"><a href="#cb114-650" aria-hidden="true" tabindex="-1"></a>    X_test<span class="op">=</span>df_test.iloc[:,:<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb114-651"><a href="#cb114-651" aria-hidden="true" tabindex="-1"></a>    Y_test<span class="op">=</span>df_test[<span class="st">'Y'</span>]</span>
<span id="cb114-652"><a href="#cb114-652" aria-hidden="true" tabindex="-1"></a>    Yhat_test<span class="op">=</span>[]</span>
<span id="cb114-653"><a href="#cb114-653" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb114-654"><a href="#cb114-654" aria-hidden="true" tabindex="-1"></a>        Yhat_test.append(np.matmul(X_test,coef_list[i]))</span>
<span id="cb114-655"><a href="#cb114-655" aria-hidden="true" tabindex="-1"></a>    MSE_test<span class="op">=</span>[]</span>
<span id="cb114-656"><a href="#cb114-656" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(Yhat_test)):</span>
<span id="cb114-657"><a href="#cb114-657" aria-hidden="true" tabindex="-1"></a>        MSE_test.append(np.mean((Yhat_test[i]<span class="op">-</span>Y_test)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb114-658"><a href="#cb114-658" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-659"><a href="#cb114-659" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: required variables not available"</span>)</span>
<span id="cb114-660"><a href="#cb114-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-661"><a href="#cb114-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-664"><a href="#cb114-664" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-665"><a href="#cb114-665" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> MSE_test <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb114-666"><a href="#cb114-666" aria-hidden="true" tabindex="-1"></a>    mse_fig1, ax1 <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb114-667"><a href="#cb114-667" aria-hidden="true" tabindex="-1"></a>    ax1.bar(pred_num,MSE_test)</span>
<span id="cb114-668"><a href="#cb114-668" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'Test MSE'</span>)</span>
<span id="cb114-669"><a href="#cb114-669" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb114-670"><a href="#cb114-670" aria-hidden="true" tabindex="-1"></a>    ax1.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb114-671"><a href="#cb114-671" aria-hidden="true" tabindex="-1"></a>    ax1.annotate(<span class="st">'Minimum MSE'</span>,(pred_num[np.argmin(MSE_test)],<span class="bu">min</span>(MSE_test)))</span>
<span id="cb114-672"><a href="#cb114-672" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-673"><a href="#cb114-673" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot plot: MSE_test is not available"</span>)</span>
<span id="cb114-674"><a href="#cb114-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-675"><a href="#cb114-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-676"><a href="#cb114-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb114-677"><a href="#cb114-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-680"><a href="#cb114-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-681"><a href="#cb114-681" aria-hidden="true" tabindex="-1"></a>path[<span class="dv">4</span>]</span>
<span id="cb114-682"><a href="#cb114-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-683"><a href="#cb114-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-684"><a href="#cb114-684" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb114-685"><a href="#cb114-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-688"><a href="#cb114-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-689"><a href="#cb114-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| scrolled: true</span></span>
<span id="cb114-690"><a href="#cb114-690" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb114-691"><a href="#cb114-691" aria-hidden="true" tabindex="-1"></a>    coefficients<span class="op">=</span>[<span class="st">'Beta'</span><span class="op">+</span><span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)]</span>
<span id="cb114-692"><a href="#cb114-692" aria-hidden="true" tabindex="-1"></a>    comparison<span class="op">=</span>pd.DataFrame({<span class="st">'Coef'</span>:coefficients,<span class="st">'True model'</span>:beta,<span class="st">'Simulated model'</span>:path[<span class="dv">4</span>][<span class="st">'B'</span>]})</span>
<span id="cb114-693"><a href="#cb114-693" aria-hidden="true" tabindex="-1"></a>    comparison.set_index(<span class="st">'Coef'</span>)</span>
<span id="cb114-694"><a href="#cb114-694" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-695"><a href="#cb114-695" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: path not available"</span>)</span>
<span id="cb114-696"><a href="#cb114-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-697"><a href="#cb114-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-700"><a href="#cb114-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-701"><a href="#cb114-701" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb114-702"><a href="#cb114-702" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[]</span>
<span id="cb114-703"><a href="#cb114-703" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb114-704"><a href="#cb114-704" aria-hidden="true" tabindex="-1"></a>        y.append(np.sqrt(np.<span class="bu">sum</span>((beta<span class="op">-</span>path[i][<span class="st">'B'</span>])<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb114-705"><a href="#cb114-705" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb114-706"><a href="#cb114-706" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cannot proceed: path not available"</span>)</span>
<span id="cb114-707"><a href="#cb114-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-708"><a href="#cb114-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-711"><a href="#cb114-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-712"><a href="#cb114-712" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb114-713"><a href="#cb114-713" aria-hidden="true" tabindex="-1"></a>ax.bar(pred_num,y)</span>
<span id="cb114-714"><a href="#cb114-714" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Coefficients erros'</span>)</span>
<span id="cb114-715"><a href="#cb114-715" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb114-716"><a href="#cb114-716" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb114-717"><a href="#cb114-717" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">'Minimum error'</span>,(pred_num[np.argmin(y)],<span class="bu">min</span>(y)))<span class="op">;</span></span>
<span id="cb114-718"><a href="#cb114-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-719"><a href="#cb114-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-720"><a href="#cb114-720" aria-hidden="true" tabindex="-1"></a>The minimum error occurs for the model with 6 predictors, while the best model is obtained with 3 predictors.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb114-721"><a href="#cb114-721" aria-hidden="true" tabindex="-1"></a>Hence, a better fit of coefficients does not guarantee the lowest test MSE.</span>
<span id="cb114-722"><a href="#cb114-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-723"><a href="#cb114-723" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 11</span></span>
<span id="cb114-724"><a href="#cb114-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-727"><a href="#cb114-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-728"><a href="#cb114-728" aria-hidden="true" tabindex="-1"></a>Boston<span class="op">=</span>load_data(<span class="st">'Boston'</span>)</span>
<span id="cb114-729"><a href="#cb114-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-730"><a href="#cb114-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-733"><a href="#cb114-733" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-734"><a href="#cb114-734" aria-hidden="true" tabindex="-1"></a>Boston.columns</span>
<span id="cb114-735"><a href="#cb114-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-736"><a href="#cb114-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-739"><a href="#cb114-739" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-740"><a href="#cb114-740" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>Boston[<span class="st">'crim'</span>]</span>
<span id="cb114-741"><a href="#cb114-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-742"><a href="#cb114-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-745"><a href="#cb114-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-746"><a href="#cb114-746" aria-hidden="true" tabindex="-1"></a>df_train,df_test <span class="op">=</span> train_test_split(Boston,test_size<span class="op">=</span><span class="fl">0.5</span>,random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb114-747"><a href="#cb114-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-748"><a href="#cb114-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-751"><a href="#cb114-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-752"><a href="#cb114-752" aria-hidden="true" tabindex="-1"></a><span class="co">#X_train=df_train.iloc[:,1:]</span></span>
<span id="cb114-753"><a href="#cb114-753" aria-hidden="true" tabindex="-1"></a>y_train<span class="op">=</span>df_train[<span class="st">'crim'</span>]</span>
<span id="cb114-754"><a href="#cb114-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-755"><a href="#cb114-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-758"><a href="#cb114-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-759"><a href="#cb114-759" aria-hidden="true" tabindex="-1"></a>X_test<span class="op">=</span>df_test.iloc[:,<span class="dv">1</span>:]</span>
<span id="cb114-760"><a href="#cb114-760" aria-hidden="true" tabindex="-1"></a>y_test<span class="op">=</span>df_test[<span class="st">'crim'</span>]</span>
<span id="cb114-761"><a href="#cb114-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-762"><a href="#cb114-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-765"><a href="#cb114-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-766"><a href="#cb114-766" aria-hidden="true" tabindex="-1"></a>Boston.info()</span>
<span id="cb114-767"><a href="#cb114-767" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-768"><a href="#cb114-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-769"><a href="#cb114-769" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb114-770"><a href="#cb114-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-773"><a href="#cb114-773" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-774"><a href="#cb114-774" aria-hidden="true" tabindex="-1"></a><span class="co"># Best subset selection</span></span>
<span id="cb114-775"><a href="#cb114-775" aria-hidden="true" tabindex="-1"></a>design<span class="op">=</span>MS(Boston.columns.drop(<span class="st">'crim'</span>)).fit(Boston)</span>
<span id="cb114-776"><a href="#cb114-776" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span>design.transform(df_train)</span>
<span id="cb114-777"><a href="#cb114-777" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> D.drop(<span class="st">'intercept'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-778"><a href="#cb114-778" aria-hidden="true" tabindex="-1"></a>X_train<span class="op">=</span>np.asarray(D)</span>
<span id="cb114-779"><a href="#cb114-779" aria-hidden="true" tabindex="-1"></a>Y_train<span class="op">=</span>np.asarray(y_train)</span>
<span id="cb114-780"><a href="#cb114-780" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> fit_path(X_train,Y_train,max_nonzeros<span class="op">=</span>X_train.shape[<span class="dv">1</span>])</span>
<span id="cb114-781"><a href="#cb114-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-782"><a href="#cb114-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-785"><a href="#cb114-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-786"><a href="#cb114-786" aria-hidden="true" tabindex="-1"></a>ones<span class="op">=</span>np.ones(X_test.shape[<span class="dv">0</span>]).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb114-787"><a href="#cb114-787" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>np.append(X_test,ones,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-788"><a href="#cb114-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-789"><a href="#cb114-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-792"><a href="#cb114-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-793"><a href="#cb114-793" aria-hidden="true" tabindex="-1"></a>iteration<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb114-794"><a href="#cb114-794" aria-hidden="true" tabindex="-1"></a>pred_num<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>]</span>
<span id="cb114-795"><a href="#cb114-795" aria-hidden="true" tabindex="-1"></a>coef_list<span class="op">=</span>[]</span>
<span id="cb114-796"><a href="#cb114-796" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> iteration:</span>
<span id="cb114-797"><a href="#cb114-797" aria-hidden="true" tabindex="-1"></a>    <span class="co">#construct a list of arrays. Each array contains the subsets coefficients </span></span>
<span id="cb114-798"><a href="#cb114-798" aria-hidden="true" tabindex="-1"></a>    coef_list.append(np.append(path[i][<span class="st">'B'</span>],path[i][<span class="st">'B0'</span>]))</span>
<span id="cb114-799"><a href="#cb114-799" aria-hidden="true" tabindex="-1"></a>Yhat<span class="op">=</span>[]</span>
<span id="cb114-800"><a href="#cb114-800" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(iteration)):</span>
<span id="cb114-801"><a href="#cb114-801" aria-hidden="true" tabindex="-1"></a>    Yhat.append(np.matmul(a,coef_list[i]))</span>
<span id="cb114-802"><a href="#cb114-802" aria-hidden="true" tabindex="-1"></a>MSE<span class="op">=</span>[]</span>
<span id="cb114-803"><a href="#cb114-803" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(Yhat)):</span>
<span id="cb114-804"><a href="#cb114-804" aria-hidden="true" tabindex="-1"></a>    MSE.append(np.sqrt(np.mean((Yhat[i]<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb114-805"><a href="#cb114-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-806"><a href="#cb114-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-809"><a href="#cb114-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-810"><a href="#cb114-810" aria-hidden="true" tabindex="-1"></a>mse_fig, ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">12</span>))</span>
<span id="cb114-811"><a href="#cb114-811" aria-hidden="true" tabindex="-1"></a>ax.bar(pred_num,MSE)</span>
<span id="cb114-812"><a href="#cb114-812" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Test MSE'</span>)</span>
<span id="cb114-813"><a href="#cb114-813" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Number of predictors'</span>)</span>
<span id="cb114-814"><a href="#cb114-814" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(np.arange(<span class="bu">max</span>(pred_num)<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb114-815"><a href="#cb114-815" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">'Minimum MSE'</span>,(pred_num[np.argmin(MSE)],<span class="bu">min</span>(MSE)))<span class="op">;</span></span>
<span id="cb114-816"><a href="#cb114-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-817"><a href="#cb114-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-818"><a href="#cb114-818" aria-hidden="true" tabindex="-1"></a>The best subset selection method yields a model with two features.</span>
<span id="cb114-819"><a href="#cb114-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-822"><a href="#cb114-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-823"><a href="#cb114-823" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso regression</span></span>
<span id="cb114-824"><a href="#cb114-824" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking for the optimal value of lambda first by cross validation</span></span>
<span id="cb114-825"><a href="#cb114-825" aria-hidden="true" tabindex="-1"></a>design<span class="op">=</span>MS(Boston.columns.drop(<span class="st">'crim'</span>)).fit(Boston)</span>
<span id="cb114-826"><a href="#cb114-826" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span>design.transform(df_train)</span>
<span id="cb114-827"><a href="#cb114-827" aria-hidden="true" tabindex="-1"></a>X_train<span class="op">=</span>np.asarray(D)</span>
<span id="cb114-828"><a href="#cb114-828" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler(with_mean<span class="op">=</span><span class="va">True</span>,  with_std<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-829"><a href="#cb114-829" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb114-830"><a href="#cb114-830" aria-hidden="true" tabindex="-1"></a>kfold <span class="op">=</span> skm.KFold(K,random_state<span class="op">=</span><span class="dv">0</span>,shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb114-831"><a href="#cb114-831" aria-hidden="true" tabindex="-1"></a>lassoCV <span class="op">=</span> skl.ElasticNetCV(n_alphas<span class="op">=</span><span class="dv">100</span>,l1_ratio<span class="op">=</span><span class="dv">1</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb114-832"><a href="#cb114-832" aria-hidden="true" tabindex="-1"></a>pipeCV <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler),(<span class="st">'lasso'</span>, lassoCV)])</span>
<span id="cb114-833"><a href="#cb114-833" aria-hidden="true" tabindex="-1"></a>pipeCV.fit(X_train, y_train)</span>
<span id="cb114-834"><a href="#cb114-834" aria-hidden="true" tabindex="-1"></a>tuned_lasso <span class="op">=</span> pipeCV.named_steps[<span class="st">'lasso'</span>]</span>
<span id="cb114-835"><a href="#cb114-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-836"><a href="#cb114-836" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'The optimal value of lambda is:'</span>,tuned_lasso.alpha_)</span>
<span id="cb114-837"><a href="#cb114-837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-838"><a href="#cb114-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-841"><a href="#cb114-841" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-842"><a href="#cb114-842" aria-hidden="true" tabindex="-1"></a>tuned_lasso.coef_</span>
<span id="cb114-843"><a href="#cb114-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-844"><a href="#cb114-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-847"><a href="#cb114-847" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-848"><a href="#cb114-848" aria-hidden="true" tabindex="-1"></a>X_test<span class="op">=</span>design.transform(df_test)</span>
<span id="cb114-849"><a href="#cb114-849" aria-hidden="true" tabindex="-1"></a>Yhat_lasso<span class="op">=</span>tuned_lasso.predict(X_test)</span>
<span id="cb114-850"><a href="#cb114-850" aria-hidden="true" tabindex="-1"></a>MSE_lasso<span class="op">=</span>np.sqrt(np.mean((Yhat_lasso<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb114-851"><a href="#cb114-851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-852"><a href="#cb114-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-855"><a href="#cb114-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-856"><a href="#cb114-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression</span></span>
<span id="cb114-857"><a href="#cb114-857" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose the optimal lambda for ridge regression on the training set</span></span>
<span id="cb114-858"><a href="#cb114-858" aria-hidden="true" tabindex="-1"></a>lambdas <span class="op">=</span> <span class="dv">10</span><span class="op">**</span>np.linspace(<span class="dv">8</span>, <span class="op">-</span><span class="dv">2</span>, <span class="dv">100</span>) <span class="op">/</span> Y.std()</span>
<span id="cb114-859"><a href="#cb114-859" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'ridge__alpha'</span>: lambdas}</span>
<span id="cb114-860"><a href="#cb114-860" aria-hidden="true" tabindex="-1"></a>ridgeCV <span class="op">=</span> skl.ElasticNetCV(alphas<span class="op">=</span>lambdas, l1_ratio<span class="op">=</span><span class="dv">0</span>,cv<span class="op">=</span>kfold)</span>
<span id="cb114-861"><a href="#cb114-861" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridgeCV)])</span>
<span id="cb114-862"><a href="#cb114-862" aria-hidden="true" tabindex="-1"></a><span class="co">#grid = skm.GridSearchCV(pipe,param_grid,cv=kfold,scoring='neg_mean_squared_error')</span></span>
<span id="cb114-863"><a href="#cb114-863" aria-hidden="true" tabindex="-1"></a>pipe.fit(X_train, y_train)</span>
<span id="cb114-864"><a href="#cb114-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-865"><a href="#cb114-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-868"><a href="#cb114-868" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-869"><a href="#cb114-869" aria-hidden="true" tabindex="-1"></a>tuned_ridge <span class="op">=</span> pipe.named_steps[<span class="st">'ridge'</span>]</span>
<span id="cb114-870"><a href="#cb114-870" aria-hidden="true" tabindex="-1"></a>tuned_ridge.alpha_</span>
<span id="cb114-871"><a href="#cb114-871" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-872"><a href="#cb114-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-875"><a href="#cb114-875" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-876"><a href="#cb114-876" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the ridge regression</span></span>
<span id="cb114-877"><a href="#cb114-877" aria-hidden="true" tabindex="-1"></a>opt_lambda<span class="op">=</span>tuned_ridge.alpha_</span>
<span id="cb114-878"><a href="#cb114-878" aria-hidden="true" tabindex="-1"></a>ridge_opt <span class="op">=</span> skl.ElasticNet(alpha<span class="op">=</span>opt_lambda, l1_ratio<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb114-879"><a href="#cb114-879" aria-hidden="true" tabindex="-1"></a>pipe_ridge <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'ridge'</span>, ridge_opt)])</span>
<span id="cb114-880"><a href="#cb114-880" aria-hidden="true" tabindex="-1"></a>result_ridge<span class="op">=</span>pipe_ridge.fit(X_train, y_train)</span>
<span id="cb114-881"><a href="#cb114-881" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-882"><a href="#cb114-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-885"><a href="#cb114-885" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-886"><a href="#cb114-886" aria-hidden="true" tabindex="-1"></a>Y_hat_ridge<span class="op">=</span>result_ridge.predict(X_test)</span>
<span id="cb114-887"><a href="#cb114-887" aria-hidden="true" tabindex="-1"></a>MSE_ridge<span class="op">=</span>np.sqrt(np.mean((Y_hat_ridge<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb114-888"><a href="#cb114-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-889"><a href="#cb114-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-892"><a href="#cb114-892" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-893"><a href="#cb114-893" aria-hidden="true" tabindex="-1"></a><span class="co">#PCR regression</span></span>
<span id="cb114-894"><a href="#cb114-894" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb114-895"><a href="#cb114-895" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb114-896"><a href="#cb114-896" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">'pca__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>)}</span>
<span id="cb114-897"><a href="#cb114-897" aria-hidden="true" tabindex="-1"></a>pipe_pca<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb114-898"><a href="#cb114-898" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> skm.GridSearchCV(pipe_pca,param_grid,cv<span class="op">=</span>kfold,scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb114-899"><a href="#cb114-899" aria-hidden="true" tabindex="-1"></a>pipe_pca.fit(X_train, y_train)</span>
<span id="cb114-900"><a href="#cb114-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-901"><a href="#cb114-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-904"><a href="#cb114-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-905"><a href="#cb114-905" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train, y_train)</span>
<span id="cb114-906"><a href="#cb114-906" aria-hidden="true" tabindex="-1"></a>n_comp <span class="op">=</span> param_grid[<span class="st">'pca__n_components'</span>]</span>
<span id="cb114-907"><a href="#cb114-907" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'num_components'</span>:n_comp,<span class="st">'CV_MSE'</span>:<span class="op">-</span>grid.cv_results_[<span class="st">'mean_test_score'</span>]})</span>
<span id="cb114-908"><a href="#cb114-908" aria-hidden="true" tabindex="-1"></a>M<span class="op">=</span>df[<span class="st">'CV_MSE'</span>].argmin(skipna<span class="op">=</span><span class="va">True</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb114-909"><a href="#cb114-909" aria-hidden="true" tabindex="-1"></a>M</span>
<span id="cb114-910"><a href="#cb114-910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-911"><a href="#cb114-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-914"><a href="#cb114-914" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-915"><a href="#cb114-915" aria-hidden="true" tabindex="-1"></a>pca_M <span class="op">=</span> PCA(n_components<span class="op">=</span>M)</span>
<span id="cb114-916"><a href="#cb114-916" aria-hidden="true" tabindex="-1"></a>linreg <span class="op">=</span> skl.LinearRegression()</span>
<span id="cb114-917"><a href="#cb114-917" aria-hidden="true" tabindex="-1"></a>param_grid_M <span class="op">=</span> {<span class="st">'pca_M__n_components'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>)}</span>
<span id="cb114-918"><a href="#cb114-918" aria-hidden="true" tabindex="-1"></a>pipe_pca_M<span class="op">=</span>Pipeline(steps<span class="op">=</span>[(<span class="st">'scaler'</span>, scaler), (<span class="st">'pca'</span>, pca_M),(<span class="st">'linreg'</span>, linreg)])</span>
<span id="cb114-919"><a href="#cb114-919" aria-hidden="true" tabindex="-1"></a>result_pca<span class="op">=</span>pipe_pca_M.fit(X_train, y_train)</span>
<span id="cb114-920"><a href="#cb114-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-921"><a href="#cb114-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-924"><a href="#cb114-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-925"><a href="#cb114-925" aria-hidden="true" tabindex="-1"></a>Yhat_pca<span class="op">=</span>result_pca.predict(X_test)</span>
<span id="cb114-926"><a href="#cb114-926" aria-hidden="true" tabindex="-1"></a>MSE_pca<span class="op">=</span>np.sqrt(np.mean((Yhat_pca<span class="op">-</span>y_test)<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb114-927"><a href="#cb114-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-928"><a href="#cb114-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-931"><a href="#cb114-931" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb114-932"><a href="#cb114-932" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's sum up the obtained results</span></span>
<span id="cb114-933"><a href="#cb114-933" aria-hidden="true" tabindex="-1"></a>df_results<span class="op">=</span>pd.DataFrame({<span class="st">'Method'</span>:[<span class="st">'Best subset'</span>,<span class="st">'Lasso'</span>,<span class="st">'Ridge'</span>,<span class="st">'PCR'</span>],<span class="st">'Test MSE'</span>:</span>
<span id="cb114-934"><a href="#cb114-934" aria-hidden="true" tabindex="-1"></a>                         [<span class="bu">min</span>(MSE),MSE_lasso,MSE_ridge,MSE_pca]})</span>
<span id="cb114-935"><a href="#cb114-935" aria-hidden="true" tabindex="-1"></a>df_results.set_index(<span class="st">'Method'</span>)</span>
<span id="cb114-936"><a href="#cb114-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb114-937"><a href="#cb114-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-938"><a href="#cb114-938" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb114-939"><a href="#cb114-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-940"><a href="#cb114-940" aria-hidden="true" tabindex="-1"></a>Based on the previous comparison of test MSEs, both the ridge regression on full model and the best subset selction are preferred.</span>
<span id="cb114-941"><a href="#cb114-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-942"><a href="#cb114-942" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb114-943"><a href="#cb114-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-944"><a href="#cb114-944" aria-hidden="true" tabindex="-1"></a>It is more preferable to choose the model obtained with the best subset selection because it is more interpretable than the Ridge regression.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb114-945"><a href="#cb114-945" aria-hidden="true" tabindex="-1"></a>The chosen model involves then 2 features.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>
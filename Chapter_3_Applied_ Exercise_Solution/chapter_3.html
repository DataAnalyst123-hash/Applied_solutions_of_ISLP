<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shad Ali Shah">
<meta name="dcterms.date" content="2025-12-02">

<title>Statistical Learning Analysis Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="chapter_3_files/libs/clipboard/clipboard.min.js"></script>
<script src="chapter_3_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="chapter_3_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="chapter_3_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="chapter_3_files/libs/quarto-html/popper.min.js"></script>
<script src="chapter_3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="chapter_3_files/libs/quarto-html/anchor.min.js"></script>
<link href="chapter_3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="chapter_3_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="chapter_3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="chapter_3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="chapter_3_files/libs/bootstrap/bootstrap-4d7f0bce1131f3e5f9547cd857cfbfc8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#exercise-8" id="toc-exercise-8" class="nav-link active" data-scroll-target="#exercise-8"><span class="header-section-number">1</span> Exercise 8</a></li>
  <li><a href="#exercise-9" id="toc-exercise-9" class="nav-link" data-scroll-target="#exercise-9"><span class="header-section-number">2</span> Exercise 9</a></li>
  <li><a href="#exercise-10" id="toc-exercise-10" class="nav-link" data-scroll-target="#exercise-10"><span class="header-section-number">3</span> Exercise 10</a></li>
  <li><a href="#exercise-11" id="toc-exercise-11" class="nav-link" data-scroll-target="#exercise-11"><span class="header-section-number">4</span> Exercise 11</a></li>
  <li><a href="#exercise-12" id="toc-exercise-12" class="nav-link" data-scroll-target="#exercise-12"><span class="header-section-number">5</span> Exercise 12</a></li>
  <li><a href="#exercise-13" id="toc-exercise-13" class="nav-link" data-scroll-target="#exercise-13"><span class="header-section-number">6</span> Exercise 13</a></li>
  <li><a href="#exercise-14" id="toc-exercise-14" class="nav-link" data-scroll-target="#exercise-14"><span class="header-section-number">7</span> Exercise 14</a></li>
  <li><a href="#exercise-15" id="toc-exercise-15" class="nav-link" data-scroll-target="#exercise-15"><span class="header-section-number">8</span> Exercise 15</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Statistical Learning Analysis Report</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Chapter 3: ISLR2 Exercise Solutions</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shad Ali Shah </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="exercise-8" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="exercise-8"><span class="header-section-number">1</span> Exercise 8</h2>
<ol type="a">
<li>Before performing simple linear regression we should import libraries and database</li>
</ol>
<div id="5ba9c8f0" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> (ModelSpec <span class="im">as</span> MS,summarize,poly)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> t</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.anova <span class="im">import</span> anova_lm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>We now import the Auto dataset to regress mpg on horsepower. To do so simply, we have imported the function load_data. We could have used also read_csv function availabre in pandas library since Auto dataset is in csv format.</p>
<div id="58968376" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Auto<span class="op">=</span>load_data(<span class="st">"Auto"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Auto.columns <span class="co">#Make sure that all Auto columns are imported</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Index(['mpg', 'cylinders', 'displacement', 'horsepower', 'weight',
       'acceleration', 'year', 'origin'],
      dtype='object')</code></pre>
</div>
</div>
<section id="a" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="a"><span class="header-section-number">1.1</span> (a)</h3>
<p>Next step is to create the model matrix. The matrix should emulate the simple linear regression, i.e: it should contain to factors in order for the sm library to understand that there are two parameters to find</p>
<div id="64d3c7ae" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.DataFrame({<span class="st">"intercept"</span>:np.ones(Auto.shape[<span class="dv">0</span>]),<span class="st">"lstat"</span>:Auto[<span class="st">"horsepower"</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Now we are ready to extract the response and fit the model</p>
<div id="18752457" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>Auto[<span class="st">"mpg"</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>summarize(results)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>39.9359</td>
<td>0.717</td>
<td>55.660</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">lstat</th>
<td>-0.1578</td>
<td>0.006</td>
<td>-24.489</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ol type="i">
<li><p>The p-value associated with both t-stats is near to 0. This shows clearly a strong evidence of the existance of a relationship between “mpg” and “horsepower”</p></li>
<li><p>To assess how far the relationship is strong we should check the percentage of variance explained by the model. For this we should use the $ R^2 $ indicator or the RSE</p></li>
</ol>
<div id="a8a777db" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>results.rsquared<span class="co">#For r squared</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0.6059482578894348</code></pre>
</div>
</div>
<div id="edf3e9d0" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For the residual standard error</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>rse<span class="op">=</span>np.sqrt(results.scale)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>rse</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>4.90575691954594</code></pre>
</div>
</div>
<p>Now the conclusion is nearly 60% of the variability of “mpg” can be explained by “horsepower”. But what about the interpretation of RSE?! To answer we should compare it with the mean of the response.</p>
<div id="4310f701" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lack_fit<span class="op">=</span>rse<span class="op">/</span>np.mean(Auto[<span class="st">"mpg"</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lack_fit</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0.20923714066914834</code></pre>
</div>
</div>
<p>Hence, the lack of fit is estimated to 20,92%</p>
<ol start="3" type="i">
<li><p>The more is the horsepower the more mpg will be consumed. (I assume here that “mpg” means the mean consumption of gas)</p></li>
<li><p>Predicted mpg associated with a horespower of 98 is computed using the function predict associated with the fitted model Payattention that preidction should take a dataframe with the same number of columns as a the number of parameters. This is why we have tried to add a column to the number 98</p></li>
</ol>
<div id="002795a7" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>newdf<span class="op">=</span>pd.DataFrame({<span class="st">'point'</span>:[<span class="dv">98</span>]})</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>newdf<span class="op">=</span>sm.add_constant(newdf,has_constant<span class="op">=</span><span class="st">'add'</span>)<span class="co">#we have changed the argument of has_constant</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#from skip to add because </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add_constant works per default when the list has a variance different from 0</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>x1<span class="op">=</span>results.get_prediction(newdf)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>x1.predicted_mean[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>24.46707715251242</code></pre>
</div>
</div>
<p>Now let’s look for confidence and prediction intervals with 95%. We use the method summary_frame() available in statsmodels library. The mentionned function can only be applied on PredictionResults class. This is exactly why x1 has been converted to such class in the previous input.</p>
<div id="99002843" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x1.summary_frame(alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">mean_se</th>
<th data-quarto-table-cell-role="th">mean_ci_lower</th>
<th data-quarto-table-cell-role="th">mean_ci_upper</th>
<th data-quarto-table-cell-role="th">obs_ci_lower</th>
<th data-quarto-table-cell-role="th">obs_ci_upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>24.467077</td>
<td>0.251262</td>
<td>23.973079</td>
<td>24.961075</td>
<td>14.809396</td>
<td>34.124758</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="b" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="b"><span class="header-section-number">1.2</span> (b)</h3>
<div id="948323d8" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> abline(ax, b, m, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add a line with slope m and intercept b to ax"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> ax.get_xlim()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    ylim <span class="op">=</span> [m <span class="op">*</span> xlim[<span class="dv">0</span>] <span class="op">+</span> b, m <span class="op">*</span> xlim[<span class="dv">1</span>] <span class="op">+</span> b]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(xlim, ylim, <span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> Auto.plot.scatter(<span class="st">'horsepower'</span>, <span class="st">'mpg'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>abline(ax,results.params[<span class="dv">0</span>],results.params[<span class="dv">1</span>],<span class="st">'r--'</span>,linewidth<span class="op">=</span><span class="dv">3</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-11-output-1.png" width="547" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="c" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="c"><span class="header-section-number">1.3</span> (c)</h3>
<div id="0effbb85" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw residuals against fitted values</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>ax.scatter(results.fittedvalues,results.resid)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Residuals"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-12-output-1.png" width="819" height="799" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The funnel shape is clear from the plot, which emphasizes the presence heteroscedasticity of the fitted simple linear regression model.<br> We also realise that relationship between mpg and horsepower is highly non-linear.</p>
<div id="054d3e5e" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the leverage stats</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>infl <span class="op">=</span> results.get_influence()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))[<span class="dv">1</span>]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.arange(X.shape[<span class="dv">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Leverage'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>np.argmax(infl.hat_matrix_diag)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>115</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-13-output-2.png" width="680" height="651" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cb6d3dd4" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span>Auto.shape[<span class="dv">0</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>leverage_thres<span class="op">=</span><span class="dv">2</span><span class="op">/</span>n</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>leverage_thres</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.00510204081632653</code></pre>
</div>
</div>
<p>The highest leverage stat, which is around 0.03, attended at point 115 is not much larger than the found threshold (=0.005). This indicates there are no high leverage points which need special handling.</p>
<div id="19746373" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw studentized residuals against fitted values</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>studentized_residuals <span class="op">=</span> results.get_influence().resid_studentized_internal</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(results.fittedvalues,studentized_residuals)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Studentized residuals"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-15-output-1.png" width="811" height="799" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8edcdf48" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'fitted'</span>:results.fittedvalues,<span class="st">'studentized'</span>:studentized_residuals})</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'studentized'</span>]<span class="op">&gt;</span><span class="dv">3</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fitted</th>
<th data-quarto-table-cell-role="th">studentized</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">mazda glc</th>
<td>29.675953</td>
<td>3.458909</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">honda civic 1500 gl</th>
<td>29.360264</td>
<td>3.114256</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observations 320 and 327 are believed to be (post-analysis) outliers.</p>
</section>
</section>
<section id="exercise-9" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="exercise-9"><span class="header-section-number">2</span> Exercise 9</h2>
<div id="df0e790e" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>Auto<span class="op">=</span>load_data(<span class="st">"Auto"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="fe301923" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Auto.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">origin</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">chevrolet chevelle malibu</th>
<td>18.0</td>
<td>8</td>
<td>307.0</td>
<td>130</td>
<td>3504</td>
<td>12.0</td>
<td>70</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">buick skylark 320</th>
<td>15.0</td>
<td>8</td>
<td>350.0</td>
<td>165</td>
<td>3693</td>
<td>11.5</td>
<td>70</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">plymouth satellite</th>
<td>18.0</td>
<td>8</td>
<td>318.0</td>
<td>150</td>
<td>3436</td>
<td>11.0</td>
<td>70</td>
<td>1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">amc rebel sst</th>
<td>16.0</td>
<td>8</td>
<td>304.0</td>
<td>150</td>
<td>3433</td>
<td>12.0</td>
<td>70</td>
<td>1</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ford torino</th>
<td>17.0</td>
<td>8</td>
<td>302.0</td>
<td>140</td>
<td>3449</td>
<td>10.5</td>
<td>70</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="639d778b" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Auto[<span class="st">"origin"</span>].unique()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array([1, 3, 2], dtype=int64)</code></pre>
</div>
</div>
<section id="a-1" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="a-1"><span class="header-section-number">2.1</span> (a)</h3>
<div id="a1ebc415" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(Auto)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-20-output-1.png" width="561" height="370" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c4841c6f" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Auto.corr(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The parameter mumeric_only is casted to true in order to avoid correlation among categorical values</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">origin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">mpg</th>
<td>1.000000</td>
<td>-0.777618</td>
<td>-0.805127</td>
<td>-0.778427</td>
<td>-0.832244</td>
<td>0.423329</td>
<td>0.580541</td>
<td>0.565209</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">cylinders</th>
<td>-0.777618</td>
<td>1.000000</td>
<td>0.950823</td>
<td>0.842983</td>
<td>0.897527</td>
<td>-0.504683</td>
<td>-0.345647</td>
<td>-0.568932</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">displacement</th>
<td>-0.805127</td>
<td>0.950823</td>
<td>1.000000</td>
<td>0.897257</td>
<td>0.932994</td>
<td>-0.543800</td>
<td>-0.369855</td>
<td>-0.614535</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">horsepower</th>
<td>-0.778427</td>
<td>0.842983</td>
<td>0.897257</td>
<td>1.000000</td>
<td>0.864538</td>
<td>-0.689196</td>
<td>-0.416361</td>
<td>-0.455171</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">weight</th>
<td>-0.832244</td>
<td>0.897527</td>
<td>0.932994</td>
<td>0.864538</td>
<td>1.000000</td>
<td>-0.416839</td>
<td>-0.309120</td>
<td>-0.585005</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">acceleration</th>
<td>0.423329</td>
<td>-0.504683</td>
<td>-0.543800</td>
<td>-0.689196</td>
<td>-0.416839</td>
<td>1.000000</td>
<td>0.290316</td>
<td>0.212746</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">year</th>
<td>0.580541</td>
<td>-0.345647</td>
<td>-0.369855</td>
<td>-0.416361</td>
<td>-0.309120</td>
<td>0.290316</td>
<td>1.000000</td>
<td>0.181528</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">origin</th>
<td>0.565209</td>
<td>-0.568932</td>
<td>-0.614535</td>
<td>-0.455171</td>
<td>-0.585005</td>
<td>0.212746</td>
<td>0.181528</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="c-1" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="c-1"><span class="header-section-number">2.2</span> (c)</h3>
<div id="57313c21" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> ModelSpec <span class="im">as</span> MS</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>Auto <span class="op">=</span> load_data(<span class="st">'Auto'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check columns</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Columns:"</span>, Auto.columns.tolist())</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data - only drop 'mpg'</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Auto[<span class="st">'mpg'</span>]</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>terms <span class="op">=</span> Auto.columns.drop(<span class="st">'mpg'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove non-numeric columns if any</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>Auto_numeric <span class="op">=</span> Auto.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>terms <span class="op">=</span> Auto_numeric.columns.drop(<span class="st">'mpg'</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> MS(terms).fit_transform(Auto)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Columns: ['mpg', 'cylinders', 'displacement', 'horsepower', 'weight', 'acceleration', 'year', 'origin']
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.821
Model:                            OLS   Adj. R-squared:                  0.818
Method:                 Least Squares   F-statistic:                     252.4
Date:                Tue, 02 Dec 2025   Prob (F-statistic):          2.04e-139
Time:                        11:24:33   Log-Likelihood:                -1023.5
No. Observations:                 392   AIC:                             2063.
Df Residuals:                     384   BIC:                             2095.
Df Model:                           7                                         
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
intercept      -17.2184      4.644     -3.707      0.000     -26.350      -8.087
cylinders       -0.4934      0.323     -1.526      0.128      -1.129       0.142
displacement     0.0199      0.008      2.647      0.008       0.005       0.035
horsepower      -0.0170      0.014     -1.230      0.220      -0.044       0.010
weight          -0.0065      0.001     -9.929      0.000      -0.008      -0.005
acceleration     0.0806      0.099      0.815      0.415      -0.114       0.275
year             0.7508      0.051     14.729      0.000       0.651       0.851
origin           1.4261      0.278      5.127      0.000       0.879       1.973
==============================================================================
Omnibus:                       31.906   Durbin-Watson:                   1.309
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               53.100
Skew:                           0.529   Prob(JB):                     2.95e-12
Kurtosis:                       4.460   Cond. No.                     8.59e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 8.59e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<div id="17cb7d30" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>res<span class="op">=</span>model.fit()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>summarize(res)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-17.2184</td>
<td>4.644</td>
<td>-3.707</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">cylinders</th>
<td>-0.4934</td>
<td>0.323</td>
<td>-1.526</td>
<td>0.128</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">displacement</th>
<td>0.0199</td>
<td>0.008</td>
<td>2.647</td>
<td>0.008</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">horsepower</th>
<td>-0.0170</td>
<td>0.014</td>
<td>-1.230</td>
<td>0.220</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">weight</th>
<td>-0.0065</td>
<td>0.001</td>
<td>-9.929</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">acceleration</th>
<td>0.0806</td>
<td>0.099</td>
<td>0.815</td>
<td>0.415</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">year</th>
<td>0.7508</td>
<td>0.051</td>
<td>14.729</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">origin</th>
<td>1.4261</td>
<td>0.278</td>
<td>5.127</td>
<td>0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="i" class="level4">
<h4 class="anchored" data-anchor-id="i">(i)</h4>
<div id="c05c4120" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's use the anova_lm() function. Beware, when faced with a</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># single model anova_lm() only works when that model is fitted using statsmodels.formula.api</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>res1<span class="op">=</span>smf.ols(<span class="st">'y~X'</span>,data<span class="op">=</span>Auto).fit()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>anova_lm(res1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">df</th>
<th data-quarto-table-cell-role="th">sum_sq</th>
<th data-quarto-table-cell-role="th">mean_sq</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">PR(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">X</th>
<td>8.0</td>
<td>19575.989106</td>
<td>2446.998638</td>
<td>220.978484</td>
<td>1.327873e-138</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Residual</th>
<td>384.0</td>
<td>4252.212530</td>
<td>11.073470</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>F statistic is much larger than 1. Therefore, we must reject the null hypothesis considering the whole regression coefficients are null.</p>
</section>
<section id="ii" class="level4">
<h4 class="anchored" data-anchor-id="ii">(ii)</h4>
<p>Displacement, weight, year and origin are the predictors which look to have significant relationships with mpg</p>
</section>
<section id="iii" class="level4">
<h4 class="anchored" data-anchor-id="iii">(iii)</h4>
<p>The coefficient suggests that, on average, when the other variables are held constant, an increase of one year (of production) corresponds to an increase of 0.75 of mpg (so, the more recent is the year of production the more efficient is the car).</p>
</section>
</section>
<section id="d" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="d"><span class="header-section-number">2.3</span> (d)</h3>
<div id="703052fd" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw residuals against fitted values</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ax.scatter(res.fittedvalues,res.resid)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>sns.residplot(data<span class="op">=</span>Auto,x<span class="op">=</span>res.fittedvalues,y<span class="op">=</span><span class="st">'mpg'</span>,lowess<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Residuals"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-25-output-1.png" width="819" height="799" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The funnel shape around the fitted curve suggests the existence of heteroscedasticity. There is also evidence of non linearity.</p>
<div id="579313a9" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the leverage stats</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>infl <span class="op">=</span> res.get_influence()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))[<span class="dv">1</span>]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.arange(X.shape[<span class="dv">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Leverage'</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>np.argmax(infl.hat_matrix_diag)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>13</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-26-output-2.png" width="680" height="651" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="517f8763" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span>Auto.shape[<span class="dv">0</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>leverage_thres<span class="op">=</span><span class="dv">8</span><span class="op">/</span>n<span class="co"># 7 is the number of predictors</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>leverage_thres</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.02040816326530612</code></pre>
</div>
</div>
<div id="bd3b269c" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>infl.hat_matrix_diag[<span class="dv">13</span>]<span class="co">#13 is the observation where the maximal leverage is attended</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.18991288602615608</code></pre>
</div>
</div>
<p>We consider that there is no high leverage point since the maximal leverage is 0.19 (attained at point 13), which does not greatly exceed the threshold (the factor of excess is less than 10).</p>
<div id="68fae53e" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw studentized residuals against fitted values</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>studentized_residuals <span class="op">=</span> res.get_influence().resid_studentized_internal</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(results.fittedvalues,studentized_residuals)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Studentized residuals"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-29-output-1.png" width="811" height="799" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="db982d26" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'fitted'</span>:res.fittedvalues,<span class="st">'studentized'</span>:studentized_residuals})</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df[np.<span class="bu">abs</span>(df[<span class="st">'studentized'</span>])<span class="op">&gt;</span><span class="dv">3</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fitted</th>
<th data-quarto-table-cell-role="th">studentized</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">volkswagen rabbit custom diesel</th>
<td>32.078967</td>
<td>3.344681</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">mazda glc</th>
<td>33.539573</td>
<td>3.951894</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">vw rabbit c (diesel)</th>
<td>32.949224</td>
<td>3.444885</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">vw dasher (diesel)</th>
<td>31.491864</td>
<td>3.631071</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observations 242, 320, 323 and 324 are believed to be outliers.</p>
</section>
<section id="e" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="e"><span class="header-section-number">2.4</span> (e)</h3>
<div id="70a61f33" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's try out some interaction terms</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ displacement*origin + year'</span>, data<span class="op">=</span>Auto) <span class="co"># the formula automatically</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># applies the hierarchy principle</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model2.fit()))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower*weight +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model3.fit()))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        coef  std err       t  P&gt;|t|
Intercept           -32.6362    4.725  -6.907  0.000
displacement          0.0065    0.009   0.712  0.477
origin                6.5265    0.946   6.902  0.000
displacement:origin  -0.0487    0.008  -5.785  0.000
year                  0.7494    0.056  13.418  0.000
                       coef   std err       t  P&gt;|t|
Intercept          59.27830  2.718000  21.807  0.000
horsepower         -0.24080  0.027000  -8.852  0.000
weight             -0.00980  0.001000 -11.679  0.000
horsepower:weight   0.00005  0.000007   7.455  0.000
origin              0.93090  0.309000   3.017  0.003</code></pre>
</div>
</div>
<p>Both the suggested interactions appear to be statistically significant.</p>
</section>
<section id="f" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="f"><span class="header-section-number">2.5</span> (f)</h3>
<div id="7ac888e6" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower+np.log(weight) +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model4.fit()))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    coef  std err       t  P&gt;|t|
Intercept       153.0507   11.717  13.062  0.000
horsepower       -0.0504    0.010  -5.018  0.000
np.log(weight)  -15.8235    1.543 -10.253  0.000
origin            1.0169    0.323   3.148  0.002</code></pre>
</div>
</div>
<div id="f16c7e7f" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model5 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower+np.sqrt(weight) +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model5.fit()))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    coef  std err       t  P&gt;|t|
Intercept        57.5157    2.678  21.476    0.0
horsepower       -0.0500    0.011  -4.749    0.0
np.sqrt(weight)  -0.5678    0.059  -9.672    0.0
origin            1.1581    0.323   3.580    0.0</code></pre>
</div>
</div>
<div id="70c592ee" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>model6 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower+np.power(weight,2) +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model6.fit()))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                             coef       std err       t  P&gt;|t|
Intercept            3.336930e+01  1.002000e+00  33.296    0.0
horsepower          -6.780000e-02  1.100000e-02  -5.909    0.0
np.power(weight, 2) -5.903000e-07  8.610000e-08  -6.854    0.0
origin               1.787200e+00  3.250000e-01   5.507    0.0</code></pre>
</div>
</div>
<p>The suggested models appear to have statistically significant terms including the transformed ones.</p>
</section>
</section>
<section id="exercise-10" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="exercise-10"><span class="header-section-number">3</span> Exercise 10</h2>
<div id="d6db12f9" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>Carseats<span class="op">=</span>load_data(<span class="st">'Carseats'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="f873e4e9" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>Carseats.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 400 entries, 0 to 399
Data columns (total 11 columns):
 #   Column       Non-Null Count  Dtype   
---  ------       --------------  -----   
 0   Sales        400 non-null    float64 
 1   CompPrice    400 non-null    int64   
 2   Income       400 non-null    int64   
 3   Advertising  400 non-null    int64   
 4   Population   400 non-null    int64   
 5   Price        400 non-null    int64   
 6   ShelveLoc    400 non-null    category
 7   Age          400 non-null    int64   
 8   Education    400 non-null    int64   
 9   Urban        400 non-null    category
 10  US           400 non-null    category
dtypes: category(3), float64(1), int64(7)
memory usage: 26.7 KB</code></pre>
</div>
</div>
<div id="fdc5a078" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>Carseats.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sales</th>
<th data-quarto-table-cell-role="th">CompPrice</th>
<th data-quarto-table-cell-role="th">Income</th>
<th data-quarto-table-cell-role="th">Advertising</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">ShelveLoc</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Education</th>
<th data-quarto-table-cell-role="th">Urban</th>
<th data-quarto-table-cell-role="th">US</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>9.50</td>
<td>138</td>
<td>73</td>
<td>11</td>
<td>276</td>
<td>120</td>
<td>Bad</td>
<td>42</td>
<td>17</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>11.22</td>
<td>111</td>
<td>48</td>
<td>16</td>
<td>260</td>
<td>83</td>
<td>Good</td>
<td>65</td>
<td>10</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>10.06</td>
<td>113</td>
<td>35</td>
<td>10</td>
<td>269</td>
<td>80</td>
<td>Medium</td>
<td>59</td>
<td>12</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>7.40</td>
<td>117</td>
<td>100</td>
<td>4</td>
<td>466</td>
<td>97</td>
<td>Medium</td>
<td>55</td>
<td>14</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>4.15</td>
<td>141</td>
<td>64</td>
<td>3</td>
<td>340</td>
<td>128</td>
<td>Bad</td>
<td>38</td>
<td>13</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="a-2" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="a-2"><span class="header-section-number">3.1</span> (a)</h3>
<div id="0b765308" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>Carseats[<span class="st">'Sales'</span>]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(Carseats[[<span class="st">'Price'</span>,<span class="st">'Urban'</span>,<span class="st">'US'</span>]]).fit_transform(Carseats)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>summarize(result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>13.0435</td>
<td>0.651</td>
<td>20.036</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Price</th>
<td>-0.0545</td>
<td>0.005</td>
<td>-10.389</td>
<td>0.000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Urban[Yes]</th>
<td>-0.0219</td>
<td>0.272</td>
<td>-0.081</td>
<td>0.936</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">US[Yes]</th>
<td>1.2006</td>
<td>0.259</td>
<td>4.635</td>
<td>0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="b-1" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="b-1"><span class="header-section-number">3.2</span> (b)</h3>
<p>The coefficient related to the prdictor ‘Urban’ is statistically insignificant suggesting that there is no relationship between this latter and the response.<br> The relationship between US and the response is positive. It means that when a store is located in the US, it will sell an average of 1200 more units approximately.<br> On the other hand, the relationship with ‘Price’ is negative. That means that an increase in 1 dollar in the price will cause the sales to decrease by approximately 55 units.</p>
</section>
<section id="c-2" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="c-2"><span class="header-section-number">3.3</span> (c)</h3>
<p>$ <span class="math display">\[\begin{equation*}
Sales = 13.0435 - 0.0545Price + 1.2006US - 0.0219Urban =
\begin{cases}
                        13.0435−0.0219×Urban+1.2006×US−0.0545×Price &amp;\text{$Urban=1,US=1$}\\
                        13.0435−0.0219×Urban+1.2006×Price &amp;\text{$Urban=1,US=0$}\\
                        13.0435+1.2006×US−0.0545×Price &amp;\text{$Urban=0,US=1$}\\
                        13.0435−0.0545×Price &amp;\text{$Urban=0,US=0$}\\
\end{cases}
\end{equation*}\]</span> $</p>
</section>
<section id="d-1" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="d-1"><span class="header-section-number">3.4</span> (d)</h3>
<p>Through reading the p-values obtained in question a we can reject the null hypothesis for both predictors ‘Price’ and ‘US’ but not for ‘Urban’.</p>
</section>
<section id="e-1" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="e-1"><span class="header-section-number">3.5</span> (e)</h3>
<div id="b48a9de8" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>Xnew<span class="op">=</span>MS(Carseats[[<span class="st">'Price'</span>,<span class="st">'US'</span>]]).fit_transform(Carseats)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>model_new<span class="op">=</span>sm.OLS(y,Xnew)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>result_new<span class="op">=</span>model_new.fit()</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>summarize(result_new)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>13.0308</td>
<td>0.631</td>
<td>20.652</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Price</th>
<td>-0.0545</td>
<td>0.005</td>
<td>-10.416</td>
<td>0.0</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">US[Yes]</th>
<td>1.1996</td>
<td>0.258</td>
<td>4.641</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="f-1" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="f-1"><span class="header-section-number">3.6</span> (f)</h3>
<p>To answer this question we can use the <span class="math inline">\(R^2\)</span> coefficient.</p>
<div id="96bfc468" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" The R-squared for the regression model without Urban is "</span>,result_new.rsquared)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" The R-squared for the regression model with Urban is "</span>,result.rsquared)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> The R-squared for the regression model without Urban is  0.23926288842678567
 The R-squared for the regression model with Urban is  0.23927539218405525</code></pre>
</div>
</div>
<p>We deduce that both models have namely the same <span class="math inline">\(R^2\)</span> value. However we must prefer the later model as it has a lower number of predictors.</p>
</section>
<section id="g" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="g"><span class="header-section-number">3.7</span> (g)</h3>
<div id="c598a476" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>result_new.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>11.79032</td>
<td>14.271265</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Price</th>
<td>-0.06476</td>
<td>-0.044195</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">US[Yes]</th>
<td>0.69152</td>
<td>1.707766</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="h" class="level3" data-number="3.8">
<h3 data-number="3.8" class="anchored" data-anchor-id="h"><span class="header-section-number">3.8</span> (h)</h3>
<div id="405bb22b" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the leverage stats</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>infl <span class="op">=</span> result_new.get_influence()</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))[<span class="dv">1</span>]</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.arange(Xnew.shape[<span class="dv">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Leverage'</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>np.argmax(infl.hat_matrix_diag)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>42</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-42-output-2.png" width="680" height="652" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8790fd77" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span>Carseats.shape[<span class="dv">0</span>]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>leverage_thres<span class="op">=</span><span class="dv">3</span><span class="op">/</span>n</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>leverage_thres</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0.0075</code></pre>
</div>
</div>
<p>We consider that there is no high leverage point since the maximal leverage is no more than 0.045 (attained at point 42), which does not greatly exceed the threshold of 0.0075.</p>
<div id="ce1c1ad3" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>studentized_residuals <span class="op">=</span> result_new.get_influence().resid_studentized_internal</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'fitted'</span>:result_new.fittedvalues,<span class="st">'studentized'</span>:studentized_residuals})</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>df[np.<span class="bu">abs</span>(df[<span class="st">'studentized'</span>])<span class="op">&gt;</span><span class="dv">3</span>].count()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>fitted         0
studentized    0
dtype: int64</code></pre>
</div>
</div>
<p>We conclude that there is no observation for which the absolute value of the studentized residual is greater than 3, which means that there is no (post analysis) potential outlier.</p>
</section>
</section>
<section id="exercise-11" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="exercise-11"><span class="header-section-number">4</span> Exercise 11</h2>
<div id="81c5c1a0" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>) <span class="co"># In order to generate the same results whenever we run the code</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng (<span class="dv">1</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> x <span class="op">+</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="a-3" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="a-3"><span class="header-section-number">4.1</span> (a)</h3>
<div id="3e5cdb85" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(df[[<span class="st">'x'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>summarize(result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">x</th>
<td>1.9762</td>
<td>0.117</td>
<td>16.898</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The coefficient estimate is statistically significant. Therefore, we can reject the null hypothesis and conclude that there is a relationship between x and y.</p>
</section>
<section id="b-2" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="b-2"><span class="header-section-number">4.2</span> (b)</h3>
<div id="b0083a74" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>MS(df[[<span class="st">'y'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model_new<span class="op">=</span>sm.OLS(x,Y)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>result_new<span class="op">=</span>model_new.fit()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>summarize(result_new)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">y</th>
<td>0.3757</td>
<td>0.022</td>
<td>16.898</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Results of the new model yield to the same conclusion as for the existence of an evidence of relationship between x and y.</p>
</section>
<section id="c-3" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="c-3"><span class="header-section-number">4.3</span> (c)</h3>
<p>Surprisingly, the coefficients of the fitted models in (a) and (b) are not the inverse of each other, though they should be apparently.<br> The formulas of the coefficients are in equation (3.38) in the book. These formulas prove the observed fact since the noise inserted in y makes its variance different from the variance of x.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="attachment:20230905_212542-3.jpg" class="img-fluid figure-img"></p>
<figcaption>20230905_212542-3.jpg</figcaption>
</figure>
</div>
</section>
<section id="e-2" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="e-2"><span class="header-section-number">4.4</span> (e)</h3>
<p>The former obtained equation for t-stat is symmetric in y and x. Therefore, it is clear now why t-stats of both fitted models in (a) and (b) are equal.</p>
</section>
<section id="f-2" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="f-2"><span class="header-section-number">4.5</span> (f)</h3>
<div id="00126f4a" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress y onto x</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>MS(df[[<span class="st">'x'</span>]]).fit_transform(df)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>summarize(result1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-0.0760</td>
<td>0.101</td>
<td>-0.756</td>
<td>0.451</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x</th>
<td>1.9686</td>
<td>0.118</td>
<td>16.734</td>
<td>0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="28775b1f" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regress x onto y</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>Y1<span class="op">=</span>MS(df[[<span class="st">'y'</span>]]).fit_transform(df)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(x,Y1)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>summarize(result2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>0.0095</td>
<td>0.044</td>
<td>0.216</td>
<td>0.829</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">y</th>
<td>0.3763</td>
<td>0.022</td>
<td>16.734</td>
<td>0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>t-stats for both models coefficients <span class="math inline">\(\beta_{1}\)</span> equal 16.734</p>
</section>
</section>
<section id="exercise-12" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="exercise-12"><span class="header-section-number">5</span> Exercise 12</h2>
<section id="a-4" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="a-4"><span class="header-section-number">5.1</span> (a)</h3>
<p>From the previous exercise we learn that the condition of the question becomes true when y and x have the same variance.</p>
</section>
<section id="b-3" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="b-3"><span class="header-section-number">5.2</span> (b)</h3>
<div id="7e6f92ef" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x <span class="op">+</span> np.random.normal(size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of y onto x</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(df[[<span class="st">'x'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>summarize(result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">x</th>
<td>1.0018</td>
<td>0.002</td>
<td>647.954</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="71b80165" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of x onto y</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>MS(df[[<span class="st">'y'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>model_y<span class="op">=</span>sm.OLS(x,Y)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>result_y<span class="op">=</span>model_y.fit()</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>summarize(result_y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">y</th>
<td>0.998</td>
<td>0.002</td>
<td>647.954</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="c-4" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="c-4"><span class="header-section-number">5.3</span> (c)</h3>
<div id="e5e767d2" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>df1<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="95c8d32a" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of y onto x</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>MS(df1[[<span class="st">'x'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df1)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>summarize(result1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">x</th>
<td>0.4925</td>
<td>0.087</td>
<td>5.63</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="86795329" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of x onto y</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Y1<span class="op">=</span>MS(df[[<span class="st">'y'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df1)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(x,Y1)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>summarize(result2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">y</th>
<td>0.4925</td>
<td>0.087</td>
<td>5.63</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="exercise-13" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="exercise-13"><span class="header-section-number">6</span> Exercise 13</h2>
<div id="90d091ff" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="a-5" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="a-5"><span class="header-section-number">6.1</span> (a)</h3>
<div id="6149f3f5" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="fl">0.0</span>,scale<span class="op">=</span><span class="fl">1.0</span>,size<span class="op">=</span><span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="b-4" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="b-4"><span class="header-section-number">6.2</span> (b)</h3>
<div id="d9032470" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>eps<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="fl">0.0</span>,scale<span class="op">=</span><span class="fl">0.25</span>,size<span class="op">=</span><span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="c-5" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="c-5"><span class="header-section-number">6.3</span> (c)</h3>
<div id="3e69cf9f" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>y<span class="op">=-</span><span class="dv">1</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>x<span class="op">+</span>eps</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="5d7e94e8" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>y.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>(100,)</code></pre>
</div>
</div>
<p>In this linear model <span class="math inline">\(\beta_{1}\)</span> equals 0.5 and <span class="math inline">\(\beta_{0}\)</span> equals -1</p>
</section>
<section id="d-2" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="d-2"><span class="header-section-number">6.4</span> (d)</h3>
<div id="6357de31" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>ax.scatter(x,y)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"X"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Y"</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-60-output-1.png" width="823" height="799" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e-3" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="e-3"><span class="header-section-number">6.5</span> (e)</h3>
<div id="87018049" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(df[[<span class="st">'x'</span>]]).fit_transform(df)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>result.summary()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="60">
<table class="simpletable caption-top table table-sm table-striped small">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Dep. Variable:</th>
<td>y</td>
<th data-quarto-table-cell-role="th">R-squared:</th>
<td>0.800</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model:</th>
<td>OLS</td>
<th data-quarto-table-cell-role="th">Adj. R-squared:</th>
<td>0.798</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Method:</th>
<td>Least Squares</td>
<th data-quarto-table-cell-role="th">F-statistic:</th>
<td>391.4</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date:</th>
<td>Tue, 02 Dec 2025</td>
<th data-quarto-table-cell-role="th">Prob (F-statistic):</th>
<td>5.39e-36</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Time:</th>
<td>11:24:35</td>
<th data-quarto-table-cell-role="th">Log-Likelihood:</th>
<td>4.1908</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">No. Observations:</th>
<td>100</td>
<th data-quarto-table-cell-role="th">AIC:</th>
<td>-4.382</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Df Residuals:</th>
<td>98</td>
<th data-quarto-table-cell-role="th">BIC:</th>
<td>0.8288</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Df Model:</th>
<td>1</td>
<th data-quarto-table-cell-role="th"></th>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Covariance Type:</th>
<td>nonrobust</td>
<th data-quarto-table-cell-role="th"></th>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td></td>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
<th data-quarto-table-cell-role="th">[0.025</th>
<th data-quarto-table-cell-role="th">0.975]</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-0.9632</td>
<td>0.023</td>
<td>-40.999</td>
<td>0.000</td>
<td>-1.010</td>
<td>-0.917</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">x</th>
<td>0.5239</td>
<td>0.026</td>
<td>19.783</td>
<td>0.000</td>
<td>0.471</td>
<td>0.576</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Omnibus:</th>
<td>0.898</td>
<th data-quarto-table-cell-role="th">Durbin-Watson:</th>
<td>2.157</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Prob(Omnibus):</th>
<td>0.638</td>
<th data-quarto-table-cell-role="th">Jarque-Bera (JB):</th>
<td>0.561</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Skew:</th>
<td>-0.172</td>
<th data-quarto-table-cell-role="th">Prob(JB):</th>
<td>0.755</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Kurtosis:</th>
<td>3.127</td>
<th data-quarto-table-cell-role="th">Cond. No.</th>
<td>1.15</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
<p>Coefficients obrained by the regression model are approximately the same as the coefficients formed in question (c)</p>
</section>
<section id="f-3" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="f-3"><span class="header-section-number">6.6</span> (f)</h3>
<div id="938b0f27" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>beta_0<span class="op">=</span>result.params[<span class="dv">0</span>]</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>beta_1<span class="op">=</span>result.params[<span class="dv">1</span>]</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>[beta_0 <span class="op">+</span> beta_1<span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>y_true<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, <span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Model fit'</span>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_true, <span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-62-output-1.png" width="563" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="g-1" class="level3" data-number="6.7">
<h3 data-number="6.7" class="anchored" data-anchor-id="g-1"><span class="header-section-number">6.7</span> (g)</h3>
<div id="744e2653" class="cell" data-execution_count="62">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> MS([poly(<span class="st">'x'</span>, degree<span class="op">=</span><span class="dv">2</span>)]).fit_transform(df)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>result1.summary()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="62">
<table class="simpletable caption-top table table-sm table-striped small">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Dep. Variable:</th>
<td>y</td>
<th data-quarto-table-cell-role="th">R-squared:</th>
<td>0.800</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model:</th>
<td>OLS</td>
<th data-quarto-table-cell-role="th">Adj. R-squared:</th>
<td>0.796</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Method:</th>
<td>Least Squares</td>
<th data-quarto-table-cell-role="th">F-statistic:</th>
<td>193.8</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date:</th>
<td>Tue, 02 Dec 2025</td>
<th data-quarto-table-cell-role="th">Prob (F-statistic):</th>
<td>1.32e-34</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Time:</th>
<td>11:24:35</td>
<th data-quarto-table-cell-role="th">Log-Likelihood:</th>
<td>4.2077</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">No. Observations:</th>
<td>100</td>
<th data-quarto-table-cell-role="th">AIC:</th>
<td>-2.415</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Df Residuals:</th>
<td>97</td>
<th data-quarto-table-cell-role="th">BIC:</th>
<td>5.400</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Df Model:</th>
<td>2</td>
<th data-quarto-table-cell-role="th"></th>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Covariance Type:</th>
<td>nonrobust</td>
<th data-quarto-table-cell-role="th"></th>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<td></td>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
<th data-quarto-table-cell-role="th">[0.025</th>
<th data-quarto-table-cell-role="th">0.975]</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-0.9315</td>
<td>0.024</td>
<td>-39.544</td>
<td>0.000</td>
<td>-0.978</td>
<td>-0.885</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">poly(x, degree=2)[0]</th>
<td>4.6370</td>
<td>0.236</td>
<td>19.685</td>
<td>0.000</td>
<td>4.169</td>
<td>5.104</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">poly(x, degree=2)[1]</th>
<td>0.0427</td>
<td>0.236</td>
<td>0.181</td>
<td>0.856</td>
<td>-0.425</td>
<td>0.510</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small">
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Omnibus:</th>
<td>0.893</td>
<th data-quarto-table-cell-role="th">Durbin-Watson:</th>
<td>2.152</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Prob(Omnibus):</th>
<td>0.640</td>
<th data-quarto-table-cell-role="th">Jarque-Bera (JB):</th>
<td>0.552</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Skew:</th>
<td>-0.170</td>
<th data-quarto-table-cell-role="th">Prob(JB):</th>
<td>0.759</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Kurtosis:</th>
<td>3.132</td>
<th data-quarto-table-cell-role="th">Cond. No.</th>
<td>10.0</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
<p>The p-value of the quadratic term shows that there is no significant relationship between <span class="math inline">\(X^2\)</span> and <span class="math inline">\(Y\)</span>.<br> Therefore, there is no evidence that the insertion of the quadratic term improves the model fit.</p>
</section>
<section id="h-1" class="level3" data-number="6.8">
<h3 data-number="6.8" class="anchored" data-anchor-id="h-1"><span class="header-section-number">6.8</span> (h)</h3>
<div id="c03ec5f9" class="cell" data-execution_count="63">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>eps1 <span class="op">=</span> np.random.normal(scale <span class="op">=</span><span class="fl">0.01</span>, size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>x <span class="op">+</span> eps1</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>df1<span class="op">=</span>pd.DataFrame({<span class="st">'x1'</span>:x,<span class="st">'y1'</span>:y1})</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>X2<span class="op">=</span>MS(df1[[<span class="st">'x1'</span>]]).fit_transform(df1)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(y1,X2)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>beta_0<span class="op">=</span>result2.params[<span class="dv">0</span>]</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>beta_1<span class="op">=</span>result2.params[<span class="dv">1</span>]</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>[beta_0 <span class="op">+</span> beta_1<span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>y_true<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y1)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, <span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Model fit'</span>)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_true, <span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-64-output-1.png" width="563" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Reducing the noise makes the fitted model and the true one almost identical.</p>
</section>
<section id="i-1" class="level3" data-number="6.9">
<h3 data-number="6.9" class="anchored" data-anchor-id="i-1"><span class="header-section-number">6.9</span> (i)</h3>
<div id="79a3bcd3" class="cell" data-execution_count="64">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>eps2 <span class="op">=</span> np.random.normal(scale <span class="op">=</span><span class="dv">10</span>, size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>x <span class="op">+</span> eps2</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>df2<span class="op">=</span>pd.DataFrame({<span class="st">'x2'</span>:x,<span class="st">'y2'</span>:y2})</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>X3<span class="op">=</span>MS(df2[[<span class="st">'x2'</span>]]).fit_transform(df2)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>model3<span class="op">=</span>sm.OLS(y2,X3)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>result3<span class="op">=</span>model3.fit()</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>beta_0<span class="op">=</span>result3.params[<span class="dv">0</span>]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>beta_1<span class="op">=</span>result3.params[<span class="dv">1</span>]</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>[beta_0 <span class="op">+</span> beta_1<span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>y_true<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y2)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, <span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Model fit'</span>)</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_true, <span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-65-output-1.png" width="559" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Increasing the noise makes the fitted model and the true more distinguishable.</p>
<div id="3358e6b1" class="cell" data-execution_count="65">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>result.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-1.009870</td>
<td>-0.916623</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x</th>
<td>0.471307</td>
<td>0.576407</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="9ccca156" class="cell" data-execution_count="66">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>result2.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-1.001895</td>
<td>-0.997859</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x1</th>
<td>0.497315</td>
<td>0.501864</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="df92d058" class="cell" data-execution_count="67">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>result3.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>-3.270073</td>
<td>0.990839</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x2</th>
<td>-2.957781</td>
<td>1.844723</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As exepected, the more you add noise the larger are the confidence intervals for the regression coefficients. The inverse is true.</p>
</section>
</section>
<section id="exercise-14" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="exercise-14"><span class="header-section-number">7</span> Exercise 14</h2>
<section id="a-6" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="a-6"><span class="header-section-number">7.1</span> (a)</h3>
<div id="5a466a65" class="cell" data-execution_count="68">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng (<span class="dv">10</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> rng.uniform(<span class="dv">0</span>, <span class="dv">1</span>, size <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> x1 <span class="op">+</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>) <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> x2 <span class="op">+</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The regression coefficients are:<br> <span class="math inline">\(\beta_{0}=2\)</span><br> <span class="math inline">\(\beta_{1}=2\)</span><br> <span class="math inline">\(\beta_{2}=0.3\)</span></p>
</section>
<section id="b-5" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="b-5"><span class="header-section-number">7.2</span> (b)</h3>
<div id="067b7e9a" class="cell" data-execution_count="69">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>np.corrcoef(x1,x2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>array([[1.       , 0.7723245],
       [0.7723245, 1.       ]])</code></pre>
</div>
</div>
<p>The correlation between x1 and x2 is 0.772</p>
<div id="b3f32896" class="cell" data-execution_count="70">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(x1,x2)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x1'</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'x2'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-71-output-1.png" width="563" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="c-6" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="c-6"><span class="header-section-number">7.3</span> (c)</h3>
<div id="dbfb1e19" class="cell" data-execution_count="71">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x1'</span>:x1,<span class="st">'x2'</span>:x2,<span class="st">'y'</span>:y})</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS([<span class="st">'x1'</span>,<span class="st">'x2'</span>]).fit_transform(df)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'beta0 is'</span>,result.params[<span class="dv">0</span>])</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'beta1 is'</span>,result.params[<span class="dv">1</span>])</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'beta2 is'</span>,result.params[<span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>beta0 is 1.9579092911366922
beta1 is 1.6153676985271603
beta2 is 0.9427766991595025</code></pre>
</div>
</div>
<p>The estimated coefficients by the regression model are clearly different from the true ones except for <span class="math inline">\(\beta_{0}\)</span></p>
<div id="d536305c" class="cell" data-execution_count="72">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>summarize(result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>1.9579</td>
<td>0.190</td>
<td>10.319</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x1</th>
<td>1.6154</td>
<td>0.527</td>
<td>3.065</td>
<td>0.003</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">x2</th>
<td>0.9428</td>
<td>0.831</td>
<td>1.134</td>
<td>0.259</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Based on the p-values we can reject the null hypothesis of <span class="math inline">\(H_{0}: \beta_{1}=0\)</span> but we cannot the null hypothesis of <span class="math inline">\(H_{0}: \beta_{2}=0\)</span></p>
</section>
<section id="d-3" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="d-3"><span class="header-section-number">7.4</span> (d)</h3>
<div id="44165756" class="cell" data-execution_count="73">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>MS([<span class="st">'x1'</span>]).fit_transform(df)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>summarize(result1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="73">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>1.9371</td>
<td>0.189</td>
<td>10.242</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x1</th>
<td>2.0771</td>
<td>0.335</td>
<td>6.196</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The p-values show that we can reject the null hypothesis <span class="math inline">\(H_{0}: \beta_{1}=0\)</span>. Moreover, we notice that both obtained coefficients are improved since they are closer enough to the real ones.</p>
</section>
<section id="e-4" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="e-4"><span class="header-section-number">7.5</span> (e)</h3>
<div id="b9d0ff9b" class="cell" data-execution_count="74">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>X2<span class="op">=</span>MS([<span class="st">'x2'</span>]).fit_transform(df)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(y,X2)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>summarize(result2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>2.3239</td>
<td>0.154</td>
<td>15.124</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x2</th>
<td>2.9103</td>
<td>0.550</td>
<td>5.291</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The results has significantly changed relatively to (c). the coefficient for x2 has become even greater than the intercept coefficient.<br> Furthermore, base on the p-values we can reject the null hypothesis <span class="math inline">\(H_{0}: \beta_{1}=0\)</span>.</p>
</section>
<section id="f-4" class="level3" data-number="7.6">
<h3 data-number="7.6" class="anchored" data-anchor-id="f-4"><span class="header-section-number">7.6</span> (f)</h3>
<p>The high correlation between x1 and x2 as shown above suggests that there is a high deal of colinearity. This explains why fitted one by one we can reject the null hypotheses, but when the predictors are assembled together the p-values show that one of them should be dismissed. In that sense there is no contradiction.</p>
</section>
<section id="g-2" class="level3" data-number="7.7">
<h3 data-number="7.7" class="anchored" data-anchor-id="g-2"><span class="header-section-number">7.7</span> (g)</h3>
<div id="33ad1f7d" class="cell" data-execution_count="75">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.concatenate([x1, [<span class="fl">0.1</span>]])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.concatenate([x2, [<span class="fl">0.8</span>]])</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.concatenate([y, [<span class="dv">6</span>]])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="52979af8" class="cell" data-execution_count="76">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model with both updated x1 and x2</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>df2<span class="op">=</span>pd.DataFrame({<span class="st">'x1'</span>:x1,<span class="st">'x2'</span>:x2,<span class="st">'y'</span>:y})</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>X3<span class="op">=</span>MS([<span class="st">'x1'</span>,<span class="st">'x2'</span>]).fit_transform(df2)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>model3<span class="op">=</span>sm.OLS(y,X3)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>result3<span class="op">=</span>model3.fit()</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>summarize(result3)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>2.0618</td>
<td>0.192</td>
<td>10.720</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x1</th>
<td>0.8575</td>
<td>0.466</td>
<td>1.838</td>
<td>0.069</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">x2</th>
<td>2.2663</td>
<td>0.705</td>
<td>3.216</td>
<td>0.002</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3a0b7756" class="cell" data-execution_count="77">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a new model with only x1</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>X4<span class="op">=</span>MS([<span class="st">'x1'</span>]).fit_transform(df2)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>model4<span class="op">=</span>sm.OLS(y,X4)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>result4<span class="op">=</span>model4.fit()</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>summarize(result4)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>2.0739</td>
<td>0.201</td>
<td>10.310</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x1</th>
<td>1.8760</td>
<td>0.358</td>
<td>5.236</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="b8aa9f8d" class="cell" data-execution_count="78">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a new model with only x1</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>X5<span class="op">=</span>MS([<span class="st">'x2'</span>]).fit_transform(df2)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>model5<span class="op">=</span>sm.OLS(y,X5)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>result5<span class="op">=</span>model5.fit()</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>summarize(result5)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>2.2840</td>
<td>0.151</td>
<td>15.088</td>
<td>0.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">x2</th>
<td>3.1458</td>
<td>0.524</td>
<td>6.008</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The insertion of a new observation caused the regression coefficient related to <span class="math inline">\(x_{1}\)</span> to decrease and the other related to <span class="math inline">\(x_{2}\)</span> to increase in all the models.</p>
<p>In order to evaluate wether the added observation is an outlier or a leverage point, you can exploit, for the three model combinations, the appropriate type of figures (resid vs studentized resid) as we did in the previous exercises. I left it here to your own discovery.<br> Finally it is very likely that the obeservation is an outlier and/or a leverage point since its insertion has clearly inlfluenced the model results.</p>
</section>
</section>
<section id="exercise-15" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="exercise-15"><span class="header-section-number">8</span> Exercise 15</h2>
<div id="df396db8" class="cell" data-execution_count="79">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>Boston<span class="op">=</span>load_data(<span class="st">'Boston'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="cc33e972" class="cell" data-execution_count="80">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>Boston.columns</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>Index(['crim', 'zn', 'indus', 'chas', 'nox', 'rm', 'age', 'dis', 'rad', 'tax',
       'ptratio', 'lstat', 'medv'],
      dtype='object')</code></pre>
</div>
</div>
<div id="10c8a235" class="cell" data-execution_count="81">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>Boston.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">crim</th>
<th data-quarto-table-cell-role="th">zn</th>
<th data-quarto-table-cell-role="th">indus</th>
<th data-quarto-table-cell-role="th">chas</th>
<th data-quarto-table-cell-role="th">nox</th>
<th data-quarto-table-cell-role="th">rm</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">dis</th>
<th data-quarto-table-cell-role="th">rad</th>
<th data-quarto-table-cell-role="th">tax</th>
<th data-quarto-table-cell-role="th">ptratio</th>
<th data-quarto-table-cell-role="th">lstat</th>
<th data-quarto-table-cell-role="th">medv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0.00632</td>
<td>18.0</td>
<td>2.31</td>
<td>0</td>
<td>0.538</td>
<td>6.575</td>
<td>65.2</td>
<td>4.0900</td>
<td>1</td>
<td>296</td>
<td>15.3</td>
<td>4.98</td>
<td>24.0</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0.02731</td>
<td>0.0</td>
<td>7.07</td>
<td>0</td>
<td>0.469</td>
<td>6.421</td>
<td>78.9</td>
<td>4.9671</td>
<td>2</td>
<td>242</td>
<td>17.8</td>
<td>9.14</td>
<td>21.6</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0.02729</td>
<td>0.0</td>
<td>7.07</td>
<td>0</td>
<td>0.469</td>
<td>7.185</td>
<td>61.1</td>
<td>4.9671</td>
<td>2</td>
<td>242</td>
<td>17.8</td>
<td>4.03</td>
<td>34.7</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>0.03237</td>
<td>0.0</td>
<td>2.18</td>
<td>0</td>
<td>0.458</td>
<td>6.998</td>
<td>45.8</td>
<td>6.0622</td>
<td>3</td>
<td>222</td>
<td>18.7</td>
<td>2.94</td>
<td>33.4</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>0.06905</td>
<td>0.0</td>
<td>2.18</td>
<td>0</td>
<td>0.458</td>
<td>7.147</td>
<td>54.2</td>
<td>6.0622</td>
<td>3</td>
<td>222</td>
<td>18.7</td>
<td>5.33</td>
<td>36.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="a-7" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="a-7"><span class="header-section-number">8.1</span> (a)</h3>
<div id="7ce7b14b" class="cell" data-execution_count="82">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>[]</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>Boston[<span class="st">'crim'</span>]</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>,<span class="dv">1</span>):</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    predictor<span class="op">=</span>Boston.columns[i]</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>Boston.loc[:,predictor]</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>sm.add_constant(x)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>sm.OLS(y,x)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    result.append({predictor: model.fit().pvalues[<span class="dv">1</span>]})</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>[{'zn': 5.5064721076792834e-06},
 {'indus': 1.4503489330272395e-21},
 {'chas': 0.20943450153520057},
 {'nox': 3.751739260356977e-23},
 {'rm': 6.346702984687803e-07},
 {'age': 2.8548693502441573e-16},
 {'dis': 8.519948766926326e-19},
 {'rad': 2.693844398186058e-56},
 {'tax': 2.357126835257048e-47},
 {'ptratio': 2.942922447359795e-11},
 {'lstat': 2.6542772314731968e-27},
 {'medv': 1.1739870821943694e-19}]</code></pre>
</div>
</div>
<p>All predictors are significant except ‘chas’.</p>
</section>
<section id="b-6" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="b-6"><span class="header-section-number">8.2</span> (b)</h3>
<div id="0f354fbc" class="cell" data-execution_count="83">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(Boston.columns.drop([<span class="st">'crim'</span>])).fit_transform(Boston)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>result_new<span class="op">=</span>model.fit()</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>summarize(result_new)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">t</th>
<th data-quarto-table-cell-role="th">P&gt;|t|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">intercept</th>
<td>13.7784</td>
<td>7.082</td>
<td>1.946</td>
<td>0.052</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">zn</th>
<td>0.0457</td>
<td>0.019</td>
<td>2.433</td>
<td>0.015</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">indus</th>
<td>-0.0584</td>
<td>0.084</td>
<td>-0.698</td>
<td>0.486</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">chas</th>
<td>-0.8254</td>
<td>1.183</td>
<td>-0.697</td>
<td>0.486</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">nox</th>
<td>-9.9576</td>
<td>5.290</td>
<td>-1.882</td>
<td>0.060</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">rm</th>
<td>0.6289</td>
<td>0.607</td>
<td>1.036</td>
<td>0.301</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">age</th>
<td>-0.0008</td>
<td>0.018</td>
<td>-0.047</td>
<td>0.962</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">dis</th>
<td>-1.0122</td>
<td>0.282</td>
<td>-3.584</td>
<td>0.000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">rad</th>
<td>0.6125</td>
<td>0.088</td>
<td>6.997</td>
<td>0.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">tax</th>
<td>-0.0038</td>
<td>0.005</td>
<td>-0.730</td>
<td>0.466</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ptratio</th>
<td>-0.3041</td>
<td>0.186</td>
<td>-1.632</td>
<td>0.103</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">lstat</th>
<td>0.1388</td>
<td>0.076</td>
<td>1.833</td>
<td>0.067</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">medv</th>
<td>-0.2201</td>
<td>0.060</td>
<td>-3.678</td>
<td>0.000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The null hypothesis given in the question is rejected for the following predictors : zn, dis, rad and medv</p>
</section>
<section id="c-7" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="c-7"><span class="header-section-number">8.3</span> (c)</h3>
<div id="da69efe0" class="cell" data-execution_count="84">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>[]</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>,<span class="dv">1</span>):</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    predictor<span class="op">=</span>Boston.columns[i]</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>Boston.loc[:,predictor]</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>sm.add_constant(x)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    model1<span class="op">=</span>sm.OLS(y,x)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    result1.append(model1.fit().params[<span class="dv">1</span>])</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(result1,result_new.params[<span class="dv">1</span>:<span class="dv">14</span>])</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Univariate coef'</span>)</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Multivariate coef'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-85-output-1.png" width="559" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d9582dc5" class="cell" data-execution_count="85">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>result_new.pvalues[<span class="dv">2</span>:]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>indus      4.857094e-01
chas       4.858406e-01
nox        6.036986e-02
rm         3.007385e-01
age        9.623231e-01
dis        3.725942e-04
rad        8.588123e-12
tax        4.657565e-01
ptratio    1.033932e-01
lstat      6.739844e-02
medv       2.605302e-04
dtype: float64</code></pre>
</div>
</div>
<p>We notice that the outlier point returns to the ‘Nox’ coefficient. Let’s remove this point from the plot and show it again</p>
<div id="6640f501" class="cell" data-execution_count="86">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(result1[<span class="dv">0</span>:<span class="dv">3</span>],result_new.params[<span class="dv">1</span>:<span class="dv">4</span>],color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(result1[<span class="dv">4</span>:<span class="dv">12</span>],result_new.params[<span class="dv">5</span>:<span class="dv">14</span>],color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="op">-</span><span class="dv">4</span>,<span class="dv">2</span>], [<span class="op">-</span><span class="dv">4</span>,<span class="dv">2</span>]) </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Univariate coef'</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Multivariate coef'</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_3_files/figure-html/cell-87-output-1.png" width="550" height="356" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="067258b6" class="cell" data-execution_count="87">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'Univariate'</span>:result1,<span class="st">'Multivariate'</span>:result_new.params[<span class="dv">1</span>:]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="44bb6ef8" class="cell" data-execution_count="88">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Univariate</th>
<th data-quarto-table-cell-role="th">Multivariate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">zn</th>
<td>-0.073935</td>
<td>0.045710</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">indus</th>
<td>0.509776</td>
<td>-0.058350</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">chas</th>
<td>-1.892777</td>
<td>-0.825378</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">nox</th>
<td>31.248531</td>
<td>-9.957587</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">rm</th>
<td>-2.684051</td>
<td>0.628911</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">age</th>
<td>0.107786</td>
<td>-0.000848</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">dis</th>
<td>-1.550902</td>
<td>-1.012247</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">rad</th>
<td>0.617911</td>
<td>0.612465</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">tax</th>
<td>0.029742</td>
<td>-0.003776</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ptratio</th>
<td>1.151983</td>
<td>-0.304073</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">lstat</th>
<td>0.548805</td>
<td>0.138801</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">medv</th>
<td>-0.363160</td>
<td>-0.220056</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We notice that features ‘age’, ‘rad’, ‘tax’, ‘medv’ and ‘zn’ are the closer to the fitting line. However, since we failed to reject the null hyoptheses for ‘age’ and ‘tax’ their related points should have no meaning.</p>
</section>
<section id="d-4" class="level3" data-number="8.4">
<h3 data-number="8.4" class="anchored" data-anchor-id="d-4"><span class="header-section-number">8.4</span> (d)</h3>
<div id="08387057" class="cell" data-execution_count="89">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>nl_results<span class="op">=</span>[]</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>):</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    predictor<span class="op">=</span>Boston.columns[i]</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>Boston.loc[:,predictor]</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> MS([poly(predictor, degree<span class="op">=</span><span class="dv">3</span>)]).fit_transform(Boston)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    nl_results.append({predictor:model.fit().pvalues[<span class="dv">0</span>:<span class="dv">4</span>]})</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>nl_results</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>[{'zn': intercept                1.547150e-20
  poly(zn, degree=3)[0]    4.697806e-06
  poly(zn, degree=3)[1]    4.420507e-03
  poly(zn, degree=3)[2]    2.295386e-01
  dtype: float64},
 {'indus': intercept                   3.606468e-25
  poly(indus, degree=3)[0]    8.854243e-24
  poly(indus, degree=3)[1]    1.086057e-03
  poly(indus, degree=3)[2]    1.196405e-12
  dtype: float64},
 {'chas': intercept                  7.897312e-20
  poly(chas, degree=3)[0]    3.943208e-08
  poly(chas, degree=3)[1]    2.912172e-14
  poly(chas, degree=3)[2]    7.348486e-01
  dtype: float64},
 {'nox': intercept                 2.742908e-26
  poly(nox, degree=3)[0]    2.457491e-26
  poly(nox, degree=3)[1]    7.736755e-05
  poly(nox, degree=3)[2]    6.961110e-16
  dtype: float64},
 {'rm': intercept                1.026665e-20
  poly(rm, degree=3)[0]    5.128048e-07
  poly(rm, degree=3)[1]    1.508545e-03
  poly(rm, degree=3)[2]    5.085751e-01
  dtype: float64},
 {'age': intercept                 5.918933e-23
  poly(age, degree=3)[0]    4.878803e-17
  poly(age, degree=3)[1]    2.291156e-06
  poly(age, degree=3)[2]    6.679915e-03
  dtype: float64},
 {'dis': intercept                 1.060226e-25
  poly(dis, degree=3)[0]    1.253249e-21
  poly(dis, degree=3)[1]    7.869767e-14
  poly(dis, degree=3)[2]    1.088832e-08
  dtype: float64},
 {'rad': intercept                 5.149845e-30
  poly(rad, degree=3)[0]    1.053211e-56
  poly(rad, degree=3)[1]    9.120558e-03
  poly(rad, degree=3)[2]    4.823138e-01
  dtype: float64},
 {'tax': intercept                 8.955923e-29
  poly(tax, degree=3)[0]    6.976314e-49
  poly(tax, degree=3)[1]    3.665348e-06
  poly(tax, degree=3)[2]    2.438507e-01
  dtype: float64},
 {'ptratio': intercept                     1.270767e-21
  poly(ptratio, degree=3)[0]    1.565484e-11
  poly(ptratio, degree=3)[1]    2.405468e-03
  poly(ptratio, degree=3)[2]    6.300514e-03
  dtype: float64},
 {'lstat': intercept                   4.939398e-24
  poly(lstat, degree=3)[0]    1.678072e-27
  poly(lstat, degree=3)[1]    3.780418e-02
  poly(lstat, degree=3)[2]    1.298906e-01
  dtype: float64},
 {'medv': intercept                  7.024110e-31
  poly(medv, degree=3)[0]    4.930818e-27
  poly(medv, degree=3)[1]    2.928577e-35
  poly(medv, degree=3)[2]    1.046510e-12
  dtype: float64}]</code></pre>
</div>
</div>
<p>Cubic relationships are not significant for predictors ‘rm’, ‘lstat’, ‘tax’, ‘rad’ and ‘zn’. On the other hand we can assert that there is a cubic association relationships regarding features ‘indus’, ‘chas’, ‘nox’, ‘age’, ‘dis’, ‘ptratio’ and ‘medv’.</p>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb118" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Statistical Learning Analysis Report"</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Chapter 3: ISLR2 Exercise Solutions"</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Shad Ali Shah"</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 3</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co">    colorlinks: true</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="co">    link-citations: true</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-cap-location: bottom</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="co">    tbl-cap-location: top</span></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="co">    crossref:</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a><span class="co">      fig-title: "Figure"</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="co">      tbl-title: "Table"</span></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a><span class="co">      fig-prefix: "Fig."</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a><span class="co">      tbl-prefix: "Table"</span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="co">  error: true</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="co">  keep-going: true</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-width: 6.5</span></span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a><span class="co">  fig-height: 4</span></span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 8</span></span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a>a. Before performing simple linear regression we should import libraries and database</span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.pyplot <span class="im">import</span> subplots</span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> (ModelSpec <span class="im">as</span> MS,summarize,poly)</span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> t</span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.anova <span class="im">import</span> anova_lm</span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a>We now import the Auto dataset to regress mpg on horsepower. To do so simply, we have imported the function load_data. We could have used also read_csv function availabre in pandas library since Auto dataset is in csv format. </span>
<span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-64"><a href="#cb118-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-65"><a href="#cb118-65" aria-hidden="true" tabindex="-1"></a>Auto<span class="op">=</span>load_data(<span class="st">"Auto"</span>)</span>
<span id="cb118-66"><a href="#cb118-66" aria-hidden="true" tabindex="-1"></a>Auto.columns <span class="co">#Make sure that all Auto columns are imported</span></span>
<span id="cb118-67"><a href="#cb118-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-68"><a href="#cb118-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-69"><a href="#cb118-69" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-70"><a href="#cb118-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-71"><a href="#cb118-71" aria-hidden="true" tabindex="-1"></a>Next step is to create the model matrix. The matrix should emulate the simple linear regression, i.e: it should contain to factors in order for the sm library to understand that there are two parameters to find</span>
<span id="cb118-72"><a href="#cb118-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-75"><a href="#cb118-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-76"><a href="#cb118-76" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.DataFrame({<span class="st">"intercept"</span>:np.ones(Auto.shape[<span class="dv">0</span>]),<span class="st">"lstat"</span>:Auto[<span class="st">"horsepower"</span>]})</span>
<span id="cb118-77"><a href="#cb118-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-78"><a href="#cb118-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-79"><a href="#cb118-79" aria-hidden="true" tabindex="-1"></a>Now we are ready to extract the response and fit the model</span>
<span id="cb118-80"><a href="#cb118-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-83"><a href="#cb118-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-84"><a href="#cb118-84" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>Auto[<span class="st">"mpg"</span>]</span>
<span id="cb118-85"><a href="#cb118-85" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-86"><a href="#cb118-86" aria-hidden="true" tabindex="-1"></a>results<span class="op">=</span>model.fit()</span>
<span id="cb118-87"><a href="#cb118-87" aria-hidden="true" tabindex="-1"></a>summarize(results)</span>
<span id="cb118-88"><a href="#cb118-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-89"><a href="#cb118-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-90"><a href="#cb118-90" aria-hidden="true" tabindex="-1"></a>i. The p-value associated with both t-stats is near to 0. This shows clearly a strong evidence of the existance of a relationship between "mpg" and "horsepower"</span>
<span id="cb118-91"><a href="#cb118-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-92"><a href="#cb118-92" aria-hidden="true" tabindex="-1"></a>ii. To assess how far the relationship is strong we should check the percentage of variance explained by the model.</span>
<span id="cb118-93"><a href="#cb118-93" aria-hidden="true" tabindex="-1"></a>For this we should use the $ R^2 $ indicator or the RSE</span>
<span id="cb118-94"><a href="#cb118-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-97"><a href="#cb118-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-98"><a href="#cb118-98" aria-hidden="true" tabindex="-1"></a>results.rsquared<span class="co">#For r squared</span></span>
<span id="cb118-99"><a href="#cb118-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-100"><a href="#cb118-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-103"><a href="#cb118-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-104"><a href="#cb118-104" aria-hidden="true" tabindex="-1"></a><span class="co">#For the residual standard error</span></span>
<span id="cb118-105"><a href="#cb118-105" aria-hidden="true" tabindex="-1"></a>rse<span class="op">=</span>np.sqrt(results.scale)</span>
<span id="cb118-106"><a href="#cb118-106" aria-hidden="true" tabindex="-1"></a>rse</span>
<span id="cb118-107"><a href="#cb118-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-108"><a href="#cb118-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-109"><a href="#cb118-109" aria-hidden="true" tabindex="-1"></a>Now the conclusion is nearly 60% of the variability of "mpg" can be explained by "horsepower". But what about the interpretation of RSE?! To answer we should compare it with the mean of the response.</span>
<span id="cb118-110"><a href="#cb118-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-113"><a href="#cb118-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-114"><a href="#cb118-114" aria-hidden="true" tabindex="-1"></a>lack_fit<span class="op">=</span>rse<span class="op">/</span>np.mean(Auto[<span class="st">"mpg"</span>])</span>
<span id="cb118-115"><a href="#cb118-115" aria-hidden="true" tabindex="-1"></a>lack_fit</span>
<span id="cb118-116"><a href="#cb118-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-117"><a href="#cb118-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-118"><a href="#cb118-118" aria-hidden="true" tabindex="-1"></a>Hence, the lack of fit is estimated to 20,92%</span>
<span id="cb118-119"><a href="#cb118-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-120"><a href="#cb118-120" aria-hidden="true" tabindex="-1"></a>iii. The more is the horsepower the more mpg will be consumed. (I assume here that "mpg" means the mean consumption of gas)</span>
<span id="cb118-121"><a href="#cb118-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-122"><a href="#cb118-122" aria-hidden="true" tabindex="-1"></a>iv. Predicted mpg associated with a horespower of 98 is computed using the function predict associated with the fitted model</span>
<span id="cb118-123"><a href="#cb118-123" aria-hidden="true" tabindex="-1"></a>Payattention that preidction should take a dataframe with the same number of columns as a the number of parameters. This is why we have tried to add a column to the number 98</span>
<span id="cb118-124"><a href="#cb118-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-127"><a href="#cb118-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-128"><a href="#cb118-128" aria-hidden="true" tabindex="-1"></a>newdf<span class="op">=</span>pd.DataFrame({<span class="st">'point'</span>:[<span class="dv">98</span>]})</span>
<span id="cb118-129"><a href="#cb118-129" aria-hidden="true" tabindex="-1"></a>newdf<span class="op">=</span>sm.add_constant(newdf,has_constant<span class="op">=</span><span class="st">'add'</span>)<span class="co">#we have changed the argument of has_constant</span></span>
<span id="cb118-130"><a href="#cb118-130" aria-hidden="true" tabindex="-1"></a><span class="co">#from skip to add because </span></span>
<span id="cb118-131"><a href="#cb118-131" aria-hidden="true" tabindex="-1"></a><span class="co"># add_constant works per default when the list has a variance different from 0</span></span>
<span id="cb118-132"><a href="#cb118-132" aria-hidden="true" tabindex="-1"></a>x1<span class="op">=</span>results.get_prediction(newdf)</span>
<span id="cb118-133"><a href="#cb118-133" aria-hidden="true" tabindex="-1"></a>x1.predicted_mean[<span class="dv">0</span>]</span>
<span id="cb118-134"><a href="#cb118-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-135"><a href="#cb118-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-136"><a href="#cb118-136" aria-hidden="true" tabindex="-1"></a>Now let's look for confidence and prediction intervals with 95%. We use the method summary_frame() available in statsmodels library. The mentionned function can only be applied on PredictionResults class. This is exactly why x1 has been converted to such class in the previous input.</span>
<span id="cb118-137"><a href="#cb118-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-140"><a href="#cb118-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-141"><a href="#cb118-141" aria-hidden="true" tabindex="-1"></a>x1.summary_frame(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb118-142"><a href="#cb118-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-143"><a href="#cb118-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-144"><a href="#cb118-144" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-145"><a href="#cb118-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-148"><a href="#cb118-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-149"><a href="#cb118-149" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> abline(ax, b, m, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb118-150"><a href="#cb118-150" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add a line with slope m and intercept b to ax"</span></span>
<span id="cb118-151"><a href="#cb118-151" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> ax.get_xlim()</span>
<span id="cb118-152"><a href="#cb118-152" aria-hidden="true" tabindex="-1"></a>    ylim <span class="op">=</span> [m <span class="op">*</span> xlim[<span class="dv">0</span>] <span class="op">+</span> b, m <span class="op">*</span> xlim[<span class="dv">1</span>] <span class="op">+</span> b]</span>
<span id="cb118-153"><a href="#cb118-153" aria-hidden="true" tabindex="-1"></a>    ax.plot(xlim, ylim, <span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb118-154"><a href="#cb118-154" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> Auto.plot.scatter(<span class="st">'horsepower'</span>, <span class="st">'mpg'</span>)</span>
<span id="cb118-155"><a href="#cb118-155" aria-hidden="true" tabindex="-1"></a>abline(ax,results.params[<span class="dv">0</span>],results.params[<span class="dv">1</span>],<span class="st">'r--'</span>,linewidth<span class="op">=</span><span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb118-156"><a href="#cb118-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-157"><a href="#cb118-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-158"><a href="#cb118-158" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-159"><a href="#cb118-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-162"><a href="#cb118-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-163"><a href="#cb118-163" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw residuals against fitted values</span></span>
<span id="cb118-164"><a href="#cb118-164" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb118-165"><a href="#cb118-165" aria-hidden="true" tabindex="-1"></a>ax.scatter(results.fittedvalues,results.resid)</span>
<span id="cb118-166"><a href="#cb118-166" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb118-167"><a href="#cb118-167" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Residuals"</span>)<span class="op">;</span></span>
<span id="cb118-168"><a href="#cb118-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-169"><a href="#cb118-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-170"><a href="#cb118-170" aria-hidden="true" tabindex="-1"></a>The funnel shape is clear from the plot, which emphasizes the presence heteroscedasticity of the fitted simple linear regression model.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-171"><a href="#cb118-171" aria-hidden="true" tabindex="-1"></a>We also realise that relationship between mpg and horsepower is highly non-linear.</span>
<span id="cb118-172"><a href="#cb118-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-175"><a href="#cb118-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-176"><a href="#cb118-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the leverage stats</span></span>
<span id="cb118-177"><a href="#cb118-177" aria-hidden="true" tabindex="-1"></a>infl <span class="op">=</span> results.get_influence()</span>
<span id="cb118-178"><a href="#cb118-178" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))[<span class="dv">1</span>]</span>
<span id="cb118-179"><a href="#cb118-179" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.arange(X.shape[<span class="dv">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb118-180"><a href="#cb118-180" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb118-181"><a href="#cb118-181" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Leverage'</span>)</span>
<span id="cb118-182"><a href="#cb118-182" aria-hidden="true" tabindex="-1"></a>np.argmax(infl.hat_matrix_diag)</span>
<span id="cb118-183"><a href="#cb118-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-184"><a href="#cb118-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-187"><a href="#cb118-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-188"><a href="#cb118-188" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span>Auto.shape[<span class="dv">0</span>]</span>
<span id="cb118-189"><a href="#cb118-189" aria-hidden="true" tabindex="-1"></a>leverage_thres<span class="op">=</span><span class="dv">2</span><span class="op">/</span>n</span>
<span id="cb118-190"><a href="#cb118-190" aria-hidden="true" tabindex="-1"></a>leverage_thres</span>
<span id="cb118-191"><a href="#cb118-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-192"><a href="#cb118-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-193"><a href="#cb118-193" aria-hidden="true" tabindex="-1"></a>The highest leverage stat, which is around 0.03, attended at point 115 is not much larger than the found threshold (=0.005). This indicates there are no high leverage points which need special handling.</span>
<span id="cb118-194"><a href="#cb118-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-197"><a href="#cb118-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-198"><a href="#cb118-198" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw studentized residuals against fitted values</span></span>
<span id="cb118-199"><a href="#cb118-199" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb118-200"><a href="#cb118-200" aria-hidden="true" tabindex="-1"></a>studentized_residuals <span class="op">=</span> results.get_influence().resid_studentized_internal</span>
<span id="cb118-201"><a href="#cb118-201" aria-hidden="true" tabindex="-1"></a>ax.scatter(results.fittedvalues,studentized_residuals)</span>
<span id="cb118-202"><a href="#cb118-202" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb118-203"><a href="#cb118-203" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Studentized residuals"</span>)<span class="op">;</span></span>
<span id="cb118-204"><a href="#cb118-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-205"><a href="#cb118-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-208"><a href="#cb118-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-209"><a href="#cb118-209" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'fitted'</span>:results.fittedvalues,<span class="st">'studentized'</span>:studentized_residuals})</span>
<span id="cb118-210"><a href="#cb118-210" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'studentized'</span>]<span class="op">&gt;</span><span class="dv">3</span>]</span>
<span id="cb118-211"><a href="#cb118-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-212"><a href="#cb118-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-213"><a href="#cb118-213" aria-hidden="true" tabindex="-1"></a>Observations 320 and 327 are believed to be (post-analysis) outliers.</span>
<span id="cb118-214"><a href="#cb118-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-215"><a href="#cb118-215" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 9</span></span>
<span id="cb118-216"><a href="#cb118-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-219"><a href="#cb118-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-220"><a href="#cb118-220" aria-hidden="true" tabindex="-1"></a>Auto<span class="op">=</span>load_data(<span class="st">"Auto"</span>)</span>
<span id="cb118-221"><a href="#cb118-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-222"><a href="#cb118-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-225"><a href="#cb118-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-226"><a href="#cb118-226" aria-hidden="true" tabindex="-1"></a>Auto.head()</span>
<span id="cb118-227"><a href="#cb118-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-228"><a href="#cb118-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-231"><a href="#cb118-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-232"><a href="#cb118-232" aria-hidden="true" tabindex="-1"></a>Auto[<span class="st">"origin"</span>].unique()</span>
<span id="cb118-233"><a href="#cb118-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-234"><a href="#cb118-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-235"><a href="#cb118-235" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-236"><a href="#cb118-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-239"><a href="#cb118-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-240"><a href="#cb118-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| scrolled: true</span></span>
<span id="cb118-241"><a href="#cb118-241" aria-hidden="true" tabindex="-1"></a>pd.plotting.scatter_matrix(Auto)<span class="op">;</span></span>
<span id="cb118-242"><a href="#cb118-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-243"><a href="#cb118-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-246"><a href="#cb118-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-247"><a href="#cb118-247" aria-hidden="true" tabindex="-1"></a>Auto.corr(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb118-248"><a href="#cb118-248" aria-hidden="true" tabindex="-1"></a><span class="co"># The parameter mumeric_only is casted to true in order to avoid correlation among categorical values</span></span>
<span id="cb118-249"><a href="#cb118-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-250"><a href="#cb118-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-251"><a href="#cb118-251" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-252"><a href="#cb118-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-255"><a href="#cb118-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-256"><a href="#cb118-256" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb118-257"><a href="#cb118-257" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> load_data</span>
<span id="cb118-258"><a href="#cb118-258" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP.models <span class="im">import</span> ModelSpec <span class="im">as</span> MS</span>
<span id="cb118-259"><a href="#cb118-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-260"><a href="#cb118-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb118-261"><a href="#cb118-261" aria-hidden="true" tabindex="-1"></a>Auto <span class="op">=</span> load_data(<span class="st">'Auto'</span>)</span>
<span id="cb118-262"><a href="#cb118-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-263"><a href="#cb118-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Check columns</span></span>
<span id="cb118-264"><a href="#cb118-264" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Columns:"</span>, Auto.columns.tolist())</span>
<span id="cb118-265"><a href="#cb118-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-266"><a href="#cb118-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data - only drop 'mpg'</span></span>
<span id="cb118-267"><a href="#cb118-267" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Auto[<span class="st">'mpg'</span>]</span>
<span id="cb118-268"><a href="#cb118-268" aria-hidden="true" tabindex="-1"></a>terms <span class="op">=</span> Auto.columns.drop(<span class="st">'mpg'</span>)</span>
<span id="cb118-269"><a href="#cb118-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-270"><a href="#cb118-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove non-numeric columns if any</span></span>
<span id="cb118-271"><a href="#cb118-271" aria-hidden="true" tabindex="-1"></a>Auto_numeric <span class="op">=</span> Auto.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb118-272"><a href="#cb118-272" aria-hidden="true" tabindex="-1"></a>terms <span class="op">=</span> Auto_numeric.columns.drop(<span class="st">'mpg'</span>)</span>
<span id="cb118-273"><a href="#cb118-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-274"><a href="#cb118-274" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> MS(terms).fit_transform(Auto)</span>
<span id="cb118-275"><a href="#cb118-275" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X)</span>
<span id="cb118-276"><a href="#cb118-276" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb118-277"><a href="#cb118-277" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span>
<span id="cb118-278"><a href="#cb118-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-279"><a href="#cb118-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-280"><a href="#cb118-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-283"><a href="#cb118-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-284"><a href="#cb118-284" aria-hidden="true" tabindex="-1"></a>res<span class="op">=</span>model.fit()</span>
<span id="cb118-285"><a href="#cb118-285" aria-hidden="true" tabindex="-1"></a>summarize(res)</span>
<span id="cb118-286"><a href="#cb118-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-287"><a href="#cb118-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-288"><a href="#cb118-288" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (i)</span></span>
<span id="cb118-289"><a href="#cb118-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-292"><a href="#cb118-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-293"><a href="#cb118-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's use the anova_lm() function. Beware, when faced with a</span></span>
<span id="cb118-294"><a href="#cb118-294" aria-hidden="true" tabindex="-1"></a><span class="co"># single model anova_lm() only works when that model is fitted using statsmodels.formula.api</span></span>
<span id="cb118-295"><a href="#cb118-295" aria-hidden="true" tabindex="-1"></a>res1<span class="op">=</span>smf.ols(<span class="st">'y~X'</span>,data<span class="op">=</span>Auto).fit()</span>
<span id="cb118-296"><a href="#cb118-296" aria-hidden="true" tabindex="-1"></a>anova_lm(res1)</span>
<span id="cb118-297"><a href="#cb118-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-298"><a href="#cb118-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-299"><a href="#cb118-299" aria-hidden="true" tabindex="-1"></a>F statistic is much larger than 1. Therefore, we must reject the null hypothesis considering the whole regression coefficients are null.</span>
<span id="cb118-300"><a href="#cb118-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-301"><a href="#cb118-301" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (ii)</span></span>
<span id="cb118-302"><a href="#cb118-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-303"><a href="#cb118-303" aria-hidden="true" tabindex="-1"></a>Displacement, weight, year and origin are the predictors which look to have significant relationships with mpg</span>
<span id="cb118-304"><a href="#cb118-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-305"><a href="#cb118-305" aria-hidden="true" tabindex="-1"></a><span class="fu">#### (iii)</span></span>
<span id="cb118-306"><a href="#cb118-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-307"><a href="#cb118-307" aria-hidden="true" tabindex="-1"></a>The coefficient suggests that, on average, when the other variables are held constant, an increase of one year (of production) corresponds to an increase of 0.75 of mpg (so, the more recent is the year of production the more efficient is the car).</span>
<span id="cb118-308"><a href="#cb118-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-309"><a href="#cb118-309" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb118-310"><a href="#cb118-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-313"><a href="#cb118-313" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-314"><a href="#cb118-314" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw residuals against fitted values</span></span>
<span id="cb118-315"><a href="#cb118-315" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb118-316"><a href="#cb118-316" aria-hidden="true" tabindex="-1"></a>ax.scatter(res.fittedvalues,res.resid)</span>
<span id="cb118-317"><a href="#cb118-317" aria-hidden="true" tabindex="-1"></a>sns.residplot(data<span class="op">=</span>Auto,x<span class="op">=</span>res.fittedvalues,y<span class="op">=</span><span class="st">'mpg'</span>,lowess<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb118-318"><a href="#cb118-318" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb118-319"><a href="#cb118-319" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Residuals"</span>)<span class="op">;</span></span>
<span id="cb118-320"><a href="#cb118-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-321"><a href="#cb118-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-322"><a href="#cb118-322" aria-hidden="true" tabindex="-1"></a>The funnel shape around the fitted curve suggests the existence of heteroscedasticity. There is also evidence of non linearity.</span>
<span id="cb118-323"><a href="#cb118-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-326"><a href="#cb118-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-327"><a href="#cb118-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the leverage stats</span></span>
<span id="cb118-328"><a href="#cb118-328" aria-hidden="true" tabindex="-1"></a>infl <span class="op">=</span> res.get_influence()</span>
<span id="cb118-329"><a href="#cb118-329" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))[<span class="dv">1</span>]</span>
<span id="cb118-330"><a href="#cb118-330" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.arange(X.shape[<span class="dv">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb118-331"><a href="#cb118-331" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb118-332"><a href="#cb118-332" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Leverage'</span>)</span>
<span id="cb118-333"><a href="#cb118-333" aria-hidden="true" tabindex="-1"></a>np.argmax(infl.hat_matrix_diag)</span>
<span id="cb118-334"><a href="#cb118-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-335"><a href="#cb118-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-338"><a href="#cb118-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-339"><a href="#cb118-339" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span>Auto.shape[<span class="dv">0</span>]</span>
<span id="cb118-340"><a href="#cb118-340" aria-hidden="true" tabindex="-1"></a>leverage_thres<span class="op">=</span><span class="dv">8</span><span class="op">/</span>n<span class="co"># 7 is the number of predictors</span></span>
<span id="cb118-341"><a href="#cb118-341" aria-hidden="true" tabindex="-1"></a>leverage_thres</span>
<span id="cb118-342"><a href="#cb118-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-343"><a href="#cb118-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-346"><a href="#cb118-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-347"><a href="#cb118-347" aria-hidden="true" tabindex="-1"></a>infl.hat_matrix_diag[<span class="dv">13</span>]<span class="co">#13 is the observation where the maximal leverage is attended</span></span>
<span id="cb118-348"><a href="#cb118-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-349"><a href="#cb118-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-350"><a href="#cb118-350" aria-hidden="true" tabindex="-1"></a>We consider that there is no high leverage point since the maximal leverage is 0.19 (attained at point 13), which does not greatly exceed the threshold (the factor of excess is less than 10).</span>
<span id="cb118-351"><a href="#cb118-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-354"><a href="#cb118-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-355"><a href="#cb118-355" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw studentized residuals against fitted values</span></span>
<span id="cb118-356"><a href="#cb118-356" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb118-357"><a href="#cb118-357" aria-hidden="true" tabindex="-1"></a>studentized_residuals <span class="op">=</span> res.get_influence().resid_studentized_internal</span>
<span id="cb118-358"><a href="#cb118-358" aria-hidden="true" tabindex="-1"></a>ax.scatter(results.fittedvalues,studentized_residuals)</span>
<span id="cb118-359"><a href="#cb118-359" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Fitted values"</span>)</span>
<span id="cb118-360"><a href="#cb118-360" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Studentized residuals"</span>)<span class="op">;</span></span>
<span id="cb118-361"><a href="#cb118-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-362"><a href="#cb118-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-365"><a href="#cb118-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-366"><a href="#cb118-366" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'fitted'</span>:res.fittedvalues,<span class="st">'studentized'</span>:studentized_residuals})</span>
<span id="cb118-367"><a href="#cb118-367" aria-hidden="true" tabindex="-1"></a>df[np.<span class="bu">abs</span>(df[<span class="st">'studentized'</span>])<span class="op">&gt;</span><span class="dv">3</span>]</span>
<span id="cb118-368"><a href="#cb118-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-369"><a href="#cb118-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-370"><a href="#cb118-370" aria-hidden="true" tabindex="-1"></a>Observations 242, 320, 323 and 324 are believed to be outliers.</span>
<span id="cb118-371"><a href="#cb118-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-372"><a href="#cb118-372" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb118-373"><a href="#cb118-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-376"><a href="#cb118-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-377"><a href="#cb118-377" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's try out some interaction terms</span></span>
<span id="cb118-378"><a href="#cb118-378" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ displacement*origin + year'</span>, data<span class="op">=</span>Auto) <span class="co"># the formula automatically</span></span>
<span id="cb118-379"><a href="#cb118-379" aria-hidden="true" tabindex="-1"></a><span class="co"># applies the hierarchy principle</span></span>
<span id="cb118-380"><a href="#cb118-380" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model2.fit()))</span>
<span id="cb118-381"><a href="#cb118-381" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower*weight +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb118-382"><a href="#cb118-382" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model3.fit()))</span>
<span id="cb118-383"><a href="#cb118-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-384"><a href="#cb118-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-385"><a href="#cb118-385" aria-hidden="true" tabindex="-1"></a>Both the suggested interactions appear to be statistically significant.</span>
<span id="cb118-386"><a href="#cb118-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-387"><a href="#cb118-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb118-388"><a href="#cb118-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-391"><a href="#cb118-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-392"><a href="#cb118-392" aria-hidden="true" tabindex="-1"></a>model4 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower+np.log(weight) +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb118-393"><a href="#cb118-393" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model4.fit()))</span>
<span id="cb118-394"><a href="#cb118-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-395"><a href="#cb118-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-398"><a href="#cb118-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-399"><a href="#cb118-399" aria-hidden="true" tabindex="-1"></a>model5 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower+np.sqrt(weight) +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb118-400"><a href="#cb118-400" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model5.fit()))</span>
<span id="cb118-401"><a href="#cb118-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-402"><a href="#cb118-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-405"><a href="#cb118-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-406"><a href="#cb118-406" aria-hidden="true" tabindex="-1"></a>model6 <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'mpg ~ horsepower+np.power(weight,2) +origin'</span>, data<span class="op">=</span>Auto)</span>
<span id="cb118-407"><a href="#cb118-407" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize(model6.fit()))</span>
<span id="cb118-408"><a href="#cb118-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-409"><a href="#cb118-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-410"><a href="#cb118-410" aria-hidden="true" tabindex="-1"></a>The suggested models appear to have statistically significant terms including the transformed ones.</span>
<span id="cb118-411"><a href="#cb118-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-412"><a href="#cb118-412" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 10</span></span>
<span id="cb118-413"><a href="#cb118-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-416"><a href="#cb118-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-417"><a href="#cb118-417" aria-hidden="true" tabindex="-1"></a>Carseats<span class="op">=</span>load_data(<span class="st">'Carseats'</span>)</span>
<span id="cb118-418"><a href="#cb118-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-419"><a href="#cb118-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-422"><a href="#cb118-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-423"><a href="#cb118-423" aria-hidden="true" tabindex="-1"></a>Carseats.info()</span>
<span id="cb118-424"><a href="#cb118-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-425"><a href="#cb118-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-428"><a href="#cb118-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-429"><a href="#cb118-429" aria-hidden="true" tabindex="-1"></a>Carseats.head()</span>
<span id="cb118-430"><a href="#cb118-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-431"><a href="#cb118-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-432"><a href="#cb118-432" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-433"><a href="#cb118-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-436"><a href="#cb118-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-437"><a href="#cb118-437" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>Carseats[<span class="st">'Sales'</span>]</span>
<span id="cb118-438"><a href="#cb118-438" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(Carseats[[<span class="st">'Price'</span>,<span class="st">'Urban'</span>,<span class="st">'US'</span>]]).fit_transform(Carseats)</span>
<span id="cb118-439"><a href="#cb118-439" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-440"><a href="#cb118-440" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb118-441"><a href="#cb118-441" aria-hidden="true" tabindex="-1"></a>summarize(result)</span>
<span id="cb118-442"><a href="#cb118-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-443"><a href="#cb118-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-444"><a href="#cb118-444" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-445"><a href="#cb118-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-446"><a href="#cb118-446" aria-hidden="true" tabindex="-1"></a>The coefficient related to the prdictor 'Urban' is statistically insignificant suggesting that there is no relationship between this latter and the response.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-447"><a href="#cb118-447" aria-hidden="true" tabindex="-1"></a>The relationship between US and the response is positive. It means that when a store is located in the US, it will sell an average of 1200 more units approximately.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-448"><a href="#cb118-448" aria-hidden="true" tabindex="-1"></a>On the other hand, the relationship with 'Price' is negative. That means that an increase in 1 dollar in the price will cause the sales to decrease by approximately 55 units.</span>
<span id="cb118-449"><a href="#cb118-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-450"><a href="#cb118-450" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-451"><a href="#cb118-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-452"><a href="#cb118-452" aria-hidden="true" tabindex="-1"></a>$</span>
<span id="cb118-453"><a href="#cb118-453" aria-hidden="true" tabindex="-1"></a>\begin{equation*}</span>
<span id="cb118-454"><a href="#cb118-454" aria-hidden="true" tabindex="-1"></a>Sales = 13.0435 - 0.0545Price + 1.2006US - 0.0219Urban = </span>
<span id="cb118-455"><a href="#cb118-455" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb118-456"><a href="#cb118-456" aria-hidden="true" tabindex="-1"></a>                        13.0435−0.0219×Urban+1.2006×US−0.0545×Price &amp;\text{$Urban=1,US=1$}<span class="sc">\\</span></span>
<span id="cb118-457"><a href="#cb118-457" aria-hidden="true" tabindex="-1"></a>                        13.0435−0.0219×Urban+1.2006×Price &amp;\text{$Urban=1,US=0$}<span class="sc">\\</span></span>
<span id="cb118-458"><a href="#cb118-458" aria-hidden="true" tabindex="-1"></a>                        13.0435+1.2006×US−0.0545×Price &amp;\text{$Urban=0,US=1$}<span class="sc">\\</span></span>
<span id="cb118-459"><a href="#cb118-459" aria-hidden="true" tabindex="-1"></a>                        13.0435−0.0545×Price &amp;\text{$Urban=0,US=0$}<span class="sc">\\</span></span>
<span id="cb118-460"><a href="#cb118-460" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb118-461"><a href="#cb118-461" aria-hidden="true" tabindex="-1"></a>\end{equation*}</span>
<span id="cb118-462"><a href="#cb118-462" aria-hidden="true" tabindex="-1"></a>$</span>
<span id="cb118-463"><a href="#cb118-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-464"><a href="#cb118-464" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb118-465"><a href="#cb118-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-466"><a href="#cb118-466" aria-hidden="true" tabindex="-1"></a>Through reading the p-values obtained in question a we can reject the null hypothesis for both predictors 'Price' and 'US' but not for 'Urban'.</span>
<span id="cb118-467"><a href="#cb118-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-468"><a href="#cb118-468" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb118-469"><a href="#cb118-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-472"><a href="#cb118-472" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-473"><a href="#cb118-473" aria-hidden="true" tabindex="-1"></a>Xnew<span class="op">=</span>MS(Carseats[[<span class="st">'Price'</span>,<span class="st">'US'</span>]]).fit_transform(Carseats)</span>
<span id="cb118-474"><a href="#cb118-474" aria-hidden="true" tabindex="-1"></a>model_new<span class="op">=</span>sm.OLS(y,Xnew)</span>
<span id="cb118-475"><a href="#cb118-475" aria-hidden="true" tabindex="-1"></a>result_new<span class="op">=</span>model_new.fit()</span>
<span id="cb118-476"><a href="#cb118-476" aria-hidden="true" tabindex="-1"></a>summarize(result_new)</span>
<span id="cb118-477"><a href="#cb118-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-478"><a href="#cb118-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-479"><a href="#cb118-479" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb118-480"><a href="#cb118-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-481"><a href="#cb118-481" aria-hidden="true" tabindex="-1"></a>To answer this question we can use the $R^2$ coefficient.</span>
<span id="cb118-482"><a href="#cb118-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-485"><a href="#cb118-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-486"><a href="#cb118-486" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" The R-squared for the regression model without Urban is "</span>,result_new.rsquared)</span>
<span id="cb118-487"><a href="#cb118-487" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" The R-squared for the regression model with Urban is "</span>,result.rsquared)</span>
<span id="cb118-488"><a href="#cb118-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-489"><a href="#cb118-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-490"><a href="#cb118-490" aria-hidden="true" tabindex="-1"></a>We deduce that both models have namely the same $R^2$ value. However we must prefer the later model as it has a lower number of predictors. </span>
<span id="cb118-491"><a href="#cb118-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-492"><a href="#cb118-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### (g)</span></span>
<span id="cb118-493"><a href="#cb118-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-496"><a href="#cb118-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-497"><a href="#cb118-497" aria-hidden="true" tabindex="-1"></a>result_new.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb118-498"><a href="#cb118-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-499"><a href="#cb118-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-500"><a href="#cb118-500" aria-hidden="true" tabindex="-1"></a><span class="fu">### (h)</span></span>
<span id="cb118-501"><a href="#cb118-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-504"><a href="#cb118-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-505"><a href="#cb118-505" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the leverage stats</span></span>
<span id="cb118-506"><a href="#cb118-506" aria-hidden="true" tabindex="-1"></a>infl <span class="op">=</span> result_new.get_influence()</span>
<span id="cb118-507"><a href="#cb118-507" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))[<span class="dv">1</span>]</span>
<span id="cb118-508"><a href="#cb118-508" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.arange(Xnew.shape[<span class="dv">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb118-509"><a href="#cb118-509" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Index'</span>)</span>
<span id="cb118-510"><a href="#cb118-510" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Leverage'</span>)</span>
<span id="cb118-511"><a href="#cb118-511" aria-hidden="true" tabindex="-1"></a>np.argmax(infl.hat_matrix_diag)</span>
<span id="cb118-512"><a href="#cb118-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-513"><a href="#cb118-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-516"><a href="#cb118-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-517"><a href="#cb118-517" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span>Carseats.shape[<span class="dv">0</span>]</span>
<span id="cb118-518"><a href="#cb118-518" aria-hidden="true" tabindex="-1"></a>leverage_thres<span class="op">=</span><span class="dv">3</span><span class="op">/</span>n</span>
<span id="cb118-519"><a href="#cb118-519" aria-hidden="true" tabindex="-1"></a>leverage_thres</span>
<span id="cb118-520"><a href="#cb118-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-521"><a href="#cb118-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-522"><a href="#cb118-522" aria-hidden="true" tabindex="-1"></a>We consider that there is no high leverage point since the maximal leverage is no more than 0.045 (attained at point 42), which does not greatly exceed the threshold of 0.0075.</span>
<span id="cb118-523"><a href="#cb118-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-526"><a href="#cb118-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-527"><a href="#cb118-527" aria-hidden="true" tabindex="-1"></a>studentized_residuals <span class="op">=</span> result_new.get_influence().resid_studentized_internal</span>
<span id="cb118-528"><a href="#cb118-528" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'fitted'</span>:result_new.fittedvalues,<span class="st">'studentized'</span>:studentized_residuals})</span>
<span id="cb118-529"><a href="#cb118-529" aria-hidden="true" tabindex="-1"></a>df[np.<span class="bu">abs</span>(df[<span class="st">'studentized'</span>])<span class="op">&gt;</span><span class="dv">3</span>].count()</span>
<span id="cb118-530"><a href="#cb118-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-531"><a href="#cb118-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-532"><a href="#cb118-532" aria-hidden="true" tabindex="-1"></a>We conclude that there is no observation for which the absolute value of the studentized residual is greater than 3, which means that there is no (post analysis) potential outlier. </span>
<span id="cb118-533"><a href="#cb118-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-534"><a href="#cb118-534" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 11</span></span>
<span id="cb118-535"><a href="#cb118-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-538"><a href="#cb118-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-539"><a href="#cb118-539" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>) <span class="co"># In order to generate the same results whenever we run the code</span></span>
<span id="cb118-540"><a href="#cb118-540" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng (<span class="dv">1</span>)</span>
<span id="cb118-541"><a href="#cb118-541" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-542"><a href="#cb118-542" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> x <span class="op">+</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-543"><a href="#cb118-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-544"><a href="#cb118-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-545"><a href="#cb118-545" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-546"><a href="#cb118-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-549"><a href="#cb118-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-550"><a href="#cb118-550" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb118-551"><a href="#cb118-551" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(df[[<span class="st">'x'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb118-552"><a href="#cb118-552" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-553"><a href="#cb118-553" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb118-554"><a href="#cb118-554" aria-hidden="true" tabindex="-1"></a>summarize(result)</span>
<span id="cb118-555"><a href="#cb118-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-556"><a href="#cb118-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-557"><a href="#cb118-557" aria-hidden="true" tabindex="-1"></a>The coefficient estimate is statistically significant. Therefore, we can reject the null hypothesis and conclude that there is a relationship between x and y.</span>
<span id="cb118-558"><a href="#cb118-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-559"><a href="#cb118-559" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-560"><a href="#cb118-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-563"><a href="#cb118-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-564"><a href="#cb118-564" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>MS(df[[<span class="st">'y'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb118-565"><a href="#cb118-565" aria-hidden="true" tabindex="-1"></a>model_new<span class="op">=</span>sm.OLS(x,Y)</span>
<span id="cb118-566"><a href="#cb118-566" aria-hidden="true" tabindex="-1"></a>result_new<span class="op">=</span>model_new.fit()</span>
<span id="cb118-567"><a href="#cb118-567" aria-hidden="true" tabindex="-1"></a>summarize(result_new)</span>
<span id="cb118-568"><a href="#cb118-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-569"><a href="#cb118-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-570"><a href="#cb118-570" aria-hidden="true" tabindex="-1"></a>Results of the new model yield to the same conclusion as for the existence of an evidence of relationship between x and y.</span>
<span id="cb118-571"><a href="#cb118-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-572"><a href="#cb118-572" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-573"><a href="#cb118-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-574"><a href="#cb118-574" aria-hidden="true" tabindex="-1"></a>Surprisingly, the coefficients of the fitted models in (a) and (b) are not the inverse of each other, though they should be apparently.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-575"><a href="#cb118-575" aria-hidden="true" tabindex="-1"></a>The formulas of the coefficients are in equation (3.38) in the book. These formulas prove the observed fact since the noise inserted in y makes its variance different from the variance of x. </span>
<span id="cb118-576"><a href="#cb118-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-577"><a href="#cb118-577" aria-hidden="true" tabindex="-1"></a><span class="al">![20230905_212542-3.jpg](attachment:20230905_212542-3.jpg)</span></span>
<span id="cb118-578"><a href="#cb118-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-579"><a href="#cb118-579" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb118-580"><a href="#cb118-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-581"><a href="#cb118-581" aria-hidden="true" tabindex="-1"></a>The former obtained equation for t-stat is symmetric in y and x. Therefore, it is clear now why t-stats of both fitted models in (a) and (b) are equal. </span>
<span id="cb118-582"><a href="#cb118-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-583"><a href="#cb118-583" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb118-584"><a href="#cb118-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-587"><a href="#cb118-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-588"><a href="#cb118-588" aria-hidden="true" tabindex="-1"></a><span class="co"># regress y onto x</span></span>
<span id="cb118-589"><a href="#cb118-589" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>MS(df[[<span class="st">'x'</span>]]).fit_transform(df)</span>
<span id="cb118-590"><a href="#cb118-590" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb118-591"><a href="#cb118-591" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb118-592"><a href="#cb118-592" aria-hidden="true" tabindex="-1"></a>summarize(result1)</span>
<span id="cb118-593"><a href="#cb118-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-594"><a href="#cb118-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-597"><a href="#cb118-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-598"><a href="#cb118-598" aria-hidden="true" tabindex="-1"></a><span class="co"># regress x onto y</span></span>
<span id="cb118-599"><a href="#cb118-599" aria-hidden="true" tabindex="-1"></a>Y1<span class="op">=</span>MS(df[[<span class="st">'y'</span>]]).fit_transform(df)</span>
<span id="cb118-600"><a href="#cb118-600" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(x,Y1)</span>
<span id="cb118-601"><a href="#cb118-601" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb118-602"><a href="#cb118-602" aria-hidden="true" tabindex="-1"></a>summarize(result2)</span>
<span id="cb118-603"><a href="#cb118-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-604"><a href="#cb118-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-605"><a href="#cb118-605" aria-hidden="true" tabindex="-1"></a>t-stats for both models coefficients $\beta_{1}$ equal 16.734</span>
<span id="cb118-606"><a href="#cb118-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-607"><a href="#cb118-607" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 12</span></span>
<span id="cb118-608"><a href="#cb118-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-609"><a href="#cb118-609" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-610"><a href="#cb118-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-611"><a href="#cb118-611" aria-hidden="true" tabindex="-1"></a>From the previous exercise we learn that the condition of the question becomes true when y and x have the same variance.</span>
<span id="cb118-612"><a href="#cb118-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-613"><a href="#cb118-613" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-614"><a href="#cb118-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-617"><a href="#cb118-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-618"><a href="#cb118-618" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb118-619"><a href="#cb118-619" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x <span class="op">+</span> np.random.normal(size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-620"><a href="#cb118-620" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb118-621"><a href="#cb118-621" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of y onto x</span></span>
<span id="cb118-622"><a href="#cb118-622" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(df[[<span class="st">'x'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb118-623"><a href="#cb118-623" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-624"><a href="#cb118-624" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb118-625"><a href="#cb118-625" aria-hidden="true" tabindex="-1"></a>summarize(result)</span>
<span id="cb118-626"><a href="#cb118-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-627"><a href="#cb118-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-630"><a href="#cb118-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-631"><a href="#cb118-631" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of x onto y</span></span>
<span id="cb118-632"><a href="#cb118-632" aria-hidden="true" tabindex="-1"></a>Y<span class="op">=</span>MS(df[[<span class="st">'y'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df)</span>
<span id="cb118-633"><a href="#cb118-633" aria-hidden="true" tabindex="-1"></a>model_y<span class="op">=</span>sm.OLS(x,Y)</span>
<span id="cb118-634"><a href="#cb118-634" aria-hidden="true" tabindex="-1"></a>result_y<span class="op">=</span>model_y.fit()</span>
<span id="cb118-635"><a href="#cb118-635" aria-hidden="true" tabindex="-1"></a>summarize(result_y)</span>
<span id="cb118-636"><a href="#cb118-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-637"><a href="#cb118-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-638"><a href="#cb118-638" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-639"><a href="#cb118-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-642"><a href="#cb118-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-643"><a href="#cb118-643" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb118-644"><a href="#cb118-644" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb118-645"><a href="#cb118-645" aria-hidden="true" tabindex="-1"></a>df1<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb118-646"><a href="#cb118-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-647"><a href="#cb118-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-650"><a href="#cb118-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-651"><a href="#cb118-651" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of y onto x</span></span>
<span id="cb118-652"><a href="#cb118-652" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>MS(df1[[<span class="st">'x'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df1)</span>
<span id="cb118-653"><a href="#cb118-653" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb118-654"><a href="#cb118-654" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb118-655"><a href="#cb118-655" aria-hidden="true" tabindex="-1"></a>summarize(result1)</span>
<span id="cb118-656"><a href="#cb118-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-657"><a href="#cb118-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-660"><a href="#cb118-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-661"><a href="#cb118-661" aria-hidden="true" tabindex="-1"></a><span class="co">#regression of x onto y</span></span>
<span id="cb118-662"><a href="#cb118-662" aria-hidden="true" tabindex="-1"></a>Y1<span class="op">=</span>MS(df[[<span class="st">'y'</span>]],intercept<span class="op">=</span><span class="va">False</span>).fit_transform(df1)</span>
<span id="cb118-663"><a href="#cb118-663" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(x,Y1)</span>
<span id="cb118-664"><a href="#cb118-664" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb118-665"><a href="#cb118-665" aria-hidden="true" tabindex="-1"></a>summarize(result2)</span>
<span id="cb118-666"><a href="#cb118-666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-667"><a href="#cb118-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-668"><a href="#cb118-668" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 13</span></span>
<span id="cb118-669"><a href="#cb118-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-672"><a href="#cb118-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-673"><a href="#cb118-673" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb118-674"><a href="#cb118-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-675"><a href="#cb118-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-676"><a href="#cb118-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-677"><a href="#cb118-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-680"><a href="#cb118-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-681"><a href="#cb118-681" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="fl">0.0</span>,scale<span class="op">=</span><span class="fl">1.0</span>,size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-682"><a href="#cb118-682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-683"><a href="#cb118-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-684"><a href="#cb118-684" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-685"><a href="#cb118-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-688"><a href="#cb118-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-689"><a href="#cb118-689" aria-hidden="true" tabindex="-1"></a>eps<span class="op">=</span>np.random.normal(loc<span class="op">=</span><span class="fl">0.0</span>,scale<span class="op">=</span><span class="fl">0.25</span>,size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-690"><a href="#cb118-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-691"><a href="#cb118-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-692"><a href="#cb118-692" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-693"><a href="#cb118-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-696"><a href="#cb118-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-697"><a href="#cb118-697" aria-hidden="true" tabindex="-1"></a>y<span class="op">=-</span><span class="dv">1</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>x<span class="op">+</span>eps</span>
<span id="cb118-698"><a href="#cb118-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-699"><a href="#cb118-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-702"><a href="#cb118-702" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-703"><a href="#cb118-703" aria-hidden="true" tabindex="-1"></a>y.shape</span>
<span id="cb118-704"><a href="#cb118-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-705"><a href="#cb118-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-706"><a href="#cb118-706" aria-hidden="true" tabindex="-1"></a>In this linear model $\beta_{1}$ equals 0.5 and $\beta_{0}$ equals -1</span>
<span id="cb118-707"><a href="#cb118-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-708"><a href="#cb118-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb118-709"><a href="#cb118-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-712"><a href="#cb118-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-713"><a href="#cb118-713" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))[<span class="dv">1</span>]</span>
<span id="cb118-714"><a href="#cb118-714" aria-hidden="true" tabindex="-1"></a>ax.scatter(x,y)</span>
<span id="cb118-715"><a href="#cb118-715" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"X"</span>)</span>
<span id="cb118-716"><a href="#cb118-716" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Y"</span>)<span class="op">;</span></span>
<span id="cb118-717"><a href="#cb118-717" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-718"><a href="#cb118-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-719"><a href="#cb118-719" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb118-720"><a href="#cb118-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-723"><a href="#cb118-723" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-724"><a href="#cb118-724" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x'</span>:x,<span class="st">'y'</span>:y})</span>
<span id="cb118-725"><a href="#cb118-725" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(df[[<span class="st">'x'</span>]]).fit_transform(df)</span>
<span id="cb118-726"><a href="#cb118-726" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-727"><a href="#cb118-727" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb118-728"><a href="#cb118-728" aria-hidden="true" tabindex="-1"></a>result.summary()</span>
<span id="cb118-729"><a href="#cb118-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-730"><a href="#cb118-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-731"><a href="#cb118-731" aria-hidden="true" tabindex="-1"></a>Coefficients obrained by the regression model are approximately the same as the coefficients formed in question (c)</span>
<span id="cb118-732"><a href="#cb118-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-733"><a href="#cb118-733" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb118-734"><a href="#cb118-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-737"><a href="#cb118-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-738"><a href="#cb118-738" aria-hidden="true" tabindex="-1"></a>beta_0<span class="op">=</span>result.params[<span class="dv">0</span>]</span>
<span id="cb118-739"><a href="#cb118-739" aria-hidden="true" tabindex="-1"></a>beta_1<span class="op">=</span>result.params[<span class="dv">1</span>]</span>
<span id="cb118-740"><a href="#cb118-740" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>[beta_0 <span class="op">+</span> beta_1<span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb118-741"><a href="#cb118-741" aria-hidden="true" tabindex="-1"></a>y_true<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb118-742"><a href="#cb118-742" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)</span>
<span id="cb118-743"><a href="#cb118-743" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb118-744"><a href="#cb118-744" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb118-745"><a href="#cb118-745" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, <span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Model fit'</span>)</span>
<span id="cb118-746"><a href="#cb118-746" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_true, <span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb118-747"><a href="#cb118-747" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span>
<span id="cb118-748"><a href="#cb118-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-749"><a href="#cb118-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-750"><a href="#cb118-750" aria-hidden="true" tabindex="-1"></a><span class="fu">### (g)</span></span>
<span id="cb118-751"><a href="#cb118-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-754"><a href="#cb118-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-755"><a href="#cb118-755" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> MS([poly(<span class="st">'x'</span>, degree<span class="op">=</span><span class="dv">2</span>)]).fit_transform(df)</span>
<span id="cb118-756"><a href="#cb118-756" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb118-757"><a href="#cb118-757" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb118-758"><a href="#cb118-758" aria-hidden="true" tabindex="-1"></a>result1.summary()</span>
<span id="cb118-759"><a href="#cb118-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-760"><a href="#cb118-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-761"><a href="#cb118-761" aria-hidden="true" tabindex="-1"></a>The p-value of the quadratic term shows that there is no significant relationship between $X^2$ and $Y$.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-762"><a href="#cb118-762" aria-hidden="true" tabindex="-1"></a>Therefore, there is no evidence that the insertion of the quadratic term improves the model fit.</span>
<span id="cb118-763"><a href="#cb118-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-764"><a href="#cb118-764" aria-hidden="true" tabindex="-1"></a><span class="fu">### (h)</span></span>
<span id="cb118-765"><a href="#cb118-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-768"><a href="#cb118-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-769"><a href="#cb118-769" aria-hidden="true" tabindex="-1"></a>eps1 <span class="op">=</span> np.random.normal(scale <span class="op">=</span><span class="fl">0.01</span>, size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-770"><a href="#cb118-770" aria-hidden="true" tabindex="-1"></a>y1 <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>x <span class="op">+</span> eps1</span>
<span id="cb118-771"><a href="#cb118-771" aria-hidden="true" tabindex="-1"></a>df1<span class="op">=</span>pd.DataFrame({<span class="st">'x1'</span>:x,<span class="st">'y1'</span>:y1})</span>
<span id="cb118-772"><a href="#cb118-772" aria-hidden="true" tabindex="-1"></a>X2<span class="op">=</span>MS(df1[[<span class="st">'x1'</span>]]).fit_transform(df1)</span>
<span id="cb118-773"><a href="#cb118-773" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(y1,X2)</span>
<span id="cb118-774"><a href="#cb118-774" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb118-775"><a href="#cb118-775" aria-hidden="true" tabindex="-1"></a>beta_0<span class="op">=</span>result2.params[<span class="dv">0</span>]</span>
<span id="cb118-776"><a href="#cb118-776" aria-hidden="true" tabindex="-1"></a>beta_1<span class="op">=</span>result2.params[<span class="dv">1</span>]</span>
<span id="cb118-777"><a href="#cb118-777" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>[beta_0 <span class="op">+</span> beta_1<span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb118-778"><a href="#cb118-778" aria-hidden="true" tabindex="-1"></a>y_true<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb118-779"><a href="#cb118-779" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y1)</span>
<span id="cb118-780"><a href="#cb118-780" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb118-781"><a href="#cb118-781" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb118-782"><a href="#cb118-782" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, <span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Model fit'</span>)</span>
<span id="cb118-783"><a href="#cb118-783" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_true, <span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb118-784"><a href="#cb118-784" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span>
<span id="cb118-785"><a href="#cb118-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-786"><a href="#cb118-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-787"><a href="#cb118-787" aria-hidden="true" tabindex="-1"></a>Reducing the noise makes the fitted model and the true one almost identical.</span>
<span id="cb118-788"><a href="#cb118-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-789"><a href="#cb118-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### (i)</span></span>
<span id="cb118-790"><a href="#cb118-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-793"><a href="#cb118-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-794"><a href="#cb118-794" aria-hidden="true" tabindex="-1"></a>eps2 <span class="op">=</span> np.random.normal(scale <span class="op">=</span><span class="dv">10</span>, size<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-795"><a href="#cb118-795" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>x <span class="op">+</span> eps2</span>
<span id="cb118-796"><a href="#cb118-796" aria-hidden="true" tabindex="-1"></a>df2<span class="op">=</span>pd.DataFrame({<span class="st">'x2'</span>:x,<span class="st">'y2'</span>:y2})</span>
<span id="cb118-797"><a href="#cb118-797" aria-hidden="true" tabindex="-1"></a>X3<span class="op">=</span>MS(df2[[<span class="st">'x2'</span>]]).fit_transform(df2)</span>
<span id="cb118-798"><a href="#cb118-798" aria-hidden="true" tabindex="-1"></a>model3<span class="op">=</span>sm.OLS(y2,X3)</span>
<span id="cb118-799"><a href="#cb118-799" aria-hidden="true" tabindex="-1"></a>result3<span class="op">=</span>model3.fit()</span>
<span id="cb118-800"><a href="#cb118-800" aria-hidden="true" tabindex="-1"></a>beta_0<span class="op">=</span>result3.params[<span class="dv">0</span>]</span>
<span id="cb118-801"><a href="#cb118-801" aria-hidden="true" tabindex="-1"></a>beta_1<span class="op">=</span>result3.params[<span class="dv">1</span>]</span>
<span id="cb118-802"><a href="#cb118-802" aria-hidden="true" tabindex="-1"></a>y_pred<span class="op">=</span>[beta_0 <span class="op">+</span> beta_1<span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb118-803"><a href="#cb118-803" aria-hidden="true" tabindex="-1"></a>y_true<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span>xi <span class="cf">for</span> xi <span class="kw">in</span> x]</span>
<span id="cb118-804"><a href="#cb118-804" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y2)</span>
<span id="cb118-805"><a href="#cb118-805" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"x"</span>)</span>
<span id="cb118-806"><a href="#cb118-806" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"y"</span>)</span>
<span id="cb118-807"><a href="#cb118-807" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_pred, <span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Model fit'</span>)</span>
<span id="cb118-808"><a href="#cb118-808" aria-hidden="true" tabindex="-1"></a>plt.plot(x, y_true, <span class="st">'red'</span>, label<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb118-809"><a href="#cb118-809" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span>
<span id="cb118-810"><a href="#cb118-810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-811"><a href="#cb118-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-812"><a href="#cb118-812" aria-hidden="true" tabindex="-1"></a>Increasing the noise makes the fitted model and the true more distinguishable.</span>
<span id="cb118-813"><a href="#cb118-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-816"><a href="#cb118-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-817"><a href="#cb118-817" aria-hidden="true" tabindex="-1"></a>result.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb118-818"><a href="#cb118-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-819"><a href="#cb118-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-822"><a href="#cb118-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-823"><a href="#cb118-823" aria-hidden="true" tabindex="-1"></a>result2.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb118-824"><a href="#cb118-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-825"><a href="#cb118-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-828"><a href="#cb118-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-829"><a href="#cb118-829" aria-hidden="true" tabindex="-1"></a>result3.conf_int(alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb118-830"><a href="#cb118-830" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-831"><a href="#cb118-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-832"><a href="#cb118-832" aria-hidden="true" tabindex="-1"></a>As exepected, the more you add noise the larger are the confidence intervals for the regression coefficients. The inverse is true.</span>
<span id="cb118-833"><a href="#cb118-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-834"><a href="#cb118-834" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 14</span></span>
<span id="cb118-835"><a href="#cb118-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-836"><a href="#cb118-836" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-837"><a href="#cb118-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-840"><a href="#cb118-840" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-841"><a href="#cb118-841" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng (<span class="dv">10</span>)</span>
<span id="cb118-842"><a href="#cb118-842" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> rng.uniform(<span class="dv">0</span>, <span class="dv">1</span>, size <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-843"><a href="#cb118-843" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> x1 <span class="op">+</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>) <span class="op">/</span> <span class="dv">10</span></span>
<span id="cb118-844"><a href="#cb118-844" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> x1 <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> x2 <span class="op">+</span> rng.normal(size <span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb118-845"><a href="#cb118-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-846"><a href="#cb118-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-847"><a href="#cb118-847" aria-hidden="true" tabindex="-1"></a>The regression coefficients are:<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-848"><a href="#cb118-848" aria-hidden="true" tabindex="-1"></a>$\beta_{0}=2$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-849"><a href="#cb118-849" aria-hidden="true" tabindex="-1"></a>$\beta_{1}=2$<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-850"><a href="#cb118-850" aria-hidden="true" tabindex="-1"></a>$\beta_{2}=0.3$</span>
<span id="cb118-851"><a href="#cb118-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-852"><a href="#cb118-852" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-853"><a href="#cb118-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-856"><a href="#cb118-856" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-857"><a href="#cb118-857" aria-hidden="true" tabindex="-1"></a>np.corrcoef(x1,x2)</span>
<span id="cb118-858"><a href="#cb118-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-859"><a href="#cb118-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-860"><a href="#cb118-860" aria-hidden="true" tabindex="-1"></a>The correlation between x1 and x2 is 0.772</span>
<span id="cb118-861"><a href="#cb118-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-864"><a href="#cb118-864" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-865"><a href="#cb118-865" aria-hidden="true" tabindex="-1"></a>plt.scatter(x1,x2)</span>
<span id="cb118-866"><a href="#cb118-866" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'x1'</span>)</span>
<span id="cb118-867"><a href="#cb118-867" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'x2'</span>)<span class="op">;</span></span>
<span id="cb118-868"><a href="#cb118-868" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-869"><a href="#cb118-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-870"><a href="#cb118-870" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-871"><a href="#cb118-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-874"><a href="#cb118-874" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-875"><a href="#cb118-875" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'x1'</span>:x1,<span class="st">'x2'</span>:x2,<span class="st">'y'</span>:y})</span>
<span id="cb118-876"><a href="#cb118-876" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS([<span class="st">'x1'</span>,<span class="st">'x2'</span>]).fit_transform(df)</span>
<span id="cb118-877"><a href="#cb118-877" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-878"><a href="#cb118-878" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>model.fit()</span>
<span id="cb118-879"><a href="#cb118-879" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'beta0 is'</span>,result.params[<span class="dv">0</span>])</span>
<span id="cb118-880"><a href="#cb118-880" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'beta1 is'</span>,result.params[<span class="dv">1</span>])</span>
<span id="cb118-881"><a href="#cb118-881" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'beta2 is'</span>,result.params[<span class="dv">2</span>])</span>
<span id="cb118-882"><a href="#cb118-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-883"><a href="#cb118-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-884"><a href="#cb118-884" aria-hidden="true" tabindex="-1"></a>The estimated coefficients by the regression model are clearly different from the true ones except for $\beta_{0}$ </span>
<span id="cb118-885"><a href="#cb118-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-888"><a href="#cb118-888" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-889"><a href="#cb118-889" aria-hidden="true" tabindex="-1"></a>summarize(result)</span>
<span id="cb118-890"><a href="#cb118-890" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-891"><a href="#cb118-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-892"><a href="#cb118-892" aria-hidden="true" tabindex="-1"></a>Based on the p-values we can reject the null hypothesis of $H_{0}: \beta_{1}=0$ but we cannot the null hypothesis of $H_{0}: \beta_{2}=0$</span>
<span id="cb118-893"><a href="#cb118-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-894"><a href="#cb118-894" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb118-895"><a href="#cb118-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-898"><a href="#cb118-898" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-899"><a href="#cb118-899" aria-hidden="true" tabindex="-1"></a>X1<span class="op">=</span>MS([<span class="st">'x1'</span>]).fit_transform(df)</span>
<span id="cb118-900"><a href="#cb118-900" aria-hidden="true" tabindex="-1"></a>model1<span class="op">=</span>sm.OLS(y,X1)</span>
<span id="cb118-901"><a href="#cb118-901" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>model1.fit()</span>
<span id="cb118-902"><a href="#cb118-902" aria-hidden="true" tabindex="-1"></a>summarize(result1)</span>
<span id="cb118-903"><a href="#cb118-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-904"><a href="#cb118-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-905"><a href="#cb118-905" aria-hidden="true" tabindex="-1"></a>The p-values show that we can reject the null hypothesis $H_{0}: \beta_{1}=0$. Moreover, we notice that both obtained coefficients are improved since they are closer enough to the real ones.</span>
<span id="cb118-906"><a href="#cb118-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-907"><a href="#cb118-907" aria-hidden="true" tabindex="-1"></a><span class="fu">### (e)</span></span>
<span id="cb118-908"><a href="#cb118-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-911"><a href="#cb118-911" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-912"><a href="#cb118-912" aria-hidden="true" tabindex="-1"></a>X2<span class="op">=</span>MS([<span class="st">'x2'</span>]).fit_transform(df)</span>
<span id="cb118-913"><a href="#cb118-913" aria-hidden="true" tabindex="-1"></a>model2<span class="op">=</span>sm.OLS(y,X2)</span>
<span id="cb118-914"><a href="#cb118-914" aria-hidden="true" tabindex="-1"></a>result2<span class="op">=</span>model2.fit()</span>
<span id="cb118-915"><a href="#cb118-915" aria-hidden="true" tabindex="-1"></a>summarize(result2)</span>
<span id="cb118-916"><a href="#cb118-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-917"><a href="#cb118-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-918"><a href="#cb118-918" aria-hidden="true" tabindex="-1"></a>The results has significantly changed relatively to (c). the coefficient for x2 has become even greater than the intercept coefficient.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-919"><a href="#cb118-919" aria-hidden="true" tabindex="-1"></a>Furthermore, base on the p-values we can reject the null hypothesis $H_{0}: \beta_{1}=0$.</span>
<span id="cb118-920"><a href="#cb118-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-921"><a href="#cb118-921" aria-hidden="true" tabindex="-1"></a><span class="fu">### (f)</span></span>
<span id="cb118-922"><a href="#cb118-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-923"><a href="#cb118-923" aria-hidden="true" tabindex="-1"></a>The high correlation between x1 and x2 as shown above suggests that there is a high deal of colinearity. This explains why fitted one by one we can reject the null hypotheses, but when the predictors are assembled together the p-values show that one of them should be dismissed. In that sense there is no contradiction.</span>
<span id="cb118-924"><a href="#cb118-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-925"><a href="#cb118-925" aria-hidden="true" tabindex="-1"></a><span class="fu">### (g)</span></span>
<span id="cb118-926"><a href="#cb118-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-929"><a href="#cb118-929" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-930"><a href="#cb118-930" aria-hidden="true" tabindex="-1"></a>x1 <span class="op">=</span> np.concatenate([x1, [<span class="fl">0.1</span>]])</span>
<span id="cb118-931"><a href="#cb118-931" aria-hidden="true" tabindex="-1"></a>x2 <span class="op">=</span> np.concatenate([x2, [<span class="fl">0.8</span>]])</span>
<span id="cb118-932"><a href="#cb118-932" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.concatenate([y, [<span class="dv">6</span>]])</span>
<span id="cb118-933"><a href="#cb118-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-934"><a href="#cb118-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-937"><a href="#cb118-937" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-938"><a href="#cb118-938" aria-hidden="true" tabindex="-1"></a><span class="co">#Model with both updated x1 and x2</span></span>
<span id="cb118-939"><a href="#cb118-939" aria-hidden="true" tabindex="-1"></a>df2<span class="op">=</span>pd.DataFrame({<span class="st">'x1'</span>:x1,<span class="st">'x2'</span>:x2,<span class="st">'y'</span>:y})</span>
<span id="cb118-940"><a href="#cb118-940" aria-hidden="true" tabindex="-1"></a>X3<span class="op">=</span>MS([<span class="st">'x1'</span>,<span class="st">'x2'</span>]).fit_transform(df2)</span>
<span id="cb118-941"><a href="#cb118-941" aria-hidden="true" tabindex="-1"></a>model3<span class="op">=</span>sm.OLS(y,X3)</span>
<span id="cb118-942"><a href="#cb118-942" aria-hidden="true" tabindex="-1"></a>result3<span class="op">=</span>model3.fit()</span>
<span id="cb118-943"><a href="#cb118-943" aria-hidden="true" tabindex="-1"></a>summarize(result3)</span>
<span id="cb118-944"><a href="#cb118-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-945"><a href="#cb118-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-948"><a href="#cb118-948" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-949"><a href="#cb118-949" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a new model with only x1</span></span>
<span id="cb118-950"><a href="#cb118-950" aria-hidden="true" tabindex="-1"></a>X4<span class="op">=</span>MS([<span class="st">'x1'</span>]).fit_transform(df2)</span>
<span id="cb118-951"><a href="#cb118-951" aria-hidden="true" tabindex="-1"></a>model4<span class="op">=</span>sm.OLS(y,X4)</span>
<span id="cb118-952"><a href="#cb118-952" aria-hidden="true" tabindex="-1"></a>result4<span class="op">=</span>model4.fit()</span>
<span id="cb118-953"><a href="#cb118-953" aria-hidden="true" tabindex="-1"></a>summarize(result4)</span>
<span id="cb118-954"><a href="#cb118-954" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-955"><a href="#cb118-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-958"><a href="#cb118-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-959"><a href="#cb118-959" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a new model with only x1</span></span>
<span id="cb118-960"><a href="#cb118-960" aria-hidden="true" tabindex="-1"></a>X5<span class="op">=</span>MS([<span class="st">'x2'</span>]).fit_transform(df2)</span>
<span id="cb118-961"><a href="#cb118-961" aria-hidden="true" tabindex="-1"></a>model5<span class="op">=</span>sm.OLS(y,X5)</span>
<span id="cb118-962"><a href="#cb118-962" aria-hidden="true" tabindex="-1"></a>result5<span class="op">=</span>model5.fit()</span>
<span id="cb118-963"><a href="#cb118-963" aria-hidden="true" tabindex="-1"></a>summarize(result5)</span>
<span id="cb118-964"><a href="#cb118-964" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-965"><a href="#cb118-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-966"><a href="#cb118-966" aria-hidden="true" tabindex="-1"></a>The insertion of a new observation caused the regression coefficient related to $x_{1}$ to decrease and the other related to $x_{2}$ to increase in all the models.</span>
<span id="cb118-967"><a href="#cb118-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-968"><a href="#cb118-968" aria-hidden="true" tabindex="-1"></a>In order to evaluate wether the added observation is an outlier or a leverage point, you can exploit, for the three model combinations, the appropriate type of figures (resid vs studentized resid)  as we did in the previous exercises. I left it here to your own discovery.<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb118-969"><a href="#cb118-969" aria-hidden="true" tabindex="-1"></a>Finally it is very likely that the obeservation is an outlier and/or a leverage point since its insertion has clearly inlfluenced the model results.</span>
<span id="cb118-970"><a href="#cb118-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-971"><a href="#cb118-971" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 15</span></span>
<span id="cb118-972"><a href="#cb118-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-975"><a href="#cb118-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-976"><a href="#cb118-976" aria-hidden="true" tabindex="-1"></a>Boston<span class="op">=</span>load_data(<span class="st">'Boston'</span>)</span>
<span id="cb118-977"><a href="#cb118-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-978"><a href="#cb118-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-981"><a href="#cb118-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-982"><a href="#cb118-982" aria-hidden="true" tabindex="-1"></a>Boston.columns</span>
<span id="cb118-983"><a href="#cb118-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-984"><a href="#cb118-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-987"><a href="#cb118-987" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-988"><a href="#cb118-988" aria-hidden="true" tabindex="-1"></a>Boston.head()</span>
<span id="cb118-989"><a href="#cb118-989" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-990"><a href="#cb118-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-991"><a href="#cb118-991" aria-hidden="true" tabindex="-1"></a><span class="fu">### (a)</span></span>
<span id="cb118-992"><a href="#cb118-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-995"><a href="#cb118-995" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-996"><a href="#cb118-996" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>[]</span>
<span id="cb118-997"><a href="#cb118-997" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>Boston[<span class="st">'crim'</span>]</span>
<span id="cb118-998"><a href="#cb118-998" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>,<span class="dv">1</span>):</span>
<span id="cb118-999"><a href="#cb118-999" aria-hidden="true" tabindex="-1"></a>    predictor<span class="op">=</span>Boston.columns[i]</span>
<span id="cb118-1000"><a href="#cb118-1000" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>Boston.loc[:,predictor]</span>
<span id="cb118-1001"><a href="#cb118-1001" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>sm.add_constant(x)</span>
<span id="cb118-1002"><a href="#cb118-1002" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>sm.OLS(y,x)</span>
<span id="cb118-1003"><a href="#cb118-1003" aria-hidden="true" tabindex="-1"></a>    result.append({predictor: model.fit().pvalues[<span class="dv">1</span>]})</span>
<span id="cb118-1004"><a href="#cb118-1004" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb118-1005"><a href="#cb118-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1006"><a href="#cb118-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1007"><a href="#cb118-1007" aria-hidden="true" tabindex="-1"></a>All predictors are significant except 'chas'.</span>
<span id="cb118-1008"><a href="#cb118-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1009"><a href="#cb118-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">### (b)</span></span>
<span id="cb118-1010"><a href="#cb118-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1013"><a href="#cb118-1013" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1014"><a href="#cb118-1014" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>MS(Boston.columns.drop([<span class="st">'crim'</span>])).fit_transform(Boston)</span>
<span id="cb118-1015"><a href="#cb118-1015" aria-hidden="true" tabindex="-1"></a>model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-1016"><a href="#cb118-1016" aria-hidden="true" tabindex="-1"></a>result_new<span class="op">=</span>model.fit()</span>
<span id="cb118-1017"><a href="#cb118-1017" aria-hidden="true" tabindex="-1"></a>summarize(result_new)</span>
<span id="cb118-1018"><a href="#cb118-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1019"><a href="#cb118-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1020"><a href="#cb118-1020" aria-hidden="true" tabindex="-1"></a>The null hypothesis given in the question is rejected for the following predictors : zn, dis, rad and medv</span>
<span id="cb118-1021"><a href="#cb118-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1022"><a href="#cb118-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">### (c)</span></span>
<span id="cb118-1023"><a href="#cb118-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1026"><a href="#cb118-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1027"><a href="#cb118-1027" aria-hidden="true" tabindex="-1"></a>result1<span class="op">=</span>[]</span>
<span id="cb118-1028"><a href="#cb118-1028" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>,<span class="dv">1</span>):</span>
<span id="cb118-1029"><a href="#cb118-1029" aria-hidden="true" tabindex="-1"></a>    predictor<span class="op">=</span>Boston.columns[i]</span>
<span id="cb118-1030"><a href="#cb118-1030" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>Boston.loc[:,predictor]</span>
<span id="cb118-1031"><a href="#cb118-1031" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>sm.add_constant(x)</span>
<span id="cb118-1032"><a href="#cb118-1032" aria-hidden="true" tabindex="-1"></a>    model1<span class="op">=</span>sm.OLS(y,x)</span>
<span id="cb118-1033"><a href="#cb118-1033" aria-hidden="true" tabindex="-1"></a>    result1.append(model1.fit().params[<span class="dv">1</span>])</span>
<span id="cb118-1034"><a href="#cb118-1034" aria-hidden="true" tabindex="-1"></a>plt.scatter(result1,result_new.params[<span class="dv">1</span>:<span class="dv">14</span>])</span>
<span id="cb118-1035"><a href="#cb118-1035" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Univariate coef'</span>)</span>
<span id="cb118-1036"><a href="#cb118-1036" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Multivariate coef'</span>)<span class="op">;</span></span>
<span id="cb118-1037"><a href="#cb118-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1038"><a href="#cb118-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1041"><a href="#cb118-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1042"><a href="#cb118-1042" aria-hidden="true" tabindex="-1"></a>result_new.pvalues[<span class="dv">2</span>:]</span>
<span id="cb118-1043"><a href="#cb118-1043" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1044"><a href="#cb118-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1045"><a href="#cb118-1045" aria-hidden="true" tabindex="-1"></a>We notice that the outlier point returns to the 'Nox' coefficient. Let's remove this point from the plot and show it again</span>
<span id="cb118-1046"><a href="#cb118-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1049"><a href="#cb118-1049" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1050"><a href="#cb118-1050" aria-hidden="true" tabindex="-1"></a>plt.scatter(result1[<span class="dv">0</span>:<span class="dv">3</span>],result_new.params[<span class="dv">1</span>:<span class="dv">4</span>],color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb118-1051"><a href="#cb118-1051" aria-hidden="true" tabindex="-1"></a>plt.scatter(result1[<span class="dv">4</span>:<span class="dv">12</span>],result_new.params[<span class="dv">5</span>:<span class="dv">14</span>],color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb118-1052"><a href="#cb118-1052" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="op">-</span><span class="dv">4</span>,<span class="dv">2</span>], [<span class="op">-</span><span class="dv">4</span>,<span class="dv">2</span>]) </span>
<span id="cb118-1053"><a href="#cb118-1053" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Univariate coef'</span>)</span>
<span id="cb118-1054"><a href="#cb118-1054" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Multivariate coef'</span>)<span class="op">;</span></span>
<span id="cb118-1055"><a href="#cb118-1055" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1056"><a href="#cb118-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1059"><a href="#cb118-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1060"><a href="#cb118-1060" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame({<span class="st">'Univariate'</span>:result1,<span class="st">'Multivariate'</span>:result_new.params[<span class="dv">1</span>:]})</span>
<span id="cb118-1061"><a href="#cb118-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1062"><a href="#cb118-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1065"><a href="#cb118-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1066"><a href="#cb118-1066" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb118-1067"><a href="#cb118-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1068"><a href="#cb118-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1069"><a href="#cb118-1069" aria-hidden="true" tabindex="-1"></a>We notice that features 'age', 'rad', 'tax', 'medv' and 'zn' are the closer to the fitting line. However, since we failed to reject the null hyoptheses for 'age' and 'tax' their related points should have no meaning.</span>
<span id="cb118-1070"><a href="#cb118-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1071"><a href="#cb118-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">### (d)</span></span>
<span id="cb118-1072"><a href="#cb118-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1075"><a href="#cb118-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb118-1076"><a href="#cb118-1076" aria-hidden="true" tabindex="-1"></a>nl_results<span class="op">=</span>[]</span>
<span id="cb118-1077"><a href="#cb118-1077" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">13</span>):</span>
<span id="cb118-1078"><a href="#cb118-1078" aria-hidden="true" tabindex="-1"></a>    predictor<span class="op">=</span>Boston.columns[i]</span>
<span id="cb118-1079"><a href="#cb118-1079" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>Boston.loc[:,predictor]</span>
<span id="cb118-1080"><a href="#cb118-1080" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> MS([poly(predictor, degree<span class="op">=</span><span class="dv">3</span>)]).fit_transform(Boston)</span>
<span id="cb118-1081"><a href="#cb118-1081" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>sm.OLS(y,X)</span>
<span id="cb118-1082"><a href="#cb118-1082" aria-hidden="true" tabindex="-1"></a>    nl_results.append({predictor:model.fit().pvalues[<span class="dv">0</span>:<span class="dv">4</span>]})</span>
<span id="cb118-1083"><a href="#cb118-1083" aria-hidden="true" tabindex="-1"></a>nl_results</span>
<span id="cb118-1084"><a href="#cb118-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb118-1085"><a href="#cb118-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-1086"><a href="#cb118-1086" aria-hidden="true" tabindex="-1"></a>Cubic relationships are not significant for predictors 'rm', 'lstat', 'tax', 'rad' and 'zn'. On the other hand we can assert that there is a cubic association relationships regarding features 'indus', 'chas', 'nox', 'age', 'dis', 'ptratio' and 'medv'.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>